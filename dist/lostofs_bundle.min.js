(function(e){function t(s){if(n[s])return n[s].exports;var r=n[s]={i:s,l:!1,exports:{}};return e[s].call(r.exports,r,r.exports,t),r.l=!0,r.exports}var n={};return t.m=e,t.c=n,t.d=function(e,n,s){t.o(e,n)||Object.defineProperty(e,n,{configurable:!1,enumerable:!0,get:s})},t.n=function(e){var n=e&&e.__esModule?function(){return e['default']}:function(){return e};return t.d(n,'a',n),n},t.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},t.p='',t(t.s=5)})([function(e){var t=function(){return this}();try{t=t||Function('return this')()||(1,eval)('this')}catch(n){'object'==typeof window&&(t=window)}e.exports=t},function(e,t,n){'use strict';(function(t){function n(){l=!0;for(var e=c.length,t,n;e;){for(n=c,c=[],t=-1;++t<e;)n[t]();e=c.length}l=!1}var s=t.MutationObserver||t.WebKitMutationObserver,r;if(s){var o=0,i=new s(n),a=t.document.createTextNode('');i.observe(a,{characterData:!0}),r=function(){a.data=o=++o%2}}else if(!t.setImmediate&&'undefined'!=typeof t.MessageChannel){var d=new t.MessageChannel;d.port1.onmessage=n,r=function(){d.port2.postMessage(0)}}else r='document'in t&&'onreadystatechange'in t.document.createElement('script')?function(){var e=t.document.createElement('script');e.onreadystatechange=function(){n(),e.onreadystatechange=null,e.parentNode.removeChild(e),e=null},t.document.documentElement.appendChild(e)}:function(){setTimeout(n,0)};var c=[],l;e.exports=function(e){1!==c.push(e)||l||r()}}).call(t,n(0))},function(e){function t(){this._events=this._events||{},this._maxListeners=this._maxListeners||void 0}function n(e){return'function'==typeof e}function s(e){return'number'==typeof e}function r(e){return'object'==typeof e&&null!==e}function o(e){return void 0===e}e.exports=t,t.EventEmitter=t,t.prototype._events=void 0,t.prototype._maxListeners=void 0,t.defaultMaxListeners=10,t.prototype.setMaxListeners=function(e){if(!s(e)||0>e||isNaN(e))throw TypeError('n must be a positive number');return this._maxListeners=e,this},t.prototype.emit=function(e){var t,s,a,d,c,i;if(this._events||(this._events={}),'error'===e&&(!this._events.error||r(this._events.error)&&!this._events.error.length))if(t=arguments[1],t instanceof Error)throw t;else{var l=new Error('Uncaught, unspecified "error" event. ('+t+')');throw l.context=t,l}if(s=this._events[e],o(s))return!1;if(n(s))switch(arguments.length){case 1:s.call(this);break;case 2:s.call(this,arguments[1]);break;case 3:s.call(this,arguments[1],arguments[2]);break;default:d=Array.prototype.slice.call(arguments,1),s.apply(this,d);}else if(r(s))for(d=Array.prototype.slice.call(arguments,1),i=s.slice(),a=i.length,c=0;c<a;c++)i[c].apply(this,d);return!0},t.prototype.addListener=function(e,s){var i;if(!n(s))throw TypeError('listener must be a function');return this._events||(this._events={}),this._events.newListener&&this.emit('newListener',e,n(s.listener)?s.listener:s),this._events[e]?r(this._events[e])?this._events[e].push(s):this._events[e]=[this._events[e],s]:this._events[e]=s,r(this._events[e])&&!this._events[e].warned&&(i=o(this._maxListeners)?t.defaultMaxListeners:this._maxListeners,i&&0<i&&this._events[e].length>i&&(this._events[e].warned=!0,console.error('(node) warning: possible EventEmitter memory leak detected. %d listeners added. Use emitter.setMaxListeners() to increase limit.',this._events[e].length),'function'==typeof console.trace&&console.trace())),this},t.prototype.on=t.prototype.addListener,t.prototype.once=function(e,t){function s(){this.removeListener(e,s),r||(r=!0,t.apply(this,arguments))}if(!n(t))throw TypeError('listener must be a function');var r=!1;return s.listener=t,this.on(e,s),this},t.prototype.removeListener=function(e,t){var s,o,a,d;if(!n(t))throw TypeError('listener must be a function');if(!this._events||!this._events[e])return this;if(s=this._events[e],a=s.length,o=-1,s===t||n(s.listener)&&s.listener===t)delete this._events[e],this._events.removeListener&&this.emit('removeListener',e,t);else if(r(s)){for(d=a;0<d--;)if(s[d]===t||s[d].listener&&s[d].listener===t){o=d;break}if(0>o)return this;1===s.length?(s.length=0,delete this._events[e]):s.splice(o,1),this._events.removeListener&&this.emit('removeListener',e,t)}return this},t.prototype.removeAllListeners=function(e){var t,s;if(!this._events)return this;if(!this._events.removeListener)return 0===arguments.length?this._events={}:this._events[e]&&delete this._events[e],this;if(0===arguments.length){for(t in this._events)'removeListener'!==t&&this.removeAllListeners(t);return this.removeAllListeners('removeListener'),this._events={},this}if(s=this._events[e],n(s))this.removeListener(e,s);else if(s)for(;s.length;)this.removeListener(e,s[s.length-1]);return delete this._events[e],this},t.prototype.listeners=function(e){var t;return t=this._events&&this._events[e]?n(this._events[e])?[this._events[e]]:this._events[e].slice():[],t},t.prototype.listenerCount=function(e){if(this._events){var t=this._events[e];if(n(t))return 1;if(t)return t.length}return 0},t.listenerCount=function(e,t){return e.listenerCount(t)}},function(e,t,n){(function(t){var n=t.crypto||t.msCrypto,s;if(n&&n.getRandomValues){var r=new Uint8Array(16);s=function(){return n.getRandomValues(r),r}}if(!s){var o=Array(16);s=function(){for(var e=0,t;16>e;e++)0==(3&e)&&(t=4294967296*Math.random()),o[e]=255&t>>>((3&e)<<3);return o}}e.exports=s}).call(t,n(0))},function(e){for(var t=[],n=0;256>n;++n)t[n]=(n+256).toString(16).substr(1);e.exports=function(e,n){var s=n||0,r=t;return r[e[s++]]+r[e[s++]]+r[e[s++]]+r[e[s++]]+'-'+r[e[s++]]+r[e[s++]]+'-'+r[e[s++]]+r[e[s++]]+'-'+r[e[s++]]+r[e[s++]]+'-'+r[e[s++]]+r[e[s++]]+r[e[s++]]+r[e[s++]]+r[e[s++]]+r[e[s++]]}},function(e,t,n){n(6)},function(e,t,n){(function(t){e.exports=t.lostofs=n(7)}).call(t,n(0))},function(e,t,n){(function(s){(function(){'use strict';function t(e){let t=new s(e,'base64').toString(),n=t.length,r=new Uint8Array(n);for(let s=0;s<n;s++)r[s]=t.charCodeAt(s);return r.buffer}function r(e){let t='',n=new Uint8Array(e),r=n.byteLength;for(let s=0;s<r;s++)t+=String.fromCharCode(n[s]);return new s(t).toString('base64')}let o=n(12),i='function'==typeof o?o:o.default,a=n(25),d=n(2).EventEmitter,c={},l=function(){let e=function(e){void 0===e&&(e={});let t='db_name'in e?'lostofs_fs_'+e.db_name:'lostofs_fs',n=_.create(t);this.debug=!!('debug'in e)&&e.debug,this.auto_refresh=!('auto_refresh'in e)||e.auto_refresh,this.db_name=t,this.db=n,t in c||(c[t]=new a),this.locks=c[t];let s=this;this.ready_prom=new Promise(function(t,r){s.ready_ff=t,s.ready_rf=r,_.db_init_state(n,s.id).then(function(n){if('ok'===n)t(!0),s.emit('ready'),s.emit('log','info','filesystem online');else if('unformatted'===n&&'format'===e.unformatted)s.format();else if(s.emit('init_failed',n),'unformatted'===n){s.emit('log','error','filesystem unformatted/empty, call format')}else if('corrupt'===n){let e='filesystem corrupt/unformatted/invalid';s.emit('log','error',e),r(new Error(e))}else{let e='DB state "'+n+'" not recognised';s.emit('log','error',e),r(new Error(e))}}).catch(function(e){s.emit('init_error',e),s.emit('log','error','unrecognised filesystem error: '+e),r(e)})}),d.apply(this)};return e.prototype=new d,e.prototype.constructor=e,e.prototype.ready=function(){return this.ready_prom},e.prototype.destroy=function(){let e=this;return _.destroy(this.db).then(function(){return e.db=void 0,e.locks=void 0,e.ready_prom=new Promise(function(t,n){e.ready_ff=t,e.ready_rf=n}),!0})},e.prototype.format=function(){let e=this.db,t=this.db_name,n=this;return n.emit('format'),n.emit('log','info','filesystem format initiated'),_.destroy(e).then(function(){return n.db=_.create(t),n.locks=new a,e=n.db,n.locks.wait({superblock:'write'}).then(function(t){return _.mk_superblock(e).then(function(){return _.mkrootdir(e)}).then(function(){t()}).catch(function(e){throw t(),e})})}).then(function(){return n.ready_ff(!0),n.emit('log','info','filesystem online'),n.emit('ready'),!0})},e.prototype.next_inode=function(){let e=this,t=e.db;return this.locks.wait({superblock:'write'}).then(function(e){return new Promise(function(n){return _.next_inode(t).then(function(t){e(),n(t)})}).catch(function(t){throw e(),t})})},e.prototype.get=function(e){let t=this,n=this.db;return _.path_to_doc(n,e).then(function(e){return new u(t,e)})},e}(),u=function(){let e=function e(t,n){if(null!==t){if(this.constructor===e){if('file'===n.type)return new p(t,n);if('dir'===n.type)return new h(t,n);throw new Error('instantiating entity, internal error, invalid entity type "'+n.type+'" in DB document')}this.fs=t,this.ent_doc=n}};return e.prototype.inode=function(){return this.ent_doc._id},e.prototype.type=function(){return this.ent_doc.type},e.prototype.mod_time=function(){return new Date(this.ent_doc.mod_time)},e.prototype.refresh=function(){let e=this.fs,t=e.db,n=this;return _.latest_ent_doc(t,this.ent_doc).then(function(e){return n.ent_doc=e,n})},e.prototype.opt_refresh=function(){if(!this.fs.auto_refresh)return Promise.resolve(this);let e=this.fs,t=e.db;return _.latest_ent_doc(t,this.ent_doc).then((e)=>{return this.ent_doc=e,this})},e}(),p=function(){let e=function(e,t){u.apply(this,[e,t])};return e.prototype=new u(null),e.prototype.constructor=e,e.prototype.size=function(){return this.ent_doc.size},e.prototype.encoding=function(){return this.ent_doc.encoding},e.prototype.mime_type=function(){return this.ent_doc.mime_type},e.prototype.data=function(e,n){let s=this.fs,o=s.db;if(void 0!==e){void 0===n&&(n={});let s,i,a,d;return'object'==typeof e&&(e.constructor===ArrayBuffer||ArrayBuffer.isView(e))?(d=e.byteLength,e=r(e),s='arraybuffer'):d=e.length,i=n.mime_type,a=n.mod_time||new Date,_.savefile(o,this.ent_doc,e,d,a,s,i).then(()=>{return void 0===s?e:t(e)})}return this.opt_refresh().then(()=>{let e=this.ent_doc;if(void 0===e.encoding)return e.content;if('arraybuffer'===e.encoding)return t(e.content);throw new Error('encoding '+e.encoding+' unknown/unsupported')})},e}(),h=function(){let e=function(e,t){u.apply(this,[e,t])};return e.prototype=new u(null),e.prototype.constructor=e,e.prototype.ls=function(){let e=this.fs,t=e.db;return this.opt_refresh().then(function(n){let s=n.ent_doc,r=s.content;return Promise.all(Object.keys(r).map(function(n){return _.inode_to_doc(t,r[n]).then(function(t){return[n,new u(e,t)]})}))})},e.prototype.ls_names=function(){return this.opt_refresh().then(function(e){return Object.keys(e.ent_doc.content)})},e.prototype.ls_inodes=function(){return this.opt_refresh().then(function(e){let t=e.ent_doc.content;return Object.keys(t).map(function(e){return t[e]})})},e.prototype.get=function(e){let t=this.fs,n=t.db;return _.doc_path_to_doc(n,this.ent_doc,e).then(function(e){return new u(t,e)})},e.prototype.path=function(){function e(t){return _.doc_name_to_doc(n,t,'..').then(function(n){let r=Object.keys(n.content);for(let o=0;o<r.length;o++)if(n.content[r[o]]===t._id)return s=s?r[o]+'/'+s:r[o],n.content['..']===n._id?(s='/'+s,s):e(n)})}let t=this.fs,n=t.db,s='';return e(this.ent_doc)},e.prototype.move=function(e,t){let n=this.fs,s=n.db,r=this;return this.opt_refresh().then(function(r){let o,i;if(-1===t.indexOf('/'))i=t,o=Promise.resolve(r);else{let e=/^(.*)\/([^\/]+)$/.exec(t);if(e)i=e[2],o=n.get(e[1]);else return Promise.reject(new Error('destination must be a new file path, not a directory'))}return o.then(function(o){return _.move(s,r.ent_doc,e,o.ent_doc,i).then(function(){return n.emit('move',r,e,o,i,t),!0})})})},e.prototype.remove=function(e){let t=this.fs,n=t.db,s=this.ent_doc;return'.'===e?Promise.reject(new Error('cannot delete "." (current directory)')):'..'===e?Promise.reject(new Error('cannot delete ".." (parent directory)')):e in s.content?this.opt_refresh().then(function(r){return n.get(s.content[e]).then(function(e){if('dir'===e.type&&2<Object.keys(e.content).length)throw new Error('directory not empty');return n.remove(e)}).then(function(){return delete s.content[e],n.put(s).then(function(e){return n.get(e.id)})}).then(function(n){return r.ent_doc=n,t.emit('remove',r,e),!0})}):Promise.reject(new Error('no such file or directory; "'+e+'" not found'))},e.prototype.mkdir=function(t,n){void 0===n&&(n={});let s=this.fs,r=s.db;if(n.free_name){let e=this;return this.free_name(t).then(function(t){return n.free_name=!1,e.mkdir(t,n)})}return this.opt_refresh().then(function(n){let o=n.ent_doc;return t in o.content?Promise.reject(new Error('mkdir "'+t+'" failed, file or directory already exists')):s.next_inode().then(function(e){let i={};return i[n.inode()]='write',s.locks.wait(i).then(function(n){return new Promise(function(s){_.mkdir(r,e,o,t).then(function(e){n(),s(e)})}).catch(function(e){throw n(),e})})}).then(function(r){let o=new e(s,r);return s.emit('mkdir',n,t,o),s.emit('create',n,t,o),o})})},e.prototype.mkfile=function(e,t,n){void 0===n&&(n={});let s=this.fs,o=s.db;if(n.free_name){let s=this;return this.free_name(e).then(function(e){return n.free_name=!1,s.mkfile(e,t,n)})}return this.opt_refresh().then(function(i){let a=i.ent_doc;if(e in a.content)throw new Error('creating file "'+e+'" failed, file or directory already exists');let d,c,l,u;return'object'==typeof t&&(t.constructor===ArrayBuffer||ArrayBuffer.isView(t))?(u=t.byteLength,t=r(t),d='arraybuffer'):u=t.length,c=n.mime_type,l=n.mod_time||new Date,s.next_inode().then(function(n){let r={};return r[i.inode()]='write',s.locks.wait(r).then(function(s){return new Promise(function(r){_.mkfile(o,n,a,e,t,u,l,d,c).then(function(e){s(),r(e)})}).catch(function(e){throw s(),e})})}).then(function(t){let n=new p(s,t);return s.emit('mkfile',i,e,n),s.emit('create',i,e,n),n})})},e.prototype.free_name=function(e){let t=this.fs,n=/^(\S+.*)\.(\S{3,4})$/.exec(e),s;return n&&(e=n[1],s=n[2]),this.opt_refresh().then(function(t){let n=t.ent_doc,r=n.content;if(void 0===s){if(!(e in r))return e;let t=2;for(;e+'('+t+')'in r;)t++;return e+'('+t+')'}if(!(e+'.'+s in r))return e+'.'+s;let o=2;for(;e+'('+o+').'+s in r;)o++;return e+'('+o+').'+s})},e}(),_={create:function(e){return new i(e)},destroy:function(e){return e===void 0?Promise.resolve(!0):e.destroy()},mk_superblock:function(e){return e.put({_id:'s_inode',next:2})},db_init_state:function(e){return e.get('i_1').then(function(){return e.get('s_inode')}).then(function(){return'ok'}).catch(function(t){return 404===t.status?e.info().then(function(e){return 0===e.doc_count?'unformatted':'corrupt'}):'corrupt'})},mkrootdir:function(e){return e.put({_id:'i_1',type:'dir',mod_time:new Date,content:{".":'i_1',"..":'i_1'}})},latest_ent_doc:function(e,t){return e.get(t._id)},inode_to_doc:function(e,t){return e.get(t)},path_to_doc:function(e,t){return'/'===t.charAt(0)?e.get('i_1').then(function(n){return _.doc_path_to_doc(e,n,t)}):Promise.reject(new Error('path "'+t+'" does not begin with /'))},doc_path_to_doc:function(e,t,n){if(''===n)return t;let s=n.indexOf('/');return 0===s?_.doc_path_to_doc(e,t,n.substr(1)):-1===s?_.doc_name_to_doc(e,t,n):_.doc_name_to_doc(e,t,n.substr(0,s)).then(function(t){return _.doc_path_to_doc(e,t,n.substr(s+1))})},doc_name_to_doc:function(e,t,n){return'dir'===t.type?n in t.content?e.get(t.content[n]):Promise.reject(new Error('"'+n+'" not found')):Promise.reject(new Error('not a directory'))},next_inode:function(e){return e.get('s_inode').then(function(t){let n=t.next;return t.next=n+1,e.put(t).then(function(){return'i_'+n})})},mkdir:function(e,t,n,s){let r={_id:t,type:'dir',mod_time:new Date,content:{".":t,"..":n._id}};return e.put(r).then(function(t){return r._rev=t.rev,n.content[s]=r._id,e.put(n)}).then(function(){return r})},mkfile:function(e,t,n,s,r,o,i,a,d){let c={_id:t,type:'file',size:o,mod_time:i||new Date,links:1,content:r,encoding:a,mime_type:d};return e.put(c).then(function(t){return c._rev=t.rev,n.content[s]=c._id,e.put(n).then(function(){return c})})},savefile:function(e,t,n,s,r,o,i){return'file'===t.type?(t.size=s,t.mod_time=r||new Date,t.content=n,t.encoding=o,t.mime_type=i,e.put(t).then(()=>{return e.get(t._id)})):Promise.reject(new Error('cannot save the content of a directory'))},move:function(e,t,n,s,r){return n in t.content?r in s.content?Promise.reject(new Error('"'+r+'" already exists')):new Promise(function(r,o){function i(n){return _.doc_name_to_doc(e,n,'..').then(function(e){return n._id===e._id?r(!0):e._id===t._id?o(new Error('cannot move an entity to a subdirectory of itself')):i(e)})}return t._id===s._id?r(!0):e.get(t.content[n]).then(function(e){return'file'===e.type?r(!0):i(s)})}).then(function(){return new Promise(function(o){return t._id===s._id?void(t.content[r]=t.content[n],delete t.content[n],e.put(t).then(function(e){o(e)})):(s.content[r]=t.content[n],e.put(s).then(function(){delete t.content[n],e.put(t).then(function(e){o(e)})}))}).then(function(t){return e.get(t.id)})}):Promise.reject(new Error('"'+n+'" not found'))}};e.exports={fs:l,ent:u,dir:h,file:p},e.exports.test={dbop:_}})(t)}).call(t,n(8).Buffer)},function(e,t,n){'use strict';var s=Math.floor,r=Math.pow,o=Math.min,a=String.fromCharCode;(function(e){function i(){return c.TYPED_ARRAY_SUPPORT?2147483647:1073741823}function d(e,t){if(i()<t)throw new RangeError('Invalid typed array length');return c.TYPED_ARRAY_SUPPORT?(e=new Uint8Array(t),e.__proto__=c.prototype):(null===e&&(e=new c(t)),e.length=t),e}function c(e,t,n){if(!c.TYPED_ARRAY_SUPPORT&&!(this instanceof c))return new c(e,t,n);if('number'==typeof e){if('string'==typeof t)throw new Error('If encoding is specified then the first argument must be a string');return h(this,e)}return l(this,e,t,n)}function l(e,t,n,s){if('number'==typeof t)throw new TypeError('"value" argument must not be a number');return'undefined'!=typeof ArrayBuffer&&t instanceof ArrayBuffer?f(e,t,n,s):'string'==typeof t?_(e,t,n):m(e,t)}function u(e){if('number'!=typeof e)throw new TypeError('"size" argument must be a number');else if(0>e)throw new RangeError('"size" argument must not be negative')}function p(e,t,n,s){return u(t),0>=t?d(e,t):void 0===n?d(e,t):'string'==typeof s?d(e,t).fill(n,s):d(e,t).fill(n)}function h(e,t){if(u(t),e=d(e,0>t?0:0|y(t)),!c.TYPED_ARRAY_SUPPORT)for(var n=0;n<t;++n)e[n]=0;return e}function _(e,t,n){if(('string'!=typeof n||''===n)&&(n='utf8'),!c.isEncoding(n))throw new TypeError('"encoding" must be a valid string encoding');var s=0|v(t,n);e=d(e,s);var r=e.write(t,n);return r!==s&&(e=e.slice(0,r)),e}function g(e,t){var n=0>t.length?0:0|y(t.length);e=d(e,n);for(var s=0;s<n;s+=1)e[s]=255&t[s];return e}function f(e,t,n,s){if(t.byteLength,0>n||t.byteLength<n)throw new RangeError('\'offset\' is out of bounds');if(t.byteLength<n+(s||0))throw new RangeError('\'length\' is out of bounds');return t=void 0===n&&void 0===s?new Uint8Array(t):void 0===s?new Uint8Array(t,n):new Uint8Array(t,n,s),c.TYPED_ARRAY_SUPPORT?(e=t,e.__proto__=c.prototype):e=g(e,t),e}function m(e,t){if(c.isBuffer(t)){var n=0|y(t.length);return(e=d(e,n),0===e.length)?e:(t.copy(e,0,0,n),e)}if(t){if('undefined'!=typeof ArrayBuffer&&t.buffer instanceof ArrayBuffer||'length'in t)return'number'!=typeof t.length||J(t.length)?d(e,0):g(e,t);if('Buffer'===t.type&&te(t.data))return g(e,t.data)}throw new TypeError('First argument must be a string, Buffer, ArrayBuffer, Array, or array-like object.')}function y(e){if(e>=i())throw new RangeError('Attempt to allocate Buffer larger than maximum size: 0x'+i().toString(16)+' bytes');return 0|e}function v(e,t){if(c.isBuffer(e))return e.length;if('undefined'!=typeof ArrayBuffer&&'function'==typeof ArrayBuffer.isView&&(ArrayBuffer.isView(e)||e instanceof ArrayBuffer))return e.byteLength;'string'!=typeof e&&(e=''+e);var n=e.length;if(0===n)return 0;for(var s=!1;;)switch(t){case'ascii':case'latin1':case'binary':return n;case'utf8':case'utf-8':case void 0:return V(e).length;case'ucs2':case'ucs-2':case'utf16le':case'utf-16le':return 2*n;case'hex':return n>>>1;case'base64':return K(e).length;default:if(s)return V(e).length;t=(''+t).toLowerCase(),s=!0;}}function b(e,t,n){var s=!1;if((void 0===t||0>t)&&(t=0),t>this.length)return'';if((void 0===n||n>this.length)&&(n=this.length),0>=n)return'';if(n>>>=0,t>>>=0,n<=t)return'';for(e||(e='utf8');;)switch(e){case'hex':return D(this,t,n);case'utf8':case'utf-8':return j(this,t,n);case'ascii':return O(this,t,n);case'latin1':case'binary':return I(this,t,n);case'base64':return C(this,t,n);case'ucs2':case'ucs-2':case'utf16le':case'utf-16le':return P(this,t,n);default:if(s)throw new TypeError('Unknown encoding: '+e);e=(e+'').toLowerCase(),s=!0;}}function E(e,t,n){var s=e[t];e[t]=e[n],e[n]=s}function k(e,t,n,s,r){if(0===e.length)return-1;if('string'==typeof n?(s=n,n=0):2147483647<n?n=2147483647:-2147483648>n&&(n=-2147483648),n=+n,isNaN(n)&&(n=r?0:e.length-1),0>n&&(n=e.length+n),n>=e.length){if(r)return-1;n=e.length-1}else if(0>n)if(r)n=0;else return-1;if('string'==typeof t&&(t=c.from(t,s)),c.isBuffer(t))return 0===t.length?-1:w(e,t,n,s,r);if('number'==typeof t)return t&=255,c.TYPED_ARRAY_SUPPORT&&'function'==typeof Uint8Array.prototype.indexOf?r?Uint8Array.prototype.indexOf.call(e,t,n):Uint8Array.prototype.lastIndexOf.call(e,t,n):w(e,[t],n,s,r);throw new TypeError('val must be string, number or Buffer')}function w(e,t,n,s,r){function o(e,t){return 1==a?e[t]:e.readUInt16BE(t*a)}var a=1,d=e.length,c=t.length;if(void 0!==s&&(s=(s+'').toLowerCase(),'ucs2'===s||'ucs-2'===s||'utf16le'===s||'utf-16le'===s)){if(2>e.length||2>t.length)return-1;a=2,d/=2,c/=2,n/=2}var l;if(r){var i=-1;for(l=n;l<d;l++)if(o(e,l)!==o(t,-1==i?0:l-i))-1!=i&&(l-=l-i),i=-1;else if(-1==i&&(i=l),l-i+1===c)return i*a}else for(n+c>d&&(n=d-c),l=n;0<=l;l--){for(var u=!0,p=0;p<c;p++)if(o(e,l+p)!==o(t,p)){u=!1;break}if(u)return l}return-1}function S(e,t,n,s){n=+n||0;var r=e.length-n;s?(s=+s,s>r&&(s=r)):s=r;var o=t.length;if(0!=o%2)throw new TypeError('Invalid hex string');s>o/2&&(s=o/2);for(var a=0,i;a<s;++a){if(i=parseInt(t.substr(2*a,2),16),isNaN(i))return a;e[n+a]=i}return a}function q(e,t,n,s){return Q(V(t,e.length-n),e,n,s)}function x(e,t,n,s){return Q(X(t),e,n,s)}function A(e,t,n,s){return x(e,t,n,s)}function T(e,t,n,s){return Q(K(t),e,n,s)}function L(e,t,n,s){return Q(G(t,e.length-n),e,n,s)}function C(e,t,n){return 0===t&&n===e.length?Z.fromByteArray(e):Z.fromByteArray(e.slice(t,n))}function j(e,t,n){n=o(e.length,n);for(var s=[],r=t;r<n;){var i=e[r],a=null,d=239<i?4:223<i?3:191<i?2:1;if(r+d<=n){var c,l,u,p;1==d?128>i&&(a=i):2==d?(c=e[r+1],128==(192&c)&&(p=(31&i)<<6|63&c,127<p&&(a=p))):3==d?(c=e[r+1],l=e[r+2],128==(192&c)&&128==(192&l)&&(p=(15&i)<<12|(63&c)<<6|63&l,2047<p&&(55296>p||57343<p)&&(a=p))):4==d?(c=e[r+1],l=e[r+2],u=e[r+3],128==(192&c)&&128==(192&l)&&128==(192&u)&&(p=(15&i)<<18|(63&c)<<12|(63&l)<<6|63&u,65535<p&&1114112>p&&(a=p))):void 0}null===a?(a=65533,d=1):65535<a&&(a-=65536,s.push(55296|1023&a>>>10),a=56320|1023&a),s.push(a),r+=d}return R(s)}function R(e){var t=e.length;if(t<=ne)return a.apply(String,e);for(var n='',s=0;s<t;)n+=a.apply(String,e.slice(s,s+=ne));return n}function O(e,t,n){var s='';n=o(e.length,n);for(var r=t;r<n;++r)s+=a(127&e[r]);return s}function I(e,t,n){var s='';n=o(e.length,n);for(var r=t;r<n;++r)s+=a(e[r]);return s}function D(e,t,n){var s=e.length;(!t||0>t)&&(t=0),(!n||0>n||n>s)&&(n=s);for(var r='',o=t;o<n;++o)r+=H(e[o]);return r}function P(e,t,n){for(var s=e.slice(t,n),r='',o=0;o<s.length;o+=2)r+=a(s[o]+256*s[o+1]);return r}function N(e,t,n){if(0!=e%1||0>e)throw new RangeError('offset is not uint');if(e+t>n)throw new RangeError('Trying to access beyond buffer length')}function B(e,t,n,s,r,o){if(!c.isBuffer(e))throw new TypeError('"buffer" argument must be a Buffer instance');if(t>r||t<o)throw new RangeError('"value" argument is out of bounds');if(n+s>e.length)throw new RangeError('Index out of range')}function U(e,t,n,s){0>t&&(t=65535+t+1);for(var r=0,i=o(e.length-n,2);r<i;++r)e[n+r]=(t&255<<8*(s?r:1-r))>>>8*(s?r:1-r)}function $(e,t,n,s){0>t&&(t=4294967295+t+1);for(var r=0,i=o(e.length-n,4);r<i;++r)e[n+r]=255&t>>>8*(s?r:3-r)}function F(e,t,n,s){if(n+s>e.length)throw new RangeError('Index out of range');if(0>n)throw new RangeError('Index out of range')}function M(e,t,n,s,r){return r||F(e,t,n,4,3.4028234663852886e38,-3.4028234663852886e38),ee.write(e,t,n,s,23,4),n+4}function Y(e,t,n,s,r){return r||F(e,t,n,8,1.7976931348623157e308,-1.7976931348623157e308),ee.write(e,t,n,s,52,8),n+8}function z(e){if(e=W(e).replace(se,''),2>e.length)return'';for(;0!=e.length%4;)e+='=';return e}function W(e){return e.trim?e.trim():e.replace(/^\s+|\s+$/g,'')}function H(e){return 16>e?'0'+e.toString(16):e.toString(16)}function V(e,t){t=t||Infinity;for(var n=e.length,s=null,r=[],o=0,i;o<n;++o){if(i=e.charCodeAt(o),55295<i&&57344>i){if(!s){if(56319<i){-1<(t-=3)&&r.push(239,191,189);continue}else if(o+1===n){-1<(t-=3)&&r.push(239,191,189);continue}s=i;continue}if(56320>i){-1<(t-=3)&&r.push(239,191,189),s=i;continue}i=(s-55296<<10|i-56320)+65536}else s&&-1<(t-=3)&&r.push(239,191,189);if(s=null,128>i){if(0>(t-=1))break;r.push(i)}else if(2048>i){if(0>(t-=2))break;r.push(192|i>>6,128|63&i)}else if(65536>i){if(0>(t-=3))break;r.push(224|i>>12,128|63&i>>6,128|63&i)}else if(1114112>i){if(0>(t-=4))break;r.push(240|i>>18,128|63&i>>12,128|63&i>>6,128|63&i)}else throw new Error('Invalid code point')}return r}function X(e){for(var t=[],n=0;n<e.length;++n)t.push(255&e.charCodeAt(n));return t}function G(e,t){for(var n=[],s=0,r,o,i;s<e.length&&!(0>(t-=2));++s)r=e.charCodeAt(s),o=r>>8,i=r%256,n.push(i),n.push(o);return n}function K(e){return Z.toByteArray(z(e))}function Q(e,t,n,s){for(var r=0;r<s&&!(r+n>=t.length||r>=e.length);++r)t[r+n]=e[r];return r}function J(e){return e!==e}/*!
 * The buffer module from node.js, for the browser.
 *
 * @author   Feross Aboukhadijeh <feross@feross.org> <http://feross.org>
 * @license  MIT
 */var Z=n(9),ee=n(10),te=n(11);t.Buffer=c,t.SlowBuffer=function(e){return+e!=e&&(e=0),c.alloc(+e)},t.INSPECT_MAX_BYTES=50,c.TYPED_ARRAY_SUPPORT=e.TYPED_ARRAY_SUPPORT===void 0?function(){try{var e=new Uint8Array(1);return e.__proto__={__proto__:Uint8Array.prototype,foo:function(){return 42}},42===e.foo()&&'function'==typeof e.subarray&&0===e.subarray(1,1).byteLength}catch(t){return!1}}():e.TYPED_ARRAY_SUPPORT,t.kMaxLength=i(),c.poolSize=8192,c._augment=function(e){return e.__proto__=c.prototype,e},c.from=function(e,t,n){return l(null,e,t,n)},c.TYPED_ARRAY_SUPPORT&&(c.prototype.__proto__=Uint8Array.prototype,c.__proto__=Uint8Array,'undefined'!=typeof Symbol&&Symbol.species&&c[Symbol.species]===c&&Object.defineProperty(c,Symbol.species,{value:null,configurable:!0})),c.alloc=function(e,t,n){return p(null,e,t,n)},c.allocUnsafe=function(e){return h(null,e)},c.allocUnsafeSlow=function(e){return h(null,e)},c.isBuffer=function(e){return!!(null!=e&&e._isBuffer)},c.compare=function(e,t){if(!c.isBuffer(e)||!c.isBuffer(t))throw new TypeError('Arguments must be Buffers');if(e===t)return 0;for(var n=e.length,s=t.length,r=0,i=o(n,s);r<i;++r)if(e[r]!==t[r]){n=e[r],s=t[r];break}return n<s?-1:s<n?1:0},c.isEncoding=function(e){switch((e+'').toLowerCase()){case'hex':case'utf8':case'utf-8':case'ascii':case'latin1':case'binary':case'base64':case'ucs2':case'ucs-2':case'utf16le':case'utf-16le':return!0;default:return!1;}},c.concat=function(e,t){if(!te(e))throw new TypeError('"list" argument must be an Array of Buffers');if(0===e.length)return c.alloc(0);var n;if(t===void 0)for(t=0,n=0;n<e.length;++n)t+=e[n].length;var s=c.allocUnsafe(t),r=0;for(n=0;n<e.length;++n){var o=e[n];if(!c.isBuffer(o))throw new TypeError('"list" argument must be an Array of Buffers');o.copy(s,r),r+=o.length}return s},c.byteLength=v,c.prototype._isBuffer=!0,c.prototype.swap16=function(){var e=this.length;if(0!=e%2)throw new RangeError('Buffer size must be a multiple of 16-bits');for(var t=0;t<e;t+=2)E(this,t,t+1);return this},c.prototype.swap32=function(){var e=this.length;if(0!=e%4)throw new RangeError('Buffer size must be a multiple of 32-bits');for(var t=0;t<e;t+=4)E(this,t,t+3),E(this,t+1,t+2);return this},c.prototype.swap64=function(){var e=this.length;if(0!=e%8)throw new RangeError('Buffer size must be a multiple of 64-bits');for(var t=0;t<e;t+=8)E(this,t,t+7),E(this,t+1,t+6),E(this,t+2,t+5),E(this,t+3,t+4);return this},c.prototype.toString=function(){var e=0|this.length;return 0==e?'':0===arguments.length?j(this,0,e):b.apply(this,arguments)},c.prototype.equals=function(e){if(!c.isBuffer(e))throw new TypeError('Argument must be a Buffer');return this===e||0===c.compare(this,e)},c.prototype.inspect=function(){var e='',n=t.INSPECT_MAX_BYTES;return 0<this.length&&(e=this.toString('hex',0,n).match(/.{2}/g).join(' '),this.length>n&&(e+=' ... ')),'<Buffer '+e+'>'},c.prototype.compare=function(e,t,n,s,r){if(!c.isBuffer(e))throw new TypeError('Argument must be a Buffer');if(void 0===t&&(t=0),void 0===n&&(n=e?e.length:0),void 0===s&&(s=0),void 0===r&&(r=this.length),0>t||n>e.length||0>s||r>this.length)throw new RangeError('out of range index');if(s>=r&&t>=n)return 0;if(s>=r)return-1;if(t>=n)return 1;if(t>>>=0,n>>>=0,s>>>=0,r>>>=0,this===e)return 0;for(var a=r-s,d=n-t,l=o(a,d),u=this.slice(s,r),p=e.slice(t,n),h=0;h<l;++h)if(u[h]!==p[h]){a=u[h],d=p[h];break}return a<d?-1:d<a?1:0},c.prototype.includes=function(e,t,n){return-1!==this.indexOf(e,t,n)},c.prototype.indexOf=function(e,t,n){return k(this,e,t,n,!0)},c.prototype.lastIndexOf=function(e,t,n){return k(this,e,t,n,!1)},c.prototype.write=function(e,t,n,s){if(void 0===t)s='utf8',n=this.length,t=0;else if(void 0===n&&'string'==typeof t)s=t,n=this.length,t=0;else if(isFinite(t))t|=0,isFinite(n)?(n|=0,void 0===s&&(s='utf8')):(s=n,n=void 0);else throw new Error('Buffer.write(string, encoding, offset[, length]) is no longer supported');var r=this.length-t;if((void 0===n||n>r)&&(n=r),0<e.length&&(0>n||0>t)||t>this.length)throw new RangeError('Attempt to write outside buffer bounds');s||(s='utf8');for(var o=!1;;)switch(s){case'hex':return S(this,e,t,n);case'utf8':case'utf-8':return q(this,e,t,n);case'ascii':return x(this,e,t,n);case'latin1':case'binary':return A(this,e,t,n);case'base64':return T(this,e,t,n);case'ucs2':case'ucs-2':case'utf16le':case'utf-16le':return L(this,e,t,n);default:if(o)throw new TypeError('Unknown encoding: '+s);s=(''+s).toLowerCase(),o=!0;}},c.prototype.toJSON=function(){return{type:'Buffer',data:Array.prototype.slice.call(this._arr||this,0)}};var ne=4096;c.prototype.slice=function(e,t){var n=this.length;e=~~e,t=t===void 0?n:~~t,0>e?(e+=n,0>e&&(e=0)):e>n&&(e=n),0>t?(t+=n,0>t&&(t=0)):t>n&&(t=n),t<e&&(t=e);var s;if(c.TYPED_ARRAY_SUPPORT)s=this.subarray(e,t),s.__proto__=c.prototype;else{var r=t-e;s=new c(r,void 0);for(var o=0;o<r;++o)s[o]=this[o+e]}return s},c.prototype.readUIntLE=function(e,t,n){e|=0,t|=0,n||N(e,t,this.length);for(var s=this[e],r=1,o=0;++o<t&&(r*=256);)s+=this[e+o]*r;return s},c.prototype.readUIntBE=function(e,t,n){e|=0,t|=0,n||N(e,t,this.length);for(var s=this[e+--t],r=1;0<t&&(r*=256);)s+=this[e+--t]*r;return s},c.prototype.readUInt8=function(e,t){return t||N(e,1,this.length),this[e]},c.prototype.readUInt16LE=function(e,t){return t||N(e,2,this.length),this[e]|this[e+1]<<8},c.prototype.readUInt16BE=function(e,t){return t||N(e,2,this.length),this[e]<<8|this[e+1]},c.prototype.readUInt32LE=function(e,t){return t||N(e,4,this.length),(this[e]|this[e+1]<<8|this[e+2]<<16)+16777216*this[e+3]},c.prototype.readUInt32BE=function(e,t){return t||N(e,4,this.length),16777216*this[e]+(this[e+1]<<16|this[e+2]<<8|this[e+3])},c.prototype.readIntLE=function(e,t,n){e|=0,t|=0,n||N(e,t,this.length);for(var s=this[e],o=1,a=0;++a<t&&(o*=256);)s+=this[e+a]*o;return o*=128,s>=o&&(s-=r(2,8*t)),s},c.prototype.readIntBE=function(e,t,n){e|=0,t|=0,n||N(e,t,this.length);for(var s=t,o=1,i=this[e+--s];0<s&&(o*=256);)i+=this[e+--s]*o;return o*=128,i>=o&&(i-=r(2,8*t)),i},c.prototype.readInt8=function(e,t){return t||N(e,1,this.length),128&this[e]?-1*(255-this[e]+1):this[e]},c.prototype.readInt16LE=function(e,t){t||N(e,2,this.length);var n=this[e]|this[e+1]<<8;return 32768&n?4294901760|n:n},c.prototype.readInt16BE=function(e,t){t||N(e,2,this.length);var n=this[e+1]|this[e]<<8;return 32768&n?4294901760|n:n},c.prototype.readInt32LE=function(e,t){return t||N(e,4,this.length),this[e]|this[e+1]<<8|this[e+2]<<16|this[e+3]<<24},c.prototype.readInt32BE=function(e,t){return t||N(e,4,this.length),this[e]<<24|this[e+1]<<16|this[e+2]<<8|this[e+3]},c.prototype.readFloatLE=function(e,t){return t||N(e,4,this.length),ee.read(this,e,!0,23,4)},c.prototype.readFloatBE=function(e,t){return t||N(e,4,this.length),ee.read(this,e,!1,23,4)},c.prototype.readDoubleLE=function(e,t){return t||N(e,8,this.length),ee.read(this,e,!0,52,8)},c.prototype.readDoubleBE=function(e,t){return t||N(e,8,this.length),ee.read(this,e,!1,52,8)},c.prototype.writeUIntLE=function(e,t,n,s){if(e=+e,t|=0,n|=0,!s){var o=r(2,8*n)-1;B(this,e,t,n,o,0)}var a=1,d=0;for(this[t]=255&e;++d<n&&(a*=256);)this[t+d]=255&e/a;return t+n},c.prototype.writeUIntBE=function(e,t,n,s){if(e=+e,t|=0,n|=0,!s){var o=r(2,8*n)-1;B(this,e,t,n,o,0)}var a=n-1,i=1;for(this[t+a]=255&e;0<=--a&&(i*=256);)this[t+a]=255&e/i;return t+n},c.prototype.writeUInt8=function(e,t,n){return e=+e,t|=0,n||B(this,e,t,1,255,0),c.TYPED_ARRAY_SUPPORT||(e=s(e)),this[t]=255&e,t+1},c.prototype.writeUInt16LE=function(e,t,n){return e=+e,t|=0,n||B(this,e,t,2,65535,0),c.TYPED_ARRAY_SUPPORT?(this[t]=255&e,this[t+1]=e>>>8):U(this,e,t,!0),t+2},c.prototype.writeUInt16BE=function(e,t,n){return e=+e,t|=0,n||B(this,e,t,2,65535,0),c.TYPED_ARRAY_SUPPORT?(this[t]=e>>>8,this[t+1]=255&e):U(this,e,t,!1),t+2},c.prototype.writeUInt32LE=function(e,t,n){return e=+e,t|=0,n||B(this,e,t,4,4294967295,0),c.TYPED_ARRAY_SUPPORT?(this[t+3]=e>>>24,this[t+2]=e>>>16,this[t+1]=e>>>8,this[t]=255&e):$(this,e,t,!0),t+4},c.prototype.writeUInt32BE=function(e,t,n){return e=+e,t|=0,n||B(this,e,t,4,4294967295,0),c.TYPED_ARRAY_SUPPORT?(this[t]=e>>>24,this[t+1]=e>>>16,this[t+2]=e>>>8,this[t+3]=255&e):$(this,e,t,!1),t+4},c.prototype.writeIntLE=function(e,t,n,s){if(e=+e,t|=0,!s){var o=r(2,8*n-1);B(this,e,t,n,o-1,-o)}var a=0,i=1,d=0;for(this[t]=255&e;++a<n&&(i*=256);)0>e&&0==d&&0!==this[t+a-1]&&(d=1),this[t+a]=255&(e/i>>0)-d;return t+n},c.prototype.writeIntBE=function(e,t,n,s){if(e=+e,t|=0,!s){var o=r(2,8*n-1);B(this,e,t,n,o-1,-o)}var a=n-1,i=1,d=0;for(this[t+a]=255&e;0<=--a&&(i*=256);)0>e&&0==d&&0!==this[t+a+1]&&(d=1),this[t+a]=255&(e/i>>0)-d;return t+n},c.prototype.writeInt8=function(e,t,n){return e=+e,t|=0,n||B(this,e,t,1,127,-128),c.TYPED_ARRAY_SUPPORT||(e=s(e)),0>e&&(e=255+e+1),this[t]=255&e,t+1},c.prototype.writeInt16LE=function(e,t,n){return e=+e,t|=0,n||B(this,e,t,2,32767,-32768),c.TYPED_ARRAY_SUPPORT?(this[t]=255&e,this[t+1]=e>>>8):U(this,e,t,!0),t+2},c.prototype.writeInt16BE=function(e,t,n){return e=+e,t|=0,n||B(this,e,t,2,32767,-32768),c.TYPED_ARRAY_SUPPORT?(this[t]=e>>>8,this[t+1]=255&e):U(this,e,t,!1),t+2},c.prototype.writeInt32LE=function(e,t,n){return e=+e,t|=0,n||B(this,e,t,4,2147483647,-2147483648),c.TYPED_ARRAY_SUPPORT?(this[t]=255&e,this[t+1]=e>>>8,this[t+2]=e>>>16,this[t+3]=e>>>24):$(this,e,t,!0),t+4},c.prototype.writeInt32BE=function(e,t,n){return e=+e,t|=0,n||B(this,e,t,4,2147483647,-2147483648),0>e&&(e=4294967295+e+1),c.TYPED_ARRAY_SUPPORT?(this[t]=e>>>24,this[t+1]=e>>>16,this[t+2]=e>>>8,this[t+3]=255&e):$(this,e,t,!1),t+4},c.prototype.writeFloatLE=function(e,t,n){return M(this,e,t,!0,n)},c.prototype.writeFloatBE=function(e,t,n){return M(this,e,t,!1,n)},c.prototype.writeDoubleLE=function(e,t,n){return Y(this,e,t,!0,n)},c.prototype.writeDoubleBE=function(e,t,n){return Y(this,e,t,!1,n)},c.prototype.copy=function(e,t,n,s){if(n||(n=0),s||0===s||(s=this.length),t>=e.length&&(t=e.length),t||(t=0),0<s&&s<n&&(s=n),s===n)return 0;if(0===e.length||0===this.length)return 0;if(0>t)throw new RangeError('targetStart out of bounds');if(0>n||n>=this.length)throw new RangeError('sourceStart out of bounds');if(0>s)throw new RangeError('sourceEnd out of bounds');s>this.length&&(s=this.length),e.length-t<s-n&&(s=e.length-t+n);var r=s-n,o;if(this===e&&n<t&&t<s)for(o=r-1;0<=o;--o)e[o+t]=this[o+n];else if(1e3>r||!c.TYPED_ARRAY_SUPPORT)for(o=0;o<r;++o)e[o+t]=this[o+n];else Uint8Array.prototype.set.call(e,this.subarray(n,n+r),t);return r},c.prototype.fill=function(e,t,n,s){if('string'==typeof e){if('string'==typeof t?(s=t,t=0,n=this.length):'string'==typeof n&&(s=n,n=this.length),1===e.length){var r=e.charCodeAt(0);256>r&&(e=r)}if(void 0!==s&&'string'!=typeof s)throw new TypeError('encoding must be a string');if('string'==typeof s&&!c.isEncoding(s))throw new TypeError('Unknown encoding: '+s)}else'number'==typeof e&&(e&=255);if(0>t||this.length<t||this.length<n)throw new RangeError('Out of range index');if(n<=t)return this;t>>>=0,n=n===void 0?this.length:n>>>0,e||(e=0);var o;if('number'==typeof e)for(o=t;o<n;++o)this[o]=e;else{var i=c.isBuffer(e)?e:V(new c(e,s).toString()),a=i.length;for(o=0;o<n-t;++o)this[o+t]=i[o%a]}return this};var se=/[^+\/0-9A-Za-z-_]/g}).call(t,n(0))},function(e,t){'use strict';function n(e){var t=e.length;if(0<t%4)throw new Error('Invalid string. Length must be a multiple of 4');var n=e.indexOf('=');-1===n&&(n=t);var s=n===t?0:4-n%4;return[n,s]}function s(e,t,n){return 3*(t+n)/4-n}function r(e){return a[63&e>>18]+a[63&e>>12]+a[63&e>>6]+a[63&e]}function o(e,t,n){for(var s=[],o=t,i;o<n;o+=3)i=(16711680&e[o]<<16)+(65280&e[o+1]<<8)+(255&e[o+2]),s.push(r(i));return s.join('')}t.byteLength=function(e){var t=n(e),s=t[0],r=t[1];return 3*(s+r)/4-r},t.toByteArray=function(e){for(var t=n(e),r=t[0],o=t[1],a=new c(s(e,r,o)),l=0,u=0<o?r-4:r,p=0,i;p<u;p+=4)i=d[e.charCodeAt(p)]<<18|d[e.charCodeAt(p+1)]<<12|d[e.charCodeAt(p+2)]<<6|d[e.charCodeAt(p+3)],a[l++]=255&i>>16,a[l++]=255&i>>8,a[l++]=255&i;return 2===o&&(i=d[e.charCodeAt(p)]<<2|d[e.charCodeAt(p+1)]>>4,a[l++]=255&i),1===o&&(i=d[e.charCodeAt(p)]<<10|d[e.charCodeAt(p+1)]<<4|d[e.charCodeAt(p+2)]>>2,a[l++]=255&i>>8,a[l++]=255&i),a},t.fromByteArray=function(e){for(var t=e.length,n=t%3,s=[],r=16383,d=0,i=t-n,c;d<i;d+=r)s.push(o(e,d,d+r>i?i:d+r));return 1==n?(c=e[t-1],s.push(a[c>>2]+a[63&c<<4]+'==')):2==n&&(c=(e[t-2]<<8)+e[t-1],s.push(a[c>>10]+a[63&c>>4]+a[63&c<<2]+'=')),s.join('')};for(var a=[],d=[],c='undefined'==typeof Uint8Array?Array:Uint8Array,l='ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/',u=0,i=l.length;u<i;++u)a[u]=l[u],d[l.charCodeAt(u)]=u;d[45]=62,d[95]=63},function(e,t){var n=Math.pow;t.read=function(t,r,o,a,c){var l=8*c-a-1,u=(1<<l)-1,p=u>>1,h=-7,_=o?c-1:0,i=o?-1:1,d=t[r+_],s,e;for(_+=i,s=d&(1<<-h)-1,d>>=-h,h+=l;0<h;s=256*s+t[r+_],_+=i,h-=8);for(e=s&(1<<-h)-1,s>>=-h,h+=a;0<h;e=256*e+t[r+_],_+=i,h-=8);if(0===s)s=1-p;else{if(s===u)return e?NaN:(d?-1:1)*Infinity;e+=n(2,a),s-=p}return(d?-1:1)*e*n(2,s-a)},t.write=function(t,r,o,a,l,u){var p=8*u-l-1,h=(1<<p)-1,_=h>>1,g=23===l?5.960464477539063e-8-6.617444900424222e-24:0,f=a?0:u-1,i=a?1:-1,d=0>r||0===r&&0>1/r?1:0,s,y,m;for(r=Math.abs(r),isNaN(r)||r===Infinity?(y=isNaN(r)?1:0,s=h):(s=Math.floor(Math.log(r)/Math.LN2),1>r*(m=n(2,-s))&&(s--,m*=2),r+=1<=s+_?g/m:g*n(2,1-_),2<=r*m&&(s++,m/=2),s+_>=h?(y=0,s=h):1<=s+_?(y=(r*m-1)*n(2,l),s+=_):(y=r*n(2,_-1)*n(2,l),s=0));8<=l;t[o+f]=255&y,f+=i,y/=256,l-=8);for(s=s<<l|y,p+=l;0<p;t[o+f]=255&s,f+=i,s/=256,p-=8);t[o+f-i]|=128*d}},function(e){var t={}.toString;e.exports=Array.isArray||function(e){return'[object Array]'==t.call(e)}},function(e,t,n){'use strict';var s=Math.ceil,r=Math.min,o=String.fromCharCode;Object.defineProperty(t,'__esModule',{value:!0}),function(e){function a(e){return'undefined'!=typeof ArrayBuffer&&e instanceof ArrayBuffer||'undefined'!=typeof Blob&&e instanceof Blob}function i(e){if('function'==typeof e.slice)return e.slice(0);var t=new ArrayBuffer(e.byteLength),n=new Uint8Array(t),s=new Uint8Array(e);return n.set(s),t}function d(e){if(e instanceof ArrayBuffer)return i(e);var t=e.size,n=e.type;return'function'==typeof e.slice?e.slice(0,t,n):e.webkitSlice(0,t,n)}function c(e){var t=Object.getPrototypeOf(e);if(null===t)return!0;var n=t.constructor;return'function'==typeof n&&n instanceof n&&mr.call(n)==yr}function l(e){var t,n,s;if(!e||'object'!=typeof e)return e;if(Array.isArray(e)){for(t=[],n=0,s=e.length;n<s;n++)t[n]=l(e[n]);return t}if(e instanceof Date)return e.toISOString();if(a(e))return d(e);if(!c(e))return e;for(n in t={},e)if(Object.prototype.hasOwnProperty.call(e,n)){var r=l(e[n]);'undefined'!=typeof r&&(t[n]=r)}return t}function u(e){var t=!1;return tr()(function(n){if(t)throw new Error('once called more than once');else t=!0,e.apply(this,n)})}function p(e){return tr()(function(t){t=l(t);var n=this,s='function'==typeof t[t.length-1]&&t.pop(),r=new fr(function(s,r){var o;try{var i=u(function(e,t){e?r(e):s(t)});t.push(i),o=e.apply(n,t),o&&'function'==typeof o.then&&s(o)}catch(t){r(t)}});return s&&r.then(function(e){s(null,e)},s),r})}function h(e,t,n){if(e.constructor.listeners('debug').length){for(var s=['api',e.name,t],r=0;r<n.length-1;r++)s.push(n[r]);e.constructor.emit('debug',s);var o=n[n.length-1];n[n.length-1]=function(n,s){var r=['api',e.name,t];r=r.concat(n?['error',n]:['success',s]),e.constructor.emit('debug',r),o(n,s)}}}function _(e,t){return p(tr()(function(n){if(this._closed)return fr.reject(new Error('database is closed'));if(this._destroyed)return fr.reject(new Error('database is destroyed'));var s=this;return h(s,e,n),this.taskqueue.isReady?t.apply(this,n):new fr(function(t,r){s.taskqueue.addTask(function(o){o?r(o):t(s[e].apply(s,n))})})}))}function g(e){return'$'+e}function f(e){return e.substring(1)}function m(){this._store={}}function y(e){if(this._store=new m,e&&Array.isArray(e))for(var t=0,n=e.length;t<n;t++)this.add(e[t])}function v(e,t){for(var n={},s=0,r=t.length,o;s<r;s++)o=t[s],o in e&&(n[o]=e[o]);return n}function b(e){return e}function E(e){return[{ok:e}]}function k(e,t,n){function s(){var e=[];_.forEach(function(t){t.docs.forEach(function(n){e.push({id:t.id,docs:[n]})})}),n(null,{results:e})}function o(){++h===p&&s()}function a(e,t,n){_[e]={id:t,docs:n},o()}function d(){if(!(f>=g.length)){var e=r(f+Er,g.length),t=g.slice(f,e);c(t,f),f+=t.length}}function c(n,s){n.forEach(function(n,r){var o=u.get(n),i=v(o[0],['atts_since','attachments']);i.open_revs=o.map(function(e){return e.rev}),i.open_revs=i.open_revs.filter(b);var c=b;0===i.open_revs.length&&(delete i.open_revs,c=E),['revs','attachments','binary','ajax','latest'].forEach(function(e){e in t&&(i[e]=t[e])}),e.get(n,i,function(e,t){var o;o=e?[{error:e}]:c(t),a(s+r,n,o),d()})})}var l=t.docs,u=new br;l.forEach(function(e){u.has(e.id)?u.get(e.id).push(e):u.set(e.id,[e])});var p=u.size,h=0,_=Array(p),g=[];u.forEach(function(e,t){g.push(t)});var f=0;d()}function w(){return'undefined'!=typeof chrome&&'undefined'!=typeof chrome.storage&&'undefined'!=typeof chrome.storage.local}function S(){return kr}function q(t){w()?chrome.storage.onChanged.addListener(function(n){null!=n.db_name&&t.emit(n.dbName.newValue)}):S()&&('undefined'==typeof addEventListener?window.attachEvent('storage',function(n){t.emit(n.key)}):addEventListener('storage',function(n){t.emit(n.key)}))}function x(){rr.EventEmitter.call(this),this._listeners={},q(this)}function A(e){if('undefined'!=typeof console&&'function'==typeof console[e]){var t=Array.prototype.slice.call(arguments,1);console[e].apply(console,t)}}function T(e,t){var n=6e5;e=parseInt(e,10)||0,t=parseInt(t,10),t!==t||t<=e?t=(e||1)<<1:++t,t>n&&(e=n>>1,t=n);var s=Math.random(),r=t-e;return~~(r*s+e)}function L(e){var t=0;return e||(t=2e3),T(e,t)}function C(e,t){A('info','The above '+e+' is totally normal. '+t)}function j(e,t,n){Error.call(this,n),this.status=e,this.name=t,this.message=n,this.error=!0}function R(e,t){function n(t){for(var n in e)'function'!=typeof e[n]&&(this[n]=e[n]);void 0!==t&&(this.reason=t)}return n.prototype=j.prototype,new n(t)}function O(e){if('object'!=typeof e){var t=e;e=Or,e.data=t}return'error'in e&&'conflict'===e.error&&(e.name='conflict',e.status=409),'name'in e||(e.name=e.error||'unknown'),'status'in e||(e.status=500),'message'in e||(e.message=e.message||e.reason),e}function I(e,t,n){try{return!e(t,n)}catch(e){var s='Filter function threw: '+e.toString();return R(Br,s)}}function D(e){var t={},n=e.filter&&'function'==typeof e.filter;return t.query=e.query_params,function(s){s.doc||(s.doc={});var r=n&&I(e.filter,s.doc,t);if('object'==typeof r)return r;if(r)return!1;if(!e.include_docs)delete s.doc;else if(!e.attachments)for(var o in s.doc._attachments)s.doc._attachments.hasOwnProperty(o)&&(s.doc._attachments[o].stub=!0);return!0}}function P(e){for(var t=[],n=0,s=e.length;n<s;n++)t=t.concat(e[n]);return t}function N(e){var t;if(e?'string'==typeof e?/^_/.test(e)&&!/^_(design|local)/.test(e)&&(t=R(jr)):t=R(Lr):t=R(Cr),t)throw t}function B(e){return'boolean'==typeof e._remote?e._remote:!('function'!=typeof e.type)&&(A('warn','db.type() is deprecated and will be removed in a future version of PouchDB'),'http'===e.type())}function U(e,t){return'listenerCount'in e?e.listenerCount(t):rr.EventEmitter.listenerCount(e,t)}function $(e){if(!e)return null;var t=e.split('/');return 2===t.length?t:1===t.length?[e,e]:null}function F(e){var t=$(e);return t?t.join('/'):null}function M(e){for(var t=Jr.exec(e),n={},s=14;s--;){var r=Gr[s],o=t[s]||'',i=-1!==['user','password'].indexOf(r);n[r]=i?decodeURIComponent(o):o}return n[Kr]={},n[Gr[12]].replace(Qr,function(e,t,s){t&&(n[Kr][t]=s)}),n}function Y(e,t){var n=[],s=[];for(var r in t)t.hasOwnProperty(r)&&(n.push(r),s.push(t[r]));return n.push(e),Function.apply(null,n).apply(null,s)}function z(e,t,n){return new fr(function(s,r){e.get(t,function(o,i){if(o){if(404!==o.status)return r(o);i={}}var a=i._rev,d=n(i);return d?void(d._id=t,d._rev=a,s(W(e,d,n))):s({updated:!1,rev:a})})})}function W(e,t,n){return e.put(t).then(function(e){return{updated:!0,rev:e.rev}},function(s){if(409!==s.status)throw s;return z(e,t._id,n)})}function H(){return cr.a.v4().replace(/-/g,'').toLowerCase()}function V(e){for(var t=e.rev_tree.slice(),n,s,r,o;o=t.pop();){var a=o.ids,d=a[2],c=o.pos;if(d.length){for(var l=0,i=d.length;l<i;l++)t.push({pos:c+1,ids:d[l]});continue}var u=!!a[1].deleted,p=a[0];(!n||(r===u?s===c?n<p:s<c:r))&&(n=p,s=c,r=u)}return s+'-'+n}function X(e,t){for(var n=e.slice(),s;s=n.pop();)for(var r=s.pos,o=s.ids,a=o[2],d=t(0===a.length,r,o[0],s.ctx,o[1]),c=0,i=a.length;c<i;c++)n.push({pos:r+1,ids:a[c],ctx:d})}function G(e,t){return e.pos-t.pos}function K(e){var t=[];X(e,function(e,n,s,r,o){e&&t.push({rev:n+'-'+s,pos:n,opts:o})}),t.sort(G).reverse();for(var n=0,s=t.length;n<s;n++)delete t[n].pos;return t}function Q(e){for(var t=V(e),n=K(e.rev_tree),s=[],r=0,o=n.length,i;r<o;r++)i=n[r],i.rev===t||i.opts.deleted||s.push(i.rev);return s}function J(e){var t=[];return X(e.rev_tree,function(e,n,s,r,o){'available'!==o.status||e||(t.push(n+'-'+s),o.status='missing')}),t}function Z(e){for(var t=[],n=e.slice(),s;s=n.pop();){var r=s.pos,o=s.ids,a=o[0],d=o[1],c=o[2],l=0===c.length,u=s.history?s.history.slice():[];u.push({id:a,opts:d}),l&&t.push({pos:r+1-u.length,ids:u});for(var p=0,i=c.length;p<i;p++)n.push({pos:r+1,ids:c[p],history:u})}return t.reverse()}function ee(e,t){return e.pos-t.pos}function te(e,t,n){for(var s=0,r=e.length,o;s<r;)o=s+r>>>1,0>n(e[o],t)?s=o+1:r=o;return s}function ne(e,t,n){var s=te(e,t,n);e.splice(s,0,t)}function se(e,t){for(var n=t,s=e.length,r,o;n<s;n++){var i=e[n],a=[i.id,i.opts,[]];o?(o[2].push(a),o=a):r=o=a}return r}function re(e,t){return e[0]<t[0]?-1:1}function oe(e,t){for(var n=[{tree1:e,tree2:t}],s=!1;0<n.length;){var r=n.pop(),o=r.tree1,a=r.tree2;(o[1].status||a[1].status)&&(o[1].status='available'===o[1].status||'available'===a[1].status?'available':'missing');for(var d=0;d<a[2].length;d++){if(!o[2][0]){s='new_leaf',o[2][0]=a[2][d];continue}for(var i=!1,c=0;c<o[2].length;c++)o[2][c][0]===a[2][d][0]&&(n.push({tree1:o[2][c],tree2:a[2][d]}),i=!0);i||(s='new_branch',ne(o[2],a[2][d],re))}}return{conflicts:s,tree:e}}function ie(e,t,n){var s=[],r=!1,o=!1,a;if(!e.length)return{tree:[t],conflicts:'new_leaf'};for(var d=0,i=e.length,c;d<i;d++)if(c=e[d],c.pos===t.pos&&c.ids[0]===t.ids[0])a=oe(c.ids,t.ids),s.push({pos:c.pos,ids:a.tree}),r=r||a.conflicts,o=!0;else if(!0!==n){var l=c.pos<t.pos?c:t,u=c.pos<t.pos?t:c,p=u.pos-l.pos,h=[],_=[];for(_.push({ids:l.ids,diff:p,parent:null,parentIdx:null});0<_.length;){var g=_.pop();if(0===g.diff){g.ids[0]===u.ids[0]&&h.push(g);continue}for(var f=g.ids[2],m=0,y=f.length;m<y;m++)_.push({ids:f[m],diff:g.diff-1,parent:g.ids,parentIdx:m})}var v=h[0];v?(a=oe(v.ids,u.ids),v.parent[2][v.parentIdx]=a.tree,s.push({pos:l.pos,ids:l.ids}),r=r||a.conflicts,o=!0):s.push(c)}else s.push(c);return o||s.push(t),s.sort(ee),{tree:s,conflicts:r||'internal_node'}}function ae(e,t){for(var n=Z(e),r=0,o=n.length,i,a;r<o;r++){var d=n[r],c=d.ids,l;if(c.length>t){i||(i={});var u=c.length-t;l={pos:d.pos+u,ids:se(c,u)};for(var p=0,s;p<u;p++)s=d.pos+p+'-'+c[p].id,i[s]=!0}else l={pos:d.pos,ids:se(c,0)};a=a?ie(a,l,!0).tree:[l]}return i&&X(a,function(e,t,n){delete i[t+'-'+n]}),{tree:a,revs:i?Object.keys(i):[]}}function de(e,t,n){var s=ie(e,t),r=ae(s.tree,n);return{tree:r.tree,stemmedRevs:r.revs,conflicts:s.conflicts}}function ce(e,t){for(var n=e.slice(),s=t.split('-'),r=parseInt(s[0],10),o=s[1],a;a=n.pop();){if(a.pos===r&&a.ids[0]===o)return!0;for(var d=a.ids[2],c=0,i=d.length;c<i;c++)n.push({pos:a.pos+1,ids:d[c]})}return!1}function le(e){return e.ids}function ue(e,t){t||(t=V(e));for(var n=t.substring(t.indexOf('-')+1),s=e.rev_tree.map(le),r;r=s.pop();){if(r[0]===n)return!!r[1].deleted;s=s.concat(r[2])}}function pe(e){return /^_local/.test(e)}function he(e,t){for(var n=t.rev_tree.slice(),s;s=n.pop();){var r=s.pos,o=s.ids,a=o[0],d=o[1],c=o[2],u=0===c.length,p=s.history?s.history.slice():[];if(p.push({id:a,pos:r,opts:d}),u)for(var h=0,i=p.length;h<i;h++){var _=p[h],g=_.pos+'-'+_.id;if(g===e)return r+'-'+a}for(var f=0,m=c.length;f<m;f++)n.push({pos:r+1,ids:c[f],history:p})}throw new Error('Unable to resolve latest revision for id '+t.id+', rev '+e)}function _e(e,t,n,s){try{e.emit('change',t,n,s)}catch(t){A('error','Error in .on("change", function):',t)}}function ge(e,t,n){function s(){r.cancel()}rr.EventEmitter.call(this);var r=this;this.db=e,t=t?l(t):{};var o=t.complete=u(function(t,n){t?0<U(r,'error')&&r.emit('error',t):r.emit('complete',n),r.removeAllListeners(),e.removeListener('destroyed',s)});n&&(r.on('complete',function(e){n(null,e)}),r.on('error',n)),e.once('destroyed',s),t.onChange=function(e,t,n){r.isCancelled||_e(r,e,t,n)};var i=new fr(function(e,n){t.complete=function(t,s){t?n(t):e(s)}});r.once('cancel',function(){e.removeListener('destroyed',s),t.complete(null,{status:'cancelled'})}),this.then=i.then.bind(i),this['catch']=i['catch'].bind(i),this.then(function(e){o(null,e)},o),e.taskqueue.isReady?r.validateChanges(t):e.taskqueue.addTask(function(e){e?t.complete(e):r.isCancelled?r.emit('cancel'):r.validateChanges(t)})}function fe(e,t,n){var s=[{rev:e._rev}];'all_docs'===n.style&&(s=K(t.rev_tree).map(function(e){return{rev:e.rev}}));var r={id:t.id,changes:s,doc:e};return ue(t,e._rev)&&(r.deleted=!0),n.conflicts&&(r.doc._conflicts=Q(t),!r.doc._conflicts.length&&delete r.doc._conflicts),r}function me(e,t){return e<t?-1:e>t?1:0}function ye(e,t){return function(n,s){n||s[0]&&s[0].error?(n=n||s[0],n.docId=t,e(n)):e(null,s.length?s[0]:s)}}function ve(e){for(var t=0,n;t<e.length;t++)if(n=e[t],n._deleted)delete n._attachments;else if(n._attachments)for(var s=Object.keys(n._attachments),r=0,o;r<s.length;r++)o=s[r],n._attachments[o]=v(n._attachments[o],['data','digest','content_type','length','revpos','stub'])}function be(e,t){var n=me(e._id,t._id);if(0!==n)return n;var s=e._revisions?e._revisions.start:0,r=t._revisions?t._revisions.start:0;return me(s,r)}function Ee(e){var t={},n=[];return X(e,function(e,s,r,o){var i=s+'-'+r;return e&&(t[i]=0),void 0!==o&&n.push({from:o,to:i}),i}),n.reverse(),n.forEach(function(e){t[e.from]=void 0===t[e.from]?1+t[e.to]:r(t[e.from],1+t[e.to])}),t}function ke(e){var t='limit'in e?e.keys.slice(e.skip,e.limit+e.skip):0<e.skip?e.keys.slice(e.skip):e.keys;e.keys=t,e.skip=0,delete e.limit,e.descending&&(t.reverse(),e.descending=!1)}function we(e){var t=e._compactionQueue[0],n=t.opts,s=t.callback;e.get('_local/compaction').catch(function(){return!1}).then(function(t){t&&t.last_seq&&(n.last_seq=t.last_seq),e._compact(n,function(t,n){t?s(t):s(null,n),sr()(function(){e._compactionQueue.shift(),e._compactionQueue.length&&we(e)})})})}function Se(e){return!('_'!==e.charAt(0))&&e+' is not a valid attachment name, attachment names cannot start with \'_\''}function qe(){rr.EventEmitter.call(this)}function xe(){this.isReady=!1,this.failed=!1,this.queue=[]}function Ae(e,t){var n=e.match(/([a-z-]*):\/\/(.*)/);if(n)return{name:/https?/.test(n[1])?n[1]+'://'+n[2]:n[2],adapter:n[1]};var s=Le.adapters,r=Le.preferredAdapters,o=Le.prefix,a=t.adapter;if(!a)for(var d=0;d<r.length;++d){if(a=r[d],'idb'===a&&'websql'in s&&S()&&localStorage['_pouch__websqldb_'+o+e]){A('log','PouchDB is downgrading "'+e+'" to WebSQL to avoid data loss, because it was already opened with WebSQL.');continue}break}var i=s[a],c=i&&'use_prefix'in i?i.use_prefix:!0;return{name:c?o+e:e,adapter:a}}function Te(e){function t(t){e.removeListener('closed',n),t||e.constructor.emit('destroyed',e.name)}function n(){e.removeListener('destroyed',t),e.constructor.emit('unref',e)}e.once('destroyed',t),e.once('closed',n),e.constructor.emit('ref',e)}function Le(e,t){if(!(this instanceof Le))return new Le(e,t);var n=this;if(t=t||{},e&&'object'==typeof e&&(t=e,e=t.name,delete t.name),this.__opts=t=l(t),n.auto_compaction=t.auto_compaction,n.prefix=Le.prefix,'string'!=typeof e)throw new Error('Missing/invalid DB name');var s=(t.prefix||'')+e,r=Ae(s,t);if(t.name=r.name,t.adapter=t.adapter||r.adapter,n.name=e,n._adapter=t.adapter,Le.emit('debug',['adapter','Picked adapter: ',t.adapter]),!Le.adapters[t.adapter]||!Le.adapters[t.adapter].valid())throw new Error('Invalid Adapter: '+t.adapter);qe.call(n),n.taskqueue=new xe,n.adapter=t.adapter,Le.adapters[t.adapter].call(n,t,function(e){return e?n.taskqueue.fail(e):void(Te(n),n.emit('created',n),Le.emit('created',n.name),n.taskqueue.ready(n))})}function Ce(e,t){for(var n=e,s=0,r=t.length,o;s<r&&(o=t[s],n=n[o],!!n);s++);return n}function je(e,t){return e<t?-1:e>t?1:0}function Re(e){for(var t=[],n='',s=0,r=e.length,o;s<r;s++)o=e[s],'.'===o?0<s&&'\\'===e[s-1]?n=n.substring(0,n.length-1)+'.':(t.push(n),n=''):n+=o;return t.push(n),t}function Oe(e){return-1<to.indexOf(e)}function Ie(e){return Object.keys(e)[0]}function De(e){return e[Ie(e)]}function Pe(e){var t={};return e.forEach(function(e){Object.keys(e).forEach(function(n){var s=e[n];if('object'!=typeof s&&(s={$eq:s}),Oe(n))t[n]=s instanceof Array?s.map(function(e){return Pe([e])}):Pe([s]);else{var r=t[n]=t[n]||{};Object.keys(s).forEach(function(e){var t=s[e];return'$gt'===e||'$gte'===e?Ne(e,t,r):'$lt'===e||'$lte'===e?Be(e,t,r):'$ne'===e?Ue(t,r):'$eq'===e?$e(t,r):void(r[e]=t)})}})}),t}function Ne(e,t,n){'undefined'!=typeof n.$eq||('undefined'==typeof n.$gte?'undefined'==typeof n.$gt?n[e]=t:'$gte'===e?t>n.$gt&&(delete n.$gt,n.$gte=t):t>n.$gt&&(n.$gt=t):'$gte'===e?t>n.$gte&&(n.$gte=t):t>=n.$gte&&(delete n.$gte,n.$gt=t))}function Be(e,t,n){'undefined'!=typeof n.$eq||('undefined'==typeof n.$lte?'undefined'==typeof n.$lt?n[e]=t:'$lte'===e?t<n.$lt&&(delete n.$lt,n.$lte=t):t<n.$lt&&(n.$lt=t):'$lte'===e?t<n.$lte&&(n.$lte=t):t<=n.$lte&&(delete n.$lte,n.$lt=t))}function Ue(e,t){'$ne'in t?t.$ne.push(e):t.$ne=[e]}function $e(e,t){delete t.$gt,delete t.$gte,delete t.$lt,delete t.$lte,delete t.$ne,t.$eq=e}function Fe(e){var t=l(e),n=!1;'$and'in t&&(t=Pe(t.$and),n=!0),['$or','$nor'].forEach(function(e){e in t&&t[e].forEach(function(e){for(var t=Object.keys(e),n=0;n<t.length;n++){var s=t[n],r=e[s];('object'!=typeof r||null===r)&&(e[s]={$eq:r})}})}),'$not'in t&&(t.$not=Pe([t.$not]));for(var s=Object.keys(t),r=0;r<s.length;r++){var o=s[r],i=t[o];'object'!=typeof i||null===i?i={$eq:i}:'$ne'in i&&!n&&(i.$ne=[i.$ne]),t[o]=i}return t}function Me(e,t,n){for(var s='',r=n-e.length;s.length<r;)s+=t;return s}function Ye(e,t,n){var s=Me(e,t,n);return s+e}function ze(e,t){if(e===t)return 0;e=We(e),t=We(t);var n=et(e),s=et(t);if(0!=n-s)return n-s;switch(typeof e){case'number':return e-t;case'boolean':return e<t?-1:1;case'string':return Je(e,t);}return Array.isArray(e)?Qe(e,t):Ze(e,t)}function We(e){switch(typeof e){case'undefined':return null;case'number':return e===Infinity||e===-Infinity||isNaN(e)?null:e;case'object':var t=e;if(Array.isArray(e)){var n=e.length;e=Array(n);for(var s=0;s<n;s++)e[s]=We(t[s])}else{if(e instanceof Date)return e.toJSON();if(null!==e)for(var r in e={},t)if(t.hasOwnProperty(r)){var o=t[r];'undefined'!=typeof o&&(e[r]=We(o))}}}return e}function He(e){if(null!==e)switch(typeof e){case'boolean':return e?1:0;case'number':return tt(e);case'string':return e.replace(/\u0002/g,'\x02\x02').replace(/\u0001/g,'\x01\x02').replace(/\u0000/g,'\x01\x01');case'object':var t=Array.isArray(e),n=t?e:Object.keys(e),s=-1,r=n.length,o='';if(t)for(;++s<r;)o+=Ve(n[s]);else for(;++s<r;){var i=n[s];o+=Ve(i)+Ve(e[i])}return o;}return''}function Ve(e){return e=We(e),et(e)+ro+He(e)+'\0'}function Xe(e,t){var n=t,s='1'===e[t],r;if(s)r=0,t++;else{var o='0'===e[t];t++;var i='',a=e.substring(t,t+so),d=parseInt(a,10)+no;for(o&&(d=-d),t+=so;;){var c=e[t];if('\0'===c)break;else i+=c;t++}i=i.split('.'),r=1===i.length?parseInt(i,10):parseFloat(i[0]+'.'+i[1]),o&&(r-=10),0!==d&&(r=parseFloat(r+'e'+d))}return{num:r,length:t-n}}function Ge(e,t){var n=e.pop();if(t.length){var s=t[t.length-1];n===s.element&&(t.pop(),s=t[t.length-1]);var r=s.element,o=s.index;if(Array.isArray(r))r.push(n);else if(o===e.length-2){var i=e.pop();r[i]=n}else e.push(n)}}function Ke(e){for(var t=[],n=[],s=0;;){var r=e[s++];if('\0'===r){if(1===t.length)return t.pop();Ge(t,n);continue}switch(r){case'1':t.push(null);break;case'2':t.push('1'===e[s]),s++;break;case'3':var o=Xe(e,s);t.push(o.num),s+=o.length;break;case'4':for(var i='';;){var a=e[s];if('\0'===a)break;i+=a,s++}i=i.replace(/\u0001\u0001/g,'\0').replace(/\u0001\u0002/g,'\x01').replace(/\u0002\u0002/g,'\x02'),t.push(i);break;case'5':var d={element:[],index:t.length};t.push(d.element),n.push(d);break;case'6':var c={element:{},index:t.length};t.push(c.element),n.push(c);break;default:throw new Error('bad collationIndex or unexpectedly reached end of input: '+r);}}}function Qe(e,t){for(var n=r(e.length,t.length),s=0,o;s<n;s++)if(o=ze(e[s],t[s]),0!==o)return o;return e.length===t.length?0:e.length>t.length?1:-1}function Je(e,t){return e===t?0:e>t?1:-1}function Ze(e,t){for(var n=Object.keys(e),s=Object.keys(t),o=r(n.length,s.length),a=0,i;a<o;a++){if(i=ze(n[a],s[a]),0!==i)return i;if(i=ze(e[n[a]],t[s[a]]),0!==i)return i}return n.length===s.length?0:n.length>s.length?1:-1}function et(e){var t=['boolean','number','string','object'].indexOf(typeof e);return~t?null===e?1:Array.isArray(e)?5:3>t?t+2:t+3:Array.isArray(e)?5:void 0}function tt(e){if(0===e)return'1';var t=e.toExponential().split(/e\+?/),n=parseInt(t[1],10),s=0>e,r=s?'0':'2',o=(s?-n:n)-no,i=Ye(o.toString(),'0',so);r+=ro+i;var a=Math.abs(parseFloat(t[0]));s&&(a=10-a);var d=a.toFixed(20);return d=d.replace(/\.?0+$/,''),r+=ro+d,r}function nt(e){function t(t){return e.map(function(e){var n=Ie(e),s=Re(n),r=Ce(t,s);return r})}return function(e,n){var s=t(e.doc),r=t(n.doc),o=ze(s,r);return 0===o?je(e.doc._id,n.doc._id):o}}function st(e,t,n){if(e=e.filter(function(e){return rt(e.doc,t.selector,n)}),t.sort){var s=nt(t.sort);e=e.sort(s),'string'!=typeof t.sort[0]&&'desc'===De(t.sort[0])&&(e=e.reverse())}if('limit'in t||'skip'in t){var r=t.skip||0,o=('limit'in t?t.limit:e.length)+r;e=e.slice(r,o)}return e}function rt(e,t,n){return n.every(function(n){var s=t[n],r=Re(n),o=Ce(e,r);return Oe(n)?it(n,s,e):ot(s,e,r,o)})}function ot(e,t,n,s){return!e||Object.keys(e).every(function(r){var o=e[r];return at(r,t,o,n,s)})}function it(e,t,n){return'$or'===e?t.some(function(e){return rt(n,e,Object.keys(e))}):'$not'===e?!rt(n,t,Object.keys(t)):!t.find(function(e){return rt(n,e,Object.keys(e))})}function at(e,t,n,s,r){if(!oo[e])throw new Error('unknown operator "'+e+'" - should be one of $eq, $lte, $lt, $gt, $gte, $exists, $ne, $in, $nin, $size, $mod, $regex, $elemMatch, $type, $allMatch or $all');return oo[e](t,n,s,r)}function dt(e){return'undefined'!=typeof e&&null!==e}function ct(e){return'undefined'!=typeof e}function lt(e,t){var n=t[0],s=t[1];if(0===n)throw new Error('Bad divisor, cannot divide by zero');if(parseInt(n,10)!==n)throw new Error('Divisor is not an integer');if(parseInt(s,10)!==s)throw new Error('Modulus is not an integer');return parseInt(e,10)===e&&e%n===s}function ut(e,t){return t.some(function(t){return e instanceof Array?-1<e.indexOf(t):e===t})}function pt(e,t){return t.every(function(t){return-1<e.indexOf(t)})}function ht(e,t){return e.length===t}function _t(e,t){var n=new RegExp(t);return n.test(e)}function gt(e,t){switch(t){case'null':return null===e;case'boolean':return'boolean'==typeof e;case'number':return'number'==typeof e;case'string':return'string'==typeof e;case'array':return e instanceof Array;case'object':return'[object Object]'==={}.toString.call(e);}throw new Error(t+' not supported as a type.Please use one of object, string, array, number, boolean or null.')}function ft(e,t){if('object'!=typeof t)throw new Error('Selector error: expected a JSON object');t=Fe(t);var n=st([{doc:e}],{selector:t},Object.keys(t));return n&&1===n.length}function mt(e){return Y('"use strict";\nreturn '+e+';',{})}function yt(e){var t=['return function(doc) {','  "use strict";','  var emitted = false;','  var emit = function (a, b) {','    emitted = true;','  };','  var view = '+e+';','  view(doc);','  if (emitted) {','    return true;','  }','};'].join('\n');return Y(t,{})}function vt(e,t){if(e.selector&&e.filter&&'_selector'!==e.filter){var n='string'==typeof e.filter?e.filter:'function';return t(new Error('selector invalid for filter "'+n+'"'))}t()}function bt(e){e.view&&!e.filter&&(e.filter='_view'),e.selector&&!e.filter&&(e.filter='_selector'),e.filter&&'string'==typeof e.filter&&('_view'===e.filter?e.view=F(e.view):e.filter=F(e.filter))}function Et(e,t){return t.filter&&'string'==typeof t.filter&&!t.doc_ids&&!B(e.db)}function kt(e,t){var n=t.complete;if('_view'===t.filter){if(!t.view||'string'!=typeof t.view){var s=R(Br,'`view` filter parameter not found or invalid.');return n(s)}var r=$(t.view);e.db.get('_design/'+r[0],function(s,o){if(e.isCancelled)return n(null,{status:'cancelled'});if(s)return n(O(s));var i=o&&o.views&&o.views[r[1]]&&o.views[r[1]].map;return i?void(t.filter=yt(i),e.doChanges(t)):n(R(Ar,o.views?'missing json key: '+r[1]:'missing json key: views'))})}else if(t.selector)t.filter=function(e){return ft(e,t.selector)},e.doChanges(t);else{var o=$(t.filter);e.db.get('_design/'+o[0],function(s,r){if(e.isCancelled)return n(null,{status:'cancelled'});if(s)return n(O(s));var i=r&&r.filters&&r.filters[o[1]];return i?void(t.filter=mt(i),e.doChanges(t)):n(R(Ar,r&&r.filters?'missing json key: '+o[1]:'missing json key: filters'))})}}function wt(e){return e.reduce(function(e,t){return e[t]=!0,e},{})}function St(e){if(!/^\d+-./.test(e))return R(Wr);var t=e.indexOf('-'),n=e.substring(0,t),s=e.substring(t+1);return{prefix:parseInt(n,10),id:s}}function qt(e,t){for(var n=e.start-e.ids.length+1,s=e.ids,r=[s[0],t,[]],o=1,i=s.length;o<i;o++)r=[s[o],{status:'missing'},[r]];return[{pos:n,ids:r}]}function xt(e,t){var n={status:'available'},s,r,o;if(e._deleted&&(n.deleted=!0),t){if(e._id||(e._id=Zr()),r=H(),e._rev){if(o=St(e._rev),o.error)return o;e._rev_tree=[{pos:o.prefix,ids:[o.id,{status:'missing'},[[r,n,[]]]]}],s=o.prefix+1}else e._rev_tree=[{pos:1,ids:[r,n,[]]}],s=1;}else if(e._revisions&&(e._rev_tree=qt(e._revisions,n),s=e._revisions.start,r=e._revisions.ids[0]),!e._rev_tree){if(o=St(e._rev),o.error)return o;s=o.prefix,r=o.id,e._rev_tree=[{pos:s,ids:[r,n,[]]}]}N(e._id),e._rev=s+'-'+r;var i={metadata:{},data:{}};for(var a in e)if(Object.prototype.hasOwnProperty.call(e,a)){var d='_'===a[0];if(d&&!io[a]){var c=R(Nr,a);throw c.message=Nr.message+': '+a,c}else d&&!ao[a]?i.metadata[a.slice(1)]=e[a]:i.data[a]=e[a]}return i}function At(e,t){e=e||[],t=t||{};try{return new Blob(e,t)}catch(o){if('TypeError'!==o.name)throw o;for(var n='undefined'==typeof BlobBuilder?'undefined'==typeof MSBlobBuilder?'undefined'==typeof MozBlobBuilder?WebKitBlobBuilder:MozBlobBuilder:MSBlobBuilder:BlobBuilder,s=new n,r=0;r<e.length;r+=1)s.append(e[r]);return s.getBlob(t.type)}}function Tt(e){for(var t=e.length,n=new ArrayBuffer(t),s=new Uint8Array(n),r=0;r<t;r++)s[r]=e.charCodeAt(r);return n}function Lt(e,t){return At([Tt(e)],{type:t})}function Ct(e,t){return Lt(co(e),t)}function jt(e){for(var t='',n=new Uint8Array(e),s=n.byteLength,r=0;r<s;r++)t+=o(n[r]);return t}function Rt(e,t){if('undefined'==typeof FileReader)return t(jt(new FileReaderSync().readAsArrayBuffer(e)));var n=new FileReader,s='function'==typeof n.readAsBinaryString;n.onloadend=function(n){var e=n.target.result||'';return s?t(e):void t(jt(e))},s?n.readAsBinaryString(e):n.readAsArrayBuffer(e)}function Ot(e,t){Rt(e,function(e){t(e)})}function It(e,t){Ot(e,function(e){t(lo(e))})}function Dt(e,t){if('undefined'==typeof FileReader)return t(new FileReaderSync().readAsArrayBuffer(e));var n=new FileReader;n.onloadend=function(n){var e=n.target.result||new ArrayBuffer(0);t(e)},n.readAsArrayBuffer(e)}function Pt(e){return lo(e)}function Nt(e,t,n){return e.webkitSlice?e.webkitSlice(t,n):e.slice(t,n)}function Bt(e,t,n,s,r){(0<n||s<t.size)&&(t=Nt(t,n,s)),Dt(t,function(t){e.append(t),r()})}function Ut(e,t,n,s,r){(0<n||s<t.length)&&(t=t.substring(n,s)),e.appendBinary(t),r()}function $t(e,t){function n(){uo(i)}function o(){var e=p.end(!0),n=Pt(e);t(n),p.destroy()}function i(){var t=u*c,s=t+c;u++,u<l?h(p,e,t,s,n):h(p,e,t,s,o)}var a='string'==typeof e,d=a?e.length:e.size,c=r(po,d),l=s(d/c),u=0,p=a?new hr.a:new hr.a.ArrayBuffer,h=a?Ut:Bt;i()}function Ft(e){return hr.a.hash(e)}function Mt(e){try{return co(e)}catch(n){var t=R(Ir,'Attachment is not a valid base64 string');return{error:t}}}function Yt(e,t,n){var s=Mt(e.data);return s.error?n(s.error):void(e.length=s.length,e.data='blob'===t?Lt(s,e.content_type):'base64'===t?lo(s):s,$t(s,function(t){e.digest='md5-'+t,n()}))}function zt(e,t,n){$t(e.data,function(s){e.digest='md5-'+s,e.length=e.data.size||e.data.length||0,'binary'===t?Ot(e.data,function(t){e.data=t,n()}):'base64'===t?It(e.data,function(t){e.data=t,n()}):n()})}function Wt(e,t,n){return e.stub?n():void('string'==typeof e.data?Yt(e,t,n):zt(e,t,n))}function Ht(e,t,n){function s(){r++,e.length===r&&(o?n(o):n())}if(!e.length)return n();var r=0,o;e.forEach(function(e){function n(e){o=e,i++,i===r.length&&s()}var r=e.data&&e.data._attachments?Object.keys(e.data._attachments):[],i=0;if(!r.length)return s();for(var a in e.data._attachments)e.data._attachments.hasOwnProperty(a)&&Wt(e.data._attachments[a],t,n)})}function Vt(e,t,n,s,r,o,i,a){if(ce(t.rev_tree,n.metadata.rev))return s[r]=n,o();var d=t.winningRev||V(t),c='deleted'in t?t.deleted:ue(t,d),l='deleted'in n.metadata?n.metadata.deleted:ue(n.metadata),u=/^1-/.test(n.metadata.rev);if(c&&!l&&a&&u){var p=n.data;p._rev=d,p._id=n.metadata.id,n=xt(p,a)}var h=de(t.rev_tree,n.metadata.rev_tree[0],e),_=a&&(c&&l&&'new_leaf'!==h.conflicts||!c&&'new_leaf'!==h.conflicts||c&&!l&&'new_branch'===h.conflicts);if(_){var g=R(Tr);return s[r]=g,o()}var f=n.metadata.rev;n.metadata.rev_tree=h.tree,n.stemmedRevs=h.stemmedRevs||[],t.rev_map&&(n.metadata.rev_map=t.rev_map);var m=V(n.metadata),y=ue(n.metadata,m),v=c===y?0:c<y?-1:1,b;b=f===m?y:ue(n.metadata,f),i(n,m,y,b,!0,v,r,o)}function Xt(e){return'missing'===e.metadata.rev_tree[0].ids[1].status}function Gt(e,t,n,s,r,o,i,a,d){function c(e,t,n){var s=V(e.metadata),r=ue(e.metadata,s);if('was_delete'in a&&r)return o[t]=R(Ar,'deleted'),n();var d=u&&Xt(e);if(d){var c=R(Tr);return o[t]=c,n()}var l=r?0:1;i(e,s,r,r,!1,l,t,n)}function l(){++h===_&&d&&d()}e=e||1e3;var u=a.new_edits,p=new br,h=0,_=t.length;t.forEach(function(e,t){if(e._id&&pe(e._id)){var s=e._deleted?'_removeLocal':'_putLocal';return void n[s](e,{ctx:r},function(e,n){o[t]=e||n,l()})}var i=e.metadata.id;p.has(i)?(_--,p.get(i).push([e,t])):p.set(i,[[e,t]])}),p.forEach(function(t,n){function r(){++d<t.length?a():l()}function a(){var a=t[d],l=a[0],p=a[1];if(s.has(n))Vt(e,s.get(n),l,o,p,r,i,u);else{var h=de([],l.metadata.rev_tree[0],e);l.metadata.rev_tree=h.tree,l.stemmedRevs=h.stemmedRevs||[],c(l,p,r)}}var d=0;a()})}function Kt(e){try{return JSON.parse(e)}catch(t){return gr.a.parse(e)}}function Qt(e){try{return JSON.stringify(e)}catch(t){return gr.a.stringify(e)}}function Jt(e){return function(t){var n='unknown_error';t.target&&t.target.error&&(n=t.target.error.name||t.target.error.message),e(R(Fr,n,t.type))}}function Zt(e,t,n){return{data:Qt(e),winningRev:t,deletedOrLocal:n?'1':'0',seq:e.seq,id:e.id}}function en(e){if(!e)return null;var t=Kt(e.data);return t.winningRev=e.winningRev,t.deleted='1'===e.deletedOrLocal,t.seq=e.seq,t}function tn(e){if(!e)return e;var t=e._doc_id_rev.lastIndexOf(':');return e._id=e._doc_id_rev.substring(0,t-1),e._rev=e._doc_id_rev.substring(t+1),delete e._doc_id_rev,e}function nn(e,t,n,s){n?e?'string'==typeof e?s(Ct(e,t)):s(e):s(At([''],{type:t})):e?'string'==typeof e?s(e):Rt(e,function(e){s(lo(e))}):s('')}function sn(e,t,n,s){function r(){++a===i.length&&s&&s()}function o(e,t){var s=e._attachments[t],o=s.digest,i=n.objectStore(fo).get(o);i.onsuccess=function(t){s.body=t.target.result.body,r()}}var i=Object.keys(e._attachments||{});if(!i.length)return s&&s();var a=0;i.forEach(function(n){t.attachments&&t.include_docs?o(e,n):(e._attachments[n].stub=!0,r())})}function rn(e,t){return fr.all(e.map(function(e){if(e.doc&&e.doc._attachments){var n=Object.keys(e.doc._attachments);return fr.all(n.map(function(n){var s=e.doc._attachments[n];if('body'in s){var r=s.body,o=s.content_type;return new fr(function(i){nn(r,o,t,function(t){e.doc._attachments[n]=Sr(v(s,['digest','content_type']),{data:t}),i()})})}}))}}))}function on(e,t,n){function s(){c--,c||r()}function r(){o.length&&o.forEach(function(t){var e=d.index('digestSeq').count(IDBKeyRange.bound(t+'::',t+'::\uFFFF',!1,!1));e.onsuccess=function(n){var e=n.target.result;e||a.delete(t)}})}var o=[],i=n.objectStore(go),a=n.objectStore(fo),d=n.objectStore(mo),c=e.length;e.forEach(function(e){var n=i.index('_doc_id_rev');n.getKey(t+'::'+e).onsuccess=function(t){var e=t.target.result;if('number'!=typeof e)return s();i.delete(e);var n=d.index('seq').openCursor(IDBKeyRange.only(e));n.onsuccess=function(e){var t=e.target.result;if(t){var n=t.value.digestSeq.split('::')[0];o.push(n),d.delete(t.primaryKey),t.continue()}else s()}}})}function an(e,t,n){try{return{txn:e.transaction(t,n)}}catch(e){return{error:e}}}function dn(e,t,n,s,r,o){function a(){var e=an(r,[_o,go,fo,vo,mo,yo],'readwrite');return e.error?o(e.error):void(k=e.txn,k.onabort=Jt(o),k.ontimeout=Jt(o),k.oncomplete=p,w=k.objectStore(_o),S=k.objectStore(go),q=k.objectStore(fo),x=k.objectStore(mo),A=k.objectStore(yo),A.get(yo).onsuccess=function(t){L=t.target.result,l()},_(function(e){return e?(P=!0,o(e)):void u()}))}function d(){j=!0,l()}function c(){Gt(e.revs_limit,b,s,D,k,I,g,n,d)}function l(){L&&j&&(L.docCount+=O,A.put(L))}function u(){function e(){++n===b.length&&c()}function t(t){var n=en(t.target.result);n&&D.set(n.id,n),e()}if(b.length)for(var n=0,s=0,r=b.length,o;s<r;s++){if(o=b[s],o._id&&pe(o._id)){e();continue}var i=w.get(o.metadata.id);i.onsuccess=t}}function p(){P||(Eo.notify(s._meta.name),o(null,I))}function h(e,t){var n=q.get(e);n.onsuccess=function(n){if(!n.target.result){var s=R(Vr,'unknown stub attachment with digest '+e);s.status=412,t(s)}else t()}}function _(e){function t(){++s===n.length&&e(r)}var n=[];if(b.forEach(function(e){e.data&&e.data._attachments&&Object.keys(e.data._attachments).forEach(function(t){var s=e.data._attachments[t];s.stub&&n.push(s.digest)})}),!n.length)return e();var s=0,r;n.forEach(function(e){h(e,function(e){e&&!r&&(r=e),t()})})}function g(e,t,n,s,r,o,i,a){e.metadata.winningRev=t,e.metadata.deleted=n;var d=e.data;d._id=e.metadata.id,d._rev=e.metadata.rev,s&&(d._deleted=!0);var c=d._attachments&&Object.keys(d._attachments).length;return c?m(e,t,n,r,i,a):void(O+=o,l(),f(e,t,n,r,i,a))}function f(t,n,r,o,e,i){function a(i){var e=t.stemmedRevs||[];o&&s.auto_compaction&&(e=e.concat(J(t.metadata))),e&&e.length&&on(e,t.metadata.id,k),l.seq=i.target.result;var a=Zt(l,n,r),c=w.put(a);c.onsuccess=d}function d(){I[e]={ok:!0,id:l.id,rev:l.rev},D.set(t.metadata.id,t.metadata),y(t,l.seq,i)}var c=t.data,l=t.metadata;c._doc_id_rev=l.id+'::'+l.rev,delete c._id,delete c._rev;var u=S.put(c);u.onsuccess=a,u.onerror=function(t){t.preventDefault(),t.stopPropagation();var e=S.index('_doc_id_rev'),n=e.getKey(c._doc_id_rev);n.onsuccess=function(t){var e=S.put(c,t.target.result);e.onsuccess=a}}}function m(e,t,n,s,r,o){function i(){c===l.length&&f(e,t,n,s,r,o)}function a(){c++,i()}var d=e.data,c=0,l=Object.keys(d._attachments);l.forEach(function(n){var s=e.data._attachments[n];if(!s.stub){var r=s.data;delete s.data,s.revpos=parseInt(t,10);var o=s.digest;v(o,r,a)}else c++,i()})}function y(e,t,n){function s(){++o===a.length&&n()}function r(n){var r=e.data._attachments[n].digest,o=x.put({seq:t,digestSeq:r+'::'+t});o.onsuccess=s,o.onerror=function(t){t.preventDefault(),t.stopPropagation(),s()}}var o=0,a=Object.keys(e.data._attachments||{});if(!a.length)return n();for(var d=0;d<a.length;d++)r(a[d])}function v(t,n,s){var e=q.count(t);e.onsuccess=function(r){var e=r.target.result;if(e)return s();var o=q.put({digest:t,body:n});o.onsuccess=s}}for(var b=t.docs,E=0,i=b.length,k,w,S,q,x,A,T,L,C;E<i;E++)(C=b[E],!(C._id&&pe(C._id)))&&(C=b[E]=xt(C,n.new_edits),C.error&&!T&&(T=C));if(T)return o(T);var j=!1,O=0,I=Array(b.length),D=new br,P=!1,N=s._meta.blobSupport?'blob':'base64';Ht(b,N,function(e){return e?o(e):void a()})}function cn(e,t,n,s,r){function o(t){l=t.target.result,c&&r(c,l,u)}function i(t){c=t.target.result,l&&r(c,l,u)}function a(t){var e=t.target.result;return e?void r([e.key],[e.value],e):r()}var d='function'==typeof e.getAll&&'function'==typeof e.getAllKeys&&1<s&&!n,c,l,u;d?(u={continue:function(){if(!c.length)return r();var n=c[c.length-1],a;if(t&&t.upper)try{a=IDBKeyRange.bound(n,t.upper,!0,t.upperOpen)}catch(t){if('DataError'===t.name&&0===t.code)return r()}else a=IDBKeyRange.lowerBound(n,!0);t=a,c=null,l=null,e.getAll(t,s).onsuccess=o,e.getAllKeys(t,s).onsuccess=i}},e.getAll(t,s).onsuccess=o,e.getAllKeys(t,s).onsuccess=i):n?e.openCursor(t,'prev').onsuccess=a:e.openCursor(t).onsuccess=a}function ln(e,t,n){if('function'==typeof e.getAll)return void(e.getAll(t).onsuccess=n);var s=[];e.openCursor(t).onsuccess=function(t){var e=t.target.result;e?(s.push(e.value),e.continue()):n({target:{result:s}})}}function un(e,t,n){var s=[],r=0;e.forEach(function(o,i){t.get(o).onsuccess=function(t){s[i]=t.target.result?t.target.result:{key:o,error:'not_found'},r++,r===e.length&&n(e,s,{})}})}function pn(e,t,n,s,r){try{if(e&&t)return r?IDBKeyRange.bound(t,e,!n,!1):IDBKeyRange.bound(e,t,!1,!n);if(e)return r?IDBKeyRange.upperBound(e):IDBKeyRange.lowerBound(e);if(t)return r?IDBKeyRange.lowerBound(t,!n):IDBKeyRange.upperBound(t,!n);if(s)return IDBKeyRange.only(s)}catch(t){return{error:t}}return null}function hn(t,e,n){function s(e,n,s){var r=e.id+'::'+s;w.get(r).onsuccess=function(s){if(n.doc=tn(s.target.result),t.conflicts){var r=Q(e);r.length&&(n.doc._conflicts=r)}sn(n.doc,t,v)}}function r(e,n){var r={id:n.id,key:n.id,value:{rev:e}},o=n.deleted;o?u&&(S.push(r),r.value.deleted=!0,r.doc=null):0>=p--&&(S.push(r),t.include_docs&&s(n,r,e))}function o(e){for(var t=0,n=e.length,s;t<n&&S.length!==h;t++){if(s=e[t],s.error&&u){S.push(s);continue}var o=en(s),i=o.winningRev;r(i,o)}}function i(e,t,n){n&&(o(t),S.length<h&&n.continue())}function a(){var e={total_rows:q,offset:t.skip,rows:S};t.update_seq&&void 0!==x&&(e.update_seq=x),n(null,e)}var d=!!('startkey'in t)&&t.startkey,c=!!('endkey'in t)&&t.endkey,l=!!('key'in t)&&t.key,u=!!('keys'in t)&&t.keys,p=t.skip||0,h='number'==typeof t.limit?t.limit:-1,_=!1!==t.inclusive_end,g,f;if(!u&&(g=pn(d,c,_,l,t.descending),f=g&&g.error,f&&('DataError'!==f.name||0!==f.code)))return n(R(Fr,f.name,f.message));var m=[_o,go,yo];t.attachments&&m.push(fo);var y=an(e,m,'readonly');if(y.error)return n(y.error);var v=y.txn;v.oncomplete=function(){t.attachments?rn(S,t.binary).then(a):a()},v.onabort=Jt(n);var b=v.objectStore(_o),E=v.objectStore(go),k=v.objectStore(yo),w=E.index('_doc_id_rev'),S=[],q,x;return k.get(yo).onsuccess=function(t){q=t.target.result.docCount},t.update_seq&&function(e,t){e.openCursor(null,'prev').onsuccess=function(n){var e=n.target.result,s;return e&&e.key&&(s=e.key),t({target:{result:[s]}})}}(E,function(t){t.target.result&&0<t.target.result.length&&(x=t.target.result[0])}),f||0===h?void 0:u?un(t.keys,b,i):-1===h?ln(b,g,function(n){var e=n.target.result;t.descending&&(e=e.reverse()),o(e)}):void cn(b,g,t.descending,h+p,i)}function _n(e){return new fr(function(t){var n=At(['']),s=e.objectStore(bo).put(n,'key');s.onsuccess=function(){var e=navigator.userAgent.match(/Chrome\/(\d+)/),n=navigator.userAgent.match(/Edge\//);t(n||!e||43<=parseInt(e[1],10))},e.onabort=function(n){n.preventDefault(),n.stopPropagation(),t(!1)}}).catch(function(){return!1})}function gn(e,t){var n=e.objectStore(_o).index('deletedOrLocal');n.count(IDBKeyRange.only('0')).onsuccess=function(n){t(n.target.result)}}function fn(e,t,n,s){try{e(t,n)}catch(e){s.emit('error',e)}}function mn(){ko||!wo.length||(ko=!0,wo.shift()())}function yn(e,t,n){wo.push(function(){e(function(e,s){fn(t,e,s,n),ko=!1,sr()(function(){mn(n)})})}),mn()}function vn(e,t,n,s){function r(e,t,n,s){if(n.seq!==t)return s();if(n.winningRev===e._rev)return s(n,e);var r=e._id+'::'+n.winningRev,o=E.get(r);o.onsuccess=function(t){s(n,tn(t.target.result))}}function o(t,n,s){if(d&&!d.has(t._id))return s();var o=f.get(t._id);return o?r(t,n,o,s):void(b.get(t._id).onsuccess=function(i){o=en(i.target.result),f.set(t._id,o),r(t,n,o,s)})}function i(){e.complete(null,{results:h,last_seq:c})}if(e=l(e),e.continuous){var a=n+':'+Zr();return Eo.addListener(n,a,t,e),Eo.notify(n),{cancel:function(){Eo.removeListener(n,a)}}}var d=e.doc_ids&&new vr(e.doc_ids);e.since=e.since||0;var c=e.since,u='limit'in e?e.limit:-1;0===u&&(u=1);var p='return_docs'in e?e.return_docs:!('returnDocs'in e)||e.returnDocs;var h=[],_=0,g=D(e),f=new br,m=[_o,go],y,v,b,E;e.attachments&&m.push(fo);var k=an(s,m,'readonly');if(k.error)return e.complete(k.error);y=k.txn,y.onabort=Jt(e.complete),y.oncomplete=function(){!e.continuous&&e.attachments?rn(h).then(i):i()},v=y.objectStore(go),b=y.objectStore(_o),E=v.index('_doc_id_rev');var w=e.since&&!e.descending?IDBKeyRange.lowerBound(e.since,!0):null;cn(v,w,e.descending,u,function(t,n,s){function r(t,n){var s=e.processChange(n,t,e);c=s.seq=t.seq;var r=g(s);return'object'==typeof r?e.complete(r):void(r&&(_++,p&&h.push(s),e.attachments&&e.include_docs?sn(n,e,y,function(){rn([s],e.binary).then(function(){e.onChange(s)})}):e.onChange(s)))}function a(){for(var e=0,t=d.length,n;e<t&&_!==u;e++)if(n=d[e],n){var o=l[e];r(o,n)}_!==u&&s.continue()}if(s&&t.length){var d=Array(t.length),l=Array(t.length),f=0;n.forEach(function(e,n){var s=tn(e),r=t[n];o(s,r,function(e,s){l[n]=e,d[n]=s,++f===t.length&&a()})})}})}function bn(e,t){var n=this;yn(function(t){En(n,e,t)},t,n.constructor)}function En(e,t,n){function s(e){var t=e.createObjectStore(_o,{keyPath:'id'});e.createObjectStore(go,{autoIncrement:!0}).createIndex('_doc_id_rev','_doc_id_rev',{unique:!0}),e.createObjectStore(fo,{keyPath:'digest'}),e.createObjectStore(yo,{keyPath:'id',autoIncrement:!1}),e.createObjectStore(bo),t.createIndex('deletedOrLocal','deletedOrLocal',{unique:!1}),e.createObjectStore(vo,{keyPath:'_id'});var n=e.createObjectStore(mo,{autoIncrement:!0});n.createIndex('seq','seq'),n.createIndex('digestSeq','digestSeq',{unique:!0})}function r(e,t){var n=e.objectStore(_o);n.createIndex('deletedOrLocal','deletedOrLocal',{unique:!1}),n.openCursor().onsuccess=function(e){var s=e.target.result;if(s){var r=s.value,o=ue(r);r.deletedOrLocal=o?'1':'0',n.put(r),s.continue()}else t()}}function o(e){e.createObjectStore(vo,{keyPath:'_id'}).createIndex('_doc_id_rev','_doc_id_rev',{unique:!0})}function a(e,t){var n=e.objectStore(vo),s=e.objectStore(_o),r=e.objectStore(go),o=s.openCursor();o.onsuccess=function(e){var o=e.target.result;if(o){var i=o.value,a=i.id,d=pe(a),c=V(i);if(d){var l=r.index('_doc_id_rev'),u=IDBKeyRange.bound(a+'::',a+'::~',!1,!1),p=l.openCursor(u);p.onsuccess=function(t){if(p=t.target.result,!p)s.delete(o.primaryKey),o.continue();else{var e=p.value;e._doc_id_rev===a+'::'+c&&n.put(e),r.delete(p.primaryKey),p.continue()}}}else o.continue()}else t&&t()}}function d(e){var t=e.createObjectStore(mo,{autoIncrement:!0});t.createIndex('seq','seq'),t.createIndex('digestSeq','digestSeq',{unique:!0})}function c(e,t){var n=e.objectStore(go),s=e.objectStore(fo),r=e.objectStore(mo),o=s.count();o.onsuccess=function(s){var e=s.target.result;return e?void(n.openCursor().onsuccess=function(n){var e=n.target.result;if(!e)return t();for(var s=e.value,o=e.primaryKey,i=Object.keys(s._attachments||{}),a={},d=0,c;d<i.length;d++)c=s._attachments[i[d]],a[c.digest]=!0;var l=Object.keys(a);for(d=0;d<l.length;d++){var u=l[d];r.put({seq:o,digestSeq:u+'::'+o})}e.continue()}):t()}}function l(e){function t(e){return e.data?en(e):(e.deleted='1'===e.deletedOrLocal,e)}var n=e.objectStore(go),s=e.objectStore(_o),r=s.openCursor();r.onsuccess=function(r){function e(){var e=a.id+'::',t=a.id+'::\uFFFF',s=n.index('_doc_id_rev').openCursor(IDBKeyRange.bound(e,t)),r=0;s.onsuccess=function(t){var e=t.target.result;if(!e)return a.seq=r,o();var n=e.primaryKey;n>r&&(r=n),e.continue()}}function o(){var e=Zt(a,a.winningRev,a.deleted),t=s.put(e);t.onsuccess=function(){i.continue()}}var i=r.target.result;if(i){var a=t(i.value);return a.winningRev=a.winningRev||V(a),a.seq?o():void e()}}}var i=t.name,u=null;e._meta=null,e._remote=!1,e.type=function(){return'idb'},e._id=p(function(t){t(null,e._meta.instanceId)}),e._bulkDocs=function(n,s,r){dn(t,n,s,e,u,r)},e._get=function(e,t,n){function s(){n(a,{doc:o,metadata:i,ctx:r})}var r=t.ctx,o,i,a;if(!r){var d=an(u,[_o,go,fo],'readonly');if(d.error)return n(d.error);r=d.txn}r.objectStore(_o).get(e).onsuccess=function(n){if(i=en(n.target.result),!i)return a=R(Ar,'missing'),s();var e;if(!t.rev){e=i.winningRev;var d=ue(i);if(d)return a=R(Ar,'deleted'),s()}else e=t.latest?he(t.rev,i):t.rev;var c=r.objectStore(go),l=i.id+'::'+e;c.index('_doc_id_rev').get(l).onsuccess=function(t){return o=t.target.result,o&&(o=tn(o)),o?void s():(a=R(Ar,'missing'),s())}}},e._getAttachment=function(e,t,n,s,r){var o;if(s.ctx)o=s.ctx;else{var i=an(u,[_o,go,fo],'readonly');if(i.error)return r(i.error);o=i.txn}var a=n.digest,d=n.content_type;o.objectStore(fo).get(a).onsuccess=function(t){var e=t.target.result.body;nn(e,d,s.binary,function(e){r(null,e)})}},e._info=function(t){var n=an(u,[yo,go],'readonly'),s,r;if(n.error)return t(n.error);var o=n.txn;o.objectStore(yo).get(yo).onsuccess=function(t){r=t.target.result.docCount},o.objectStore(go).openCursor(null,'prev').onsuccess=function(t){var e=t.target.result;s=e?e.key:0},o.oncomplete=function(){t(null,{doc_count:r,update_seq:s,idb_attachment_format:e._meta.blobSupport?'binary':'base64'})}},e._allDocs=function(e,t){hn(e,u,t)},e._changes=function(t){return vn(t,e,i,u)},e._close=function(e){u.close(),So.delete(i),e()},e._getRevisionTree=function(e,t){var n=an(u,[_o],'readonly');if(n.error)return t(n.error);var s=n.txn,r=s.objectStore(_o).get(e);r.onsuccess=function(e){var n=en(e.target.result);n?t(null,n.rev_tree):t(R(Ar))}},e._doCompaction=function(e,t,n){var s=an(u,[_o,go,fo,mo],'readwrite');if(s.error)return n(s.error);var r=s.txn,o=r.objectStore(_o);o.get(e).onsuccess=function(n){var s=en(n.target.result);X(s.rev_tree,function(e,n,s,r,o){-1!==t.indexOf(n+'-'+s)&&(o.status='missing')}),on(t,e,r);var o=s.winningRev,i=s.deleted;r.objectStore(_o).put(Zt(s,o,i))},r.onabort=Jt(n),r.oncomplete=function(){n()}},e._getLocal=function(e,t){var n=an(u,[vo],'readonly');if(n.error)return t(n.error);var s=n.txn,r=s.objectStore(vo).get(e);r.onerror=Jt(t),r.onsuccess=function(n){var e=n.target.result;e?(delete e._doc_id_rev,t(null,e)):t(R(Ar))}},e._putLocal=function(e,t,n){'function'==typeof t&&(n=t,t={}),delete e._revisions;var s=e._rev,r=e._id;e._rev=s?'0-'+(parseInt(s.split('-')[1],10)+1):'0-1';var o=t.ctx,i;if(!o){var a=an(u,[vo],'readwrite');if(a.error)return n(a.error);o=a.txn,o.onerror=Jt(n),o.oncomplete=function(){i&&n(null,i)}}var d=o.objectStore(vo),c;s?(c=d.get(r),c.onsuccess=function(r){var o=r.target.result;if(!o||o._rev!==s)n(R(Tr));else{var a=d.put(e);a.onsuccess=function(){i={ok:!0,id:e._id,rev:e._rev},t.ctx&&n(null,i)}}}):(c=d.add(e),c.onerror=function(t){n(R(Tr)),t.preventDefault(),t.stopPropagation()},c.onsuccess=function(){i={ok:!0,id:e._id,rev:e._rev},t.ctx&&n(null,i)})},e._removeLocal=function(t,n,s){'function'==typeof n&&(s=n,n={});var e=n.ctx;if(!e){var r=an(u,[vo],'readwrite');if(r.error)return s(r.error);e=r.txn,e.oncomplete=function(){d&&s(null,d)}}var o=t._id,i=e.objectStore(vo),a=i.get(o),d;a.onerror=Jt(s),a.onsuccess=function(r){var e=r.target.result;e&&e._rev===t._rev?(i.delete(o),d={ok:!0,id:o,rev:'0-0'},n.ctx&&s(null,d)):s(R(Ar))}},e._destroy=function(e,t){Eo.removeAllListeners(i);var n=qo.get(i);n&&n.result&&(n.result.close(),So.delete(i));var s=indexedDB.deleteDatabase(i);s.onsuccess=function(){qo.delete(i),S()&&i in localStorage&&delete localStorage[i],t(null,{ok:!0})},s.onerror=Jt(t)};var h=So.get(i);if(h)return u=h.idb,e._meta=h.global,sr()(function(){n(null,e)});var _;_=t.storage?kn(i,t.storage):indexedDB.open(i,ho),qo.set(i,_),_.onupgradeneeded=function(t){function e(){var t=p[h-1];h++,t&&t(u,e)}var n=t.target.result;if(1>t.oldVersion)return s(n);var u=t.currentTarget.transaction;3>t.oldVersion&&o(n),4>t.oldVersion&&d(n);var p=[r,a,c,l],h=t.oldVersion;e()},_.onsuccess=function(t){function s(){'undefined'!=typeof l&&a&&(e._meta={name:i,instanceId:p,blobSupport:l},So.set(i,{idb:u,global:e._meta}),n(null,e))}function r(){if('undefined'!=typeof c&&'undefined'!=typeof d){var e=i+'_id';e in d?p=d[e]:d[e]=p=Zr(),d.docCount=c,o.objectStore(yo).put(d)}}u=t.target.result,u.onversionchange=function(){u.close(),So.delete(i)},u.onabort=function(t){A('error','Database has a global failure',t.target.error),u.close(),So.delete(i)};var o=u.transaction([yo,bo,_o],'readwrite'),a=!1,d,c,l,p;o.objectStore(yo).get(yo).onsuccess=function(t){d=t.target.result||{id:yo},r()},gn(o,function(e){c=e,r()}),xo||(xo=_n(o)),xo.then(function(e){l=e,s()}),o.oncomplete=function(){a=!0,s()},o.onabort=Jt(n)},_.onerror=function(){var e='Failed to open indexedDB, are you in private browsing mode?';A('error',e),n(R(Fr,e))}}function kn(e,t){try{return indexedDB.open(e,{version:ho,storage:t})}catch(t){return indexedDB.open(e,ho)}}function wn(e){return decodeURIComponent(escape(e))}function Sn(e){return 65>e?e-48:e-55}function qn(e,t,n){for(var s='';t<n;)s+=o(Sn(e.charCodeAt(t++))<<4|Sn(e.charCodeAt(t++)));return s}function xn(e,t,n){for(var s='';t<n;)s+=o(Sn(e.charCodeAt(t+2))<<12|Sn(e.charCodeAt(t+3))<<8|Sn(e.charCodeAt(t))<<4|Sn(e.charCodeAt(t+1))),t+=4;return s}function An(e,t){return'UTF-8'===t?wn(qn(e,0,e.length)):xn(e,0,e.length)}function Tn(e){return'\''+e+'\''}function Ln(e){return e.replace(/\u0002/g,'\x02\x02').replace(/\u0001/g,'\x01\x02').replace(/\u0000/g,'\x01\x01')}function Cn(e){return e.replace(/\u0001\u0001/g,'\0').replace(/\u0001\u0002/g,'\x01').replace(/\u0002\u0002/g,'\x02')}function jn(e){return delete e._id,delete e._rev,JSON.stringify(e)}function Rn(e,t,n){return e=JSON.parse(e),e._id=t,e._rev=n,e}function On(e){for(var t='(';e--;)t+='?',e&&(t+=',');return t+')'}function In(e,t,n,s,r){return'SELECT '+e+' FROM '+('string'==typeof t?t:t.join(' JOIN '))+(n?' ON '+n:'')+(s?' WHERE '+('string'==typeof s?s:s.join(' AND ')):'')+(r?' ORDER BY '+r:'')}function Dn(e,t,n){function s(){++o===e.length&&r()}function r(){if(i.length){var e='SELECT DISTINCT digest AS digest FROM '+Oo+' WHERE seq IN '+On(i.length);n.executeSql(e,i,function(e,t){for(var n=[],s=0;s<t.rows.length;s++)n.push(t.rows.item(s).digest);if(n.length){var r='DELETE FROM '+Oo+' WHERE seq IN ('+i.map(function(){return'?'}).join(',')+')';e.executeSql(r,i,function(e){var t='SELECT digest FROM '+Oo+' WHERE digest IN ('+n.map(function(){return'?'}).join(',')+')';e.executeSql(t,n,function(e,t){for(var s=new vr,r=0;r<t.rows.length;r++)s.add(t.rows.item(r).digest);n.forEach(function(t){s.has(t)||(e.executeSql('DELETE FROM '+Oo+' WHERE digest=?',[t]),e.executeSql('DELETE FROM '+Co+' WHERE digest=?',[t]))})})})}})}}if(e.length){var o=0,i=[];e.forEach(function(e){n.executeSql('SELECT seq FROM '+Lo+' WHERE doc_id=? AND rev=?',[t,e],function(e,t){if(!t.rows.length)return s();var n=t.rows.item(0).seq;i.push(n),e.executeSql('DELETE FROM '+Lo+' WHERE seq=?',[n],s)})})}}function Pn(e){return function(t){A('error','WebSQL threw an error',t);var n=t&&t.constructor.toString().match(/function ([^(]+)/),s=n&&n[1]||t.type,r=t.target||t.message;e(R(Mr,r,s))}}function Nn(e){if('size'in e)return 1e6*e.size;var t='undefined'!=typeof navigator&&/Android/.test(navigator.userAgent);return t?5e6:1}function Bn(e,t,n,s,r,o,i){function a(){return E?i(E):void(o.notify(s._name),i(null,y))}function d(e,t){b.executeSql('SELECT count(*) as cnt FROM '+Co+' WHERE digest=?',[e],function(n,s){if(0===s.rows.item(0).cnt){var r=R(Vr,'unknown stub attachment with digest '+e);t(r)}else t()})}function c(e){function t(){++s===n.length&&e(r)}var n=[];if(f.forEach(function(e){e.data&&e.data._attachments&&Object.keys(e.data._attachments).forEach(function(t){var s=e.data._attachments[t];s.stub&&n.push(s.digest)})}),!n.length)return e();var s=0,r;n.forEach(function(e){d(e,function(e){e&&!r&&(r=e),t()})})}function l(e,t,n,r,o,i,a,d){function c(){function t(e,t){function s(){return++o===a.length&&t(),!1}function r(t){var r=[n._attachments[t].digest,e];b.executeSql('INSERT INTO '+Oo+' (digest, seq) VALUES (?,?)',r,s,s)}var o=0,a=Object.keys(n._attachments||{});if(!a.length)return t();for(var d=0;d<a.length;d++)r(a[d])}var n=e.data,s=r?1:0,o=n._id,i=n._rev,a=jn(n);b.executeSql('INSERT INTO '+Lo+' (doc_id, rev, json, deleted) VALUES (?, ?, ?, ?);',[o,i,a,s],function(e,n){var s=n.insertId;t(s,function(){p(e,s)})},function(){var e=In('seq',Lo,null,'doc_id=? AND rev=?');return b.executeSql(e,[o,i],function(e,n){var r=n.rows.item(0).seq;e.executeSql('UPDATE '+Lo+' SET json=?, deleted=? WHERE doc_id=? AND rev=?;',[a,s,o,i],function(e){t(r,function(){p(e,r)})})}),!1})}function l(e){_||(e?(_=e,d(_)):g===f.length&&c())}function u(e){g++,l(e)}function p(n,r){var i=e.metadata.id,c=e.stemmedRevs||[];o&&s.auto_compaction&&(c=J(e.metadata).concat(c)),c.length&&Dn(c,i,n),e.metadata.seq=r;var l=e.metadata.rev;delete e.metadata.rev;var u=o?'UPDATE '+To+' SET json=?, max_seq=?, winningseq=(SELECT seq FROM '+Lo+' WHERE doc_id='+To+'.id AND rev=?) WHERE id=?':'INSERT INTO '+To+' (id, winningseq, max_seq, json) VALUES (?,?,?,?);',p=Qt(e.metadata),h=o?[p,r,t,i]:[i,r,r,p];n.executeSql(u,h,function(){y[a]={ok:!0,id:e.metadata.id,rev:l},v.set(i,e.metadata),d()})}var _=null,g=0;e.data._id=e.metadata.id,e.data._rev=e.metadata.rev;var f=Object.keys(e.data._attachments||{});r&&(e.data._deleted=!0),f.forEach(function(n){var s=e.data._attachments[n];if(!s.stub){var r=s.data;delete s.data,s.revpos=parseInt(t,10);var o=s.digest;h(o,r,u)}else g++,l()}),f.length||c()}function u(){Gt(e.revs_limit,f,s,v,b,y,l,n)}function p(e){function t(){++n===f.length&&e()}if(!f.length)return e();var n=0;f.forEach(function(e){if(e._id&&pe(e._id))return t();var n=e.metadata.id;b.executeSql('SELECT json FROM '+To+' WHERE id = ?',[n],function(e,s){if(s.rows.length){var r=Kt(s.rows.item(0).json);v.set(n,r)}t()})})}function h(e,t,n){var s='SELECT digest FROM '+Co+' WHERE digest=?';b.executeSql(s,[e],function(r,o){return o.rows.length?n():void(s='INSERT INTO '+Co+' (digest, body, escaped) VALUES (?,?,1)',r.executeSql(s,[e,Ln(t)],function(){n()},function(){return n(),!1}))})}var _=n.new_edits,g=t.docs,f=g.map(function(e){if(e._id&&pe(e._id))return e;var t=xt(e,_);return t}),m=f.filter(function(e){return e.error});if(m.length)return i(m[0]);var y=Array(f.length),v=new br,b,E;Ht(f,'binary',function(e){return e?i(e):void r.transaction(function(e){b=e,c(function(e){e?E=e:p(u)})},Pn(i),a)})}function Un(e){return e.websql(e.name,e.version,e.description,e.size)}function $n(e){try{return{db:Un(e)}}catch(e){return{error:e}}}function Fn(e){var t=Io.get(e.name);return t||(t=$n(e),Io.set(e.name,t)),t}function Mn(e,t,n,s,r){function o(){++d===a.length&&r&&r()}function i(e,r){var i=e._attachments[r],a={binary:t.binary,ctx:s};n._getAttachment(e._id,r,i,a,function(t,n){e._attachments[r]=Sr(v(i,['digest','content_type']),{data:n}),o()})}var a=Object.keys(e._attachments||{});if(!a.length)return r&&r();var d=0;a.forEach(function(n){t.attachments&&t.include_docs?i(e,n):(e._attachments[n].stub=!0,o())})}function Yn(e,t){function n(){S()&&(window.localStorage['_pouch__websqldb_'+y._name]=!0),t(null,y)}function s(e,t){e.executeSql(Uo),e.executeSql('ALTER TABLE '+Lo+' ADD COLUMN deleted TINYINT(1) DEFAULT 0',[],function(){e.executeSql(No),e.executeSql('ALTER TABLE '+To+' ADD COLUMN local TINYINT(1) DEFAULT 0',[],function(){e.executeSql('CREATE INDEX IF NOT EXISTS \'doc-store-local-idx\' ON '+To+' (local, id)');e.executeSql('SELECT '+To+'.winningseq AS seq, '+To+'.json AS metadata FROM '+Lo+' JOIN '+To+' ON '+Lo+'.seq = '+To+'.winningseq',[],function(e,n){for(var s=[],r=[],o=0;o<n.rows.length;o++){var i=n.rows.item(o),a=i.seq,d=JSON.parse(i.metadata);ue(d)&&s.push(a),pe(d.id)&&r.push(d.id)}e.executeSql('UPDATE '+To+'SET local = 1 WHERE id IN '+On(r.length),r,function(){e.executeSql('UPDATE '+Lo+' SET deleted = 1 WHERE seq IN '+On(s.length),s,t)})})})})}function r(e,t){e.executeSql('CREATE TABLE IF NOT EXISTS '+jo+' (id UNIQUE, rev, json)',[],function(){e.executeSql('SELECT '+To+'.id AS id, '+Lo+'.json AS data FROM '+Lo+' JOIN '+To+' ON '+Lo+'.seq = '+To+'.winningseq WHERE local = 1',[],function(e,n){function s(){if(!r.length)return t(e);var n=r.shift(),o=JSON.parse(n.data)._rev;e.executeSql('INSERT INTO '+jo+' (id, rev, json) VALUES (?,?,?)',[n.id,o,n.data],function(e){e.executeSql('DELETE FROM '+To+' WHERE id=?',[n.id],function(e){e.executeSql('DELETE FROM '+Lo+' WHERE seq=?',[n.seq],function(){s()})})})}for(var r=[],o=0;o<n.rows.length;o++)r.push(n.rows.item(o));s()})})}function o(e,t){function n(n){function s(){if(!n.length)return t(e);var r=n.shift(),o=An(r.hex,k),i=o.lastIndexOf('::'),a=o.substring(0,i),d=o.substring(i+2);e.executeSql('UPDATE '+Lo+' SET doc_id=?, rev=? WHERE doc_id_rev=?',[a,d,o],function(){s()})}s()}e.executeSql('ALTER TABLE '+Lo+' ADD COLUMN doc_id',[],function(e){e.executeSql('ALTER TABLE '+Lo+' ADD COLUMN rev',[],function(e){e.executeSql(Bo,[],function(e){e.executeSql('SELECT hex(doc_id_rev) as hex FROM '+Lo,[],function(e,t){for(var s=[],r=0;r<t.rows.length;r++)s.push(t.rows.item(r));n(s)})})})})}function a(e,t){function n(e){e.executeSql('SELECT COUNT(*) AS cnt FROM '+Co,[],function(e,n){function s(){var n=In(Yo+', '+To+'.id AS id',[To,Lo],Mo,null,To+'.id ');n+=' LIMIT '+i+' OFFSET '+o,o+=i,e.executeSql(n,[],function(e,n){function r(e,t){var n=o[e]=o[e]||[];-1===n.indexOf(t)&&n.push(t)}if(!n.rows.length)return t(e);for(var o={},a=0;a<n.rows.length;a++)for(var i=n.rows.item(a),d=Rn(i.data,i.id,i.rev),c=Object.keys(d._attachments||{}),l=0,u;l<c.length;l++)u=d._attachments[c[l]],r(u.digest,i.seq);var p=[];if(Object.keys(o).forEach(function(e){var t=o[e];t.forEach(function(t){p.push([e,t])})}),!p.length)return s();var h=0;p.forEach(function(t){e.executeSql('INSERT INTO '+Oo+' (digest, seq) VALUES (?,?)',t,function(){++h===p.length&&s()})})})}var r=n.rows.item(0).cnt;if(!r)return t(e);var o=0,i=10;s()})}e.executeSql('CREATE TABLE IF NOT EXISTS '+Oo+' (digest, seq INTEGER)',[],function(e){e.executeSql(Fo,[],function(e){e.executeSql($o,[],n)})})}function d(e,t){e.executeSql('ALTER TABLE '+Co+' ADD COLUMN escaped TINYINT(1) DEFAULT 0',[],t)}function c(e,t){e.executeSql('ALTER TABLE '+To+' ADD COLUMN max_seq INTEGER',[],function(e){e.executeSql('UPDATE '+To+' SET max_seq=(SELECT MAX(seq) FROM '+Lo+' WHERE doc_id=id)',[],function(e){e.executeSql('CREATE UNIQUE INDEX IF NOT EXISTS \'doc-max-seq-idx\' ON '+To+' (max_seq)',[],t)})})}function i(e,t){e.executeSql('SELECT HEX("a") AS hex',[],function(e,n){var s=n.rows.item(0).hex;k=2===s.length?'UTF-8':'UTF-16',t()})}function u(){for(;0<E.length;){var e=E.pop();e(null,v)}}function h(e,t){if(0===t){e.executeSql('CREATE TABLE IF NOT EXISTS '+Co+' (digest UNIQUE, escaped TINYINT(1), body BLOB)'),e.executeSql('CREATE TABLE IF NOT EXISTS '+jo+' (id UNIQUE, rev, json)'),e.executeSql('CREATE TABLE IF NOT EXISTS '+Oo+' (digest, seq INTEGER)',[],function(){e.executeSql($o),e.executeSql(Fo)}),e.executeSql('CREATE TABLE IF NOT EXISTS '+To+' (id unique, json, winningseq, max_seq INTEGER UNIQUE)',[],function(){e.executeSql(Uo),e.executeSql('CREATE TABLE IF NOT EXISTS '+Lo+' (seq INTEGER NOT NULL PRIMARY KEY AUTOINCREMENT, json, deleted TINYINT(1), doc_id, rev)',[],function(){e.executeSql(No),e.executeSql(Bo),e.executeSql('CREATE TABLE IF NOT EXISTS '+Ro+' (dbid, db_version INTEGER)',[],function(){v=Zr();var t=[Ao,v];e.executeSql('INSERT INTO '+Ro+' (db_version, dbid) VALUES (?,?)',t,function(){u()})})})})}else{var n=function(){t<Ao&&e.executeSql('UPDATE '+Ro+' SET db_version = '+Ao);e.executeSql('SELECT dbid FROM '+Ro,[],function(e,t){v=t.rows.item(0).dbid,u()})},l=[s,r,o,a,d,c,n],p=t,i=function(e){l[p-1](e,i),p++};i(e)}}function _(e){e.executeSql('SELECT sql FROM sqlite_master WHERE tbl_name = '+Ro,[],function(e,t){t.rows.length?/db_version/.test(t.rows.item(0).sql)?e.executeSql('SELECT db_version FROM '+Ro,[],function(e,t){var n=t.rows.item(0).db_version;h(e,n)}):e.executeSql('ALTER TABLE '+Ro+' ADD COLUMN db_version INTEGER',[],function(){h(e,1)}):h(e,0)})}function g(e,t){e.executeSql('SELECT MAX(seq) AS seq FROM '+Lo,[],function(e,n){var s=n.rows.item(0).seq||0;t(s)})}function f(e,t){var n=In('COUNT('+To+'.id) AS \'num\'',[To,Lo],Mo,Lo+'.deleted=0');e.executeSql(n,[],function(e,n){t(n.rows.item(0).num)})}function m(e,t,n,s,r){var o=In(Yo,[To,Lo],Mo,To+'.id=?');e.executeSql(o,[t],function(e,t){if(!t.rows.length){var o=R(Ar,'missing');return r(o)}var i=t.rows.item(0),a=Kt(i.metadata);s(he(n,a))})}var y=this,v=null,b=Nn(e),E=[],k;y._name=e.name;var w=Sr({},e,{version:Po,description:e.name,size:b}),q=Fn(w);if(q.error)return Pn(t)(q.error);var x=q.db;'function'!=typeof x.readTransaction&&(x.readTransaction=x.transaction),function(){x.transaction(function(e){i(e,function(){_(e)})},Pn(t),n)}(),y._remote=!1,y.type=function(){return'websql'},y._id=p(function(e){e(null,v)}),y._info=function(e){var t,n;x.readTransaction(function(e){g(e,function(e){t=e}),f(e,function(e){n=e})},Pn(e),function(){e(null,{doc_count:n,update_seq:t,websql_encoding:k})})},y._bulkDocs=function(t,n,s){Bn(e,t,n,y,x,Do,s)},y._get=function(e,t,n){function s(e){n(e,{doc:o,metadata:i,ctx:r})}var r=t.ctx,o,i;if(!r)return x.readTransaction(function(s){y._get(e,Sr({ctx:s},t),n)});var a,d;if(!t.rev)a=In(Yo,[To,Lo],Mo,To+'.id=?'),d=[e];else{if(t.latest)return void m(r,e,t.rev,function(s){t.latest=!1,t.rev=s,y._get(e,t,n)},s);a=In(Yo,[To,Lo],To+'.id='+Lo+'.doc_id',[Lo+'.doc_id=?',Lo+'.rev=?']),d=[e,t.rev]}r.executeSql(a,d,function(e,n){if(!n.rows.length){var r=R(Ar,'missing');return s(r)}var a=n.rows.item(0);if(i=Kt(a.metadata),a.deleted&&!t.rev){var d=R(Ar,'deleted');return s(d)}o=Rn(a.data,i.id,a.rev),s()})},y._allDocs=function(e,t){var n=[],s=!!('startkey'in e)&&e.startkey,r=!!('endkey'in e)&&e.endkey,o=!!('key'in e)&&e.key,a=!!('keys'in e)&&e.keys,i=!!('descending'in e)&&e.descending,d='limit'in e?e.limit:-1,c='skip'in e?e.skip:0,l=!1!==e.inclusive_end,u=[],p=[],h,_;if(a){var m=[],v='';a.forEach(function(e){-1===m.indexOf(e)&&(m.push(e),v+='?,')}),v=v.substring(0,v.length-1),p.push(To+'.id IN ('+v+')'),u=u.concat(m)}else if(!1!==o)p.push(To+'.id = ?'),u.push(o);else if(!1!==s||!1!==r){if(!1!==s&&(p.push(To+'.id '+(i?'<=':'>=')+' ?'),u.push(s)),!1!==r){var b=i?'>':'<';l&&(b+='='),p.push(To+'.id '+b+' ?'),u.push(r)}!1!==o&&(p.push(To+'.id = ?'),u.push(o))}a||p.push(Lo+'.deleted = 0'),x.readTransaction(function(t){if(f(t,function(e){h=e}),e.update_seq&&g(t,function(e){_=e}),0!==d){var s=In(Yo,[To,Lo],Mo,p,To+'.id '+(i?'DESC':'ASC'));s+=' LIMIT '+d+' OFFSET '+c,t.executeSql(s,u,function(t,s){for(var r=0,o=s.rows.length;r<o;r++){var i=s.rows.item(r),d=Kt(i.metadata),c=d.id,l=Rn(i.data,c,i.rev),u=l._rev,p={id:c,key:c,value:{rev:u}};if(e.include_docs){if(p.doc=l,p.doc._rev=u,e.conflicts){var h=Q(d);h.length&&(p.doc._conflicts=h)}Mn(p.doc,e,y,t)}if(i.deleted)if(a)p.value.deleted=!0,p.doc=null;else continue;if(!a)n.push(p);else{var _=a.indexOf(c,_);do n[_]=p,_=a.indexOf(c,_+1);while(-1<_&&_<a.length)}}a&&a.forEach(function(e,t){n[t]||(n[t]={key:e,error:'not_found'})})})}},Pn(t),function(){var s={total_rows:h,offset:e.skip,rows:n};e.update_seq&&(s.update_seq=_),t(null,s)})},y._changes=function(e){if(e=l(e),e.continuous){var t=y._name+':'+Zr();return Do.addListener(y._name,t,y,e),Do.notify(y._name),{cancel:function(){Do.removeListener(y._name,t)}}}var n=e.descending;e.since=e.since&&!n?e.since:0;var s='limit'in e?e.limit:-1;0===s&&(s=1);var r='return_docs'in e?e.return_docs:!('returnDocs'in e)||e.returnDocs;var o=[],a=0;(function(){var t=['maxSeq > ?'],i=[e.since];e.doc_ids&&(t.push(To+'.id IN '+On(e.doc_ids.length)),i=i.concat(e.doc_ids));var d='maxSeq '+(n?'DESC':'ASC'),c=In(To+'.json AS metadata, '+To+'.max_seq AS maxSeq, '+Lo+'.json AS winningDoc, '+Lo+'.rev AS winningRev ',To+' JOIN '+Lo,To+'.id='+Lo+'.doc_id AND '+To+'.winningseq='+Lo+'.seq',t,d),l=D(e);e.view||e.filter||(c+=' LIMIT '+s);var u=e.since||0;x.readTransaction(function(t){t.executeSql(c,i,function(t,n){function d(t){return function(){e.onChange(t)}}for(var c=0,i=n.rows.length;c<i;c++){var p=n.rows.item(c),h=Kt(p.metadata);u=p.maxSeq;var _=Rn(p.winningDoc,h.id,p.winningRev),g=e.processChange(_,h,e);g.seq=p.maxSeq;var f=l(g);if('object'==typeof f)return e.complete(f);if(f&&(a++,r&&o.push(g),e.attachments&&e.include_docs?Mn(_,e,y,t,d(g)):d(g)()),a===s)break}})},Pn(e.complete),function(){e.continuous||e.complete(null,{results:o,last_seq:u})})})()},y._close=function(e){e()},y._getAttachment=function(e,t,n,s,r){var o=s.ctx,i=n.digest,a=n.content_type,d;o.executeSql('SELECT escaped, CASE WHEN escaped = 1 THEN body ELSE HEX(body) END AS body FROM '+Co+' WHERE digest=?',[i],function(e,t){var n=t.rows.item(0),o=n.escaped?Cn(n.body):An(n.body,k);d=s.binary?Lt(o,a):lo(o),r(null,d)})},y._getRevisionTree=function(e,t){x.readTransaction(function(n){n.executeSql('SELECT json AS metadata FROM '+To+' WHERE id = ?',[e],function(e,n){if(!n.rows.length)t(R(Ar));else{var s=Kt(n.rows.item(0).metadata);t(null,s.rev_tree)}})})},y._doCompaction=function(e,t,n){return t.length?void x.transaction(function(n){n.executeSql('SELECT json AS metadata FROM '+To+' WHERE id = ?',[e],function(n,s){var r=Kt(s.rows.item(0).metadata);X(r.rev_tree,function(e,n,s,r,o){-1!==t.indexOf(n+'-'+s)&&(o.status='missing')});n.executeSql('UPDATE '+To+' SET json = ? WHERE id = ?',[Qt(r),e])}),Dn(t,e,n)},Pn(n),function(){n()}):n()},y._getLocal=function(e,t){x.readTransaction(function(n){n.executeSql('SELECT json, rev FROM '+jo+' WHERE id=?',[e],function(n,s){if(s.rows.length){var r=s.rows.item(0),o=Rn(r.json,e,r.rev);t(null,o)}else t(R(Ar))})})},y._putLocal=function(e,t,n){function s(e){var s,c;r?(s='UPDATE '+jo+' SET rev=?, json=? WHERE id=? AND rev=?',c=[i,a,o,r]):(s='INSERT INTO '+jo+' (id, rev, json) VALUES (?,?,?)',c=[o,i,a]),e.executeSql(s,c,function(e,s){s.rowsAffected?(d={ok:!0,id:o,rev:i},t.ctx&&n(null,d)):n(R(Tr))},function(){return n(R(Tr)),!1})}'function'==typeof t&&(n=t,t={}),delete e._revisions;var r=e._rev,o=e._id,i;i=r?e._rev='0-'+(parseInt(r.split('-')[1],10)+1):e._rev='0-1';var a=jn(e),d;t.ctx?s(t.ctx):x.transaction(s,Pn(n),function(){d&&n(null,d)})},y._removeLocal=function(e,t,n){function s(s){var o=[e._id,e._rev];s.executeSql('DELETE FROM '+jo+' WHERE id=? AND rev=?',o,function(s,o){return o.rowsAffected?void(r={ok:!0,id:e._id,rev:'0-0'},t.ctx&&n(null,r)):n(R(Ar))})}'function'==typeof t&&(n=t,t={});var r;t.ctx?s(t.ctx):x.transaction(s,Pn(n),function(){r&&n(null,r)})},y._destroy=function(e,t){Do.removeAllListeners(y._name),x.transaction(function(e){[To,Lo,Co,Ro,jo,Oo].forEach(function(t){e.executeSql('DROP TABLE IF EXISTS '+t,[])})},Pn(t),function(){S()&&(delete window.localStorage['_pouch__websqldb_'+y._name],delete window.localStorage[y._name]),t(null,{ok:!0})})}}function zn(){try{return openDatabase('_pouch_validate_websql',1,'',1),!0}catch(e){return!1}}function Wn(){if('undefined'==typeof indexedDB||null===indexedDB||!/iP(hone|od|ad)/.test(navigator.userAgent))return!0;var e=S(),t='_pouch__websqldb_valid_'+navigator.userAgent;if(e&&localStorage[t])return'1'===localStorage[t];var n=zn();return e&&(localStorage[t]=n?'1':'0'),n}function Hn(e,t,n,s){return openDatabase(e,t,n,s)}function Vn(e,t){A('warn','WebSQL is deprecated and will be removed in future releases of PouchDB. Please migrate to IndexedDB: https://pouchdb.com/2018/01/23/pouchdb-6.4.2.html');var n=Sr({websql:Hn},e);Yn.call(this,n,t)}function Xn(){for(var e={},t=new fr(function(t,n){e.resolve=t,e.reject=n}),n=Array(arguments.length),s=0;s<n.length;s++)n[s]=arguments[s];return e.promise=t,fr.resolve().then(function(){return fetch.apply(null,n)}).then(function(t){e.resolve(t)}).catch(function(t){e.reject(t)}),e}function Gn(e,t){var n=new Headers,s={method:e.method,credentials:'include',headers:n},r,o,i;return e.json&&(n.set('Accept','application/json'),n.set('Content-Type',e.headers['Content-Type']||'application/json')),s.body=e.body&&e.processData&&'string'!=typeof e.body?JSON.stringify(e.body):'body'in e?e.body:null,Object.keys(e.headers).forEach(function(t){e.headers.hasOwnProperty(t)&&n.set(t,e.headers[t])}),r=Xn(e.url,s),0<e.timeout&&(o=setTimeout(function(){r.reject(new Error('Load timeout for resource: '+e.url))},e.timeout)),r.promise.then(function(t){return i={statusCode:t.status},0<e.timeout&&clearTimeout(o),200<=i.statusCode&&300>i.statusCode?e.binary?t.blob():t.text():t.json()}).then(function(e){200<=i.statusCode&&300>i.statusCode?t(null,i,e):(e.status=i.statusCode,t(e))}).catch(function(e){e||(e=new Error('canceled')),t(e)}),{abort:r.reject}}function Kn(e,t){var n=!1,s=function(){n=!0,i.abort(),o()},r={abort:function(){i.abort(),o()}},o=function(){clearTimeout(a),r.abort=function(){},i&&(i.onprogress=void 0,i.upload&&(i.upload.onprogress=void 0),i.onreadystatechange=void 0,i=void 0)},i,a;i=e.xhr?new e.xhr:new XMLHttpRequest;try{i.open(e.method,e.url)}catch(e){return t(new Error(e.name||'Url is invalid'))}for(var d in i.withCredentials=!('withCredentials'in e)||e.withCredentials,'GET'===e.method?delete e.headers['Content-Type']:e.json&&(e.headers.Accept='application/json',e.headers['Content-Type']=e.headers['Content-Type']||'application/json',e.body&&e.processData&&'string'!=typeof e.body&&(e.body=JSON.stringify(e.body))),e.binary&&(i.responseType='arraybuffer'),'body'in e||(e.body=null),e.headers)e.headers.hasOwnProperty(d)&&i.setRequestHeader(d,e.headers[d]);return 0<e.timeout&&(a=setTimeout(s,e.timeout),i.onprogress=function(){clearTimeout(a),4!==i.readyState&&(a=setTimeout(s,e.timeout))},'undefined'!=typeof i.upload&&(i.upload.onprogress=i.onprogress)),i.onreadystatechange=function(){if(4===i.readyState){var s={statusCode:i.status};if(200<=i.status&&300>i.status){var r;r=e.binary?At([i.response||''],{type:i.getResponseHeader('Content-Type')}):i.responseText,t(null,s,r)}else{var a={};if(n)a=new Error('ETIMEDOUT'),a.code='ETIMEDOUT';else if('string'==typeof i.response&&''!==i.response)try{a=JSON.parse(i.response)}catch(t){}a.status=i.status,t(a)}o()}},e.body&&e.body instanceof Blob?Dt(e.body,function(e){i.send(e)}):i.send(e.body),r}function Qn(e,t){return zo||e.xhr?Kn(e,t):Gn(e,t)}function Jn(){return''}function Zn(e,t){function n(t,n,s){if(!e.binary&&e.json&&'string'==typeof t)try{t=JSON.parse(t)}catch(t){return s(t)}Array.isArray(t)&&(t=t.map(function(e){return e.error||e.missing?O(e):e})),e.binary,s(null,t,n)}e=l(e);return e=Sr({method:'GET',headers:{},json:!0,processData:!0,timeout:1e4,cache:!1},e),e.json&&(!e.binary&&(e.headers.Accept='application/json'),e.headers['Content-Type']=e.headers['Content-Type']||'application/json'),e.binary&&(e.encoding=null,e.json=!1),e.processData||(e.json=!1),Qn(e,function(s,r,o){if(s)return t(O(s));var i=r.headers&&r.headers['content-type'],a=o||Jn(),d;if(!e.binary&&(e.json||!e.processData)&&'object'!=typeof a&&(/json/.test(i)||/^[\s]*\{/.test(a)&&/\}[\s]*$/.test(a)))try{a=JSON.parse(a.toString())}catch(t){}200<=r.statusCode&&300>r.statusCode?n(a,r,t):(d=O(a),d.status=r.statusCode,t(d))})}function es(e,t){var n=navigator&&navigator.userAgent?navigator.userAgent.toLowerCase():'',s=-1!==n.indexOf('safari')&&-1===n.indexOf('chrome'),r=-1!==n.indexOf('msie'),o=-1!==n.indexOf('trident'),i=-1!==n.indexOf('edge'),a=s||(r||o||i)&&'GET'===e.method,d=!('cache'in e)||e.cache,c=/^blob:/.test(e.url);if(!c&&(a||!d)){var l=-1!==e.url.indexOf('?');e.url+=(l?'&':'?')+'_nonce='+Date.now()}return Zn(e,t)}function ts(e,t){return new fr(function(n,s){function r(){c++,e[l++]().then(i,a)}function o(){++u===p?h?s(h):n():d()}function i(){c--,o()}function a(e){c--,h=h||e,o()}function d(){for(;c<t&&l<p;)r()}var c=0,l=0,u=0,p=e.length,h;d()})}function ns(e){var t=e.doc||e.ok,n=t._attachments;n&&Object.keys(n).forEach(function(e){var t=n[e];t.data=Ct(t.data,t.content_type)})}function ss(e){return /^_design/.test(e)?'_design/'+encodeURIComponent(e.slice(8)):/^_local/.test(e)?'_local/'+encodeURIComponent(e.slice(7)):encodeURIComponent(e)}function rs(e){return e._attachments&&Object.keys(e._attachments)?fr.all(Object.keys(e._attachments).map(function(t){var n=e._attachments[t];if(n.data&&'string'!=typeof n.data)return new fr(function(e){It(n.data,e)}).then(function(e){n.data=e})})):fr.resolve()}function os(e){if(!e.prefix)return!1;var t=M(e.prefix).protocol;return'http'===t||'https'===t}function is(e,t){if(os(t)){var n=t.name.substr(t.prefix.length);e=t.prefix+encodeURIComponent(n)}var s=M(e);(s.user||s.password)&&(s.auth={username:s.user,password:s.password});var r=s.path.replace(/(^\/|\/$)/g,'').split('/');return s.db=r.pop(),-1===s.db.indexOf('%')&&(s.db=encodeURIComponent(s.db)),s.path=r.join('/'),s}function as(e,t){return ds(e,e.db+'/'+t)}function ds(e,t){var n=e.path?'/':'';return e.protocol+'://'+e.host+(e.port?':'+e.port:'')+'/'+e.path+n+t}function cs(e){return'?'+Object.keys(e).map(function(t){return t+'='+encodeURIComponent(e[t])}).join('&')}function ls(e,t){function n(e,t,n){var s=(e||{}).ajax||{},r=Sr(l(h),s,t),o=l(h.headers||{});return r.headers=Sr(o,s.headers,t.headers||{}),c.constructor.listeners('debug').length&&c.constructor.emit('debug',['http',r.method,r.url]),c._ajax(r,n)}function o(e,t){return new fr(function(s,r){n(e,t,function(e,t){return e?r(e):void s(t)})})}function i(e,t){return _(e,tr()(function(n){a().then(function(){return t.apply(this,n)}).catch(function(t){var e=n.pop();e(t)})}))}function a(){if(e.skipSetup||e.skip_setup)return fr.resolve();if(y)return y;return y=o({},{method:'GET',url:p}).catch(function(e){return e&&e.status&&404===e.status?(C(404,'PouchDB is just detecting if the remote exists.'),o({},{method:'PUT',url:p})):fr.reject(e)}).catch(function(e){return e&&e.status&&412===e.status||fr.reject(e)}),y.catch(function(){y=null}),y}function d(e){return e.split('/').map(encodeURIComponent).join('/')}var c=this,u=is(e.name,e),p=as(u,'');e=l(e);var h=e.ajax||{};if(e.auth||u.auth){var g=e.auth||u.auth,f=g.username+':'+g.password,m=lo(unescape(encodeURIComponent(f)));h.headers=h.headers||{},h.headers.Authorization='Basic '+m}c._ajax=es;var y;sr()(function(){t(null,c)}),c._remote=!0,c.type=function(){return'http'},c.id=i('id',function(e){n({},{method:'GET',url:ds(u,'')},function(t,n){var s=n&&n.uuid?n.uuid+u.db:as(u,'');e(null,s)})}),c.request=i('request',function(e,t){e.url=as(u,e.url),n({},e,t)}),c.compact=i('compact',function(e,t){'function'==typeof e&&(t=e,e={}),e=l(e),n(e,{url:as(u,'_compact'),method:'POST'},function(){function n(){c.info(function(s,r){r&&!r.compact_running?t(null,{ok:!0}):setTimeout(n,e.interval||200)})}n()})}),c.bulkGet=_('bulkGet',function(e,t){function o(t){var s={};e.revs&&(s.revs=!0),e.attachments&&(s.attachments=!0),e.latest&&(s.latest=!0),n(e,{url:as(u,'_bulk_get'+cs(s)),method:'POST',body:{docs:e.docs}},function(n,s){!n&&e.attachments&&e.binary&&s.results.forEach(function(e){e.docs.forEach(ns)}),t(n,s)})}function i(){function n(e){return function(n,s){l[e]=s.results,++c===d&&t(null,{results:P(l)})}}for(var o=Ho,d=s(e.docs.length/o),c=0,l=Array(d),u=0,i;u<d;u++)i=v(e,['revs','attachments','binary','latest']),i.ajax=h,i.docs=e.docs.slice(u*o,r(e.docs.length,(u+1)*o)),k(a,i,n(u))}var a=this,d=ds(u,''),c=Go[d];'boolean'==typeof c?c?o(t):i():o(function(e,n){e?(Go[d]=!1,C(e.status,'PouchDB is just detecting if the remote supports the _bulk_get API.'),i()):(Go[d]=!0,t(null,n))})}),c._info=function(e){a().then(function(){n({},{method:'GET',url:as(u,'')},function(t,n){return t?e(t):void(n.host=as(u,''),e(null,n))})}).catch(e)},c.get=i('get',function(t,e,n){function s(t){function n(n){var r=s[n],i=ss(t._id)+'/'+d(n)+'?rev='+t._rev;return o(e,{method:'GET',url:as(u,i),binary:!0}).then(function(t){return e.binary?t:new fr(function(e){It(t,e)})}).then(function(e){delete r.stub,delete r.length,r.data=e})}var s=t._attachments,r=s&&Object.keys(s);if(s&&r.length){var i=r.map(function(e){return function(){return n(e)}});return ts(i,5)}}function r(e){return Array.isArray(e)?fr.all(e.map(function(e){if(e.ok)return s(e.ok)})):s(e)}'function'==typeof e&&(n=e,e={}),e=l(e);var i={};e.revs&&(i.revs=!0),e.revs_info&&(i.revs_info=!0),e.latest&&(i.latest=!0),e.open_revs&&('all'!==e.open_revs&&(e.open_revs=JSON.stringify(e.open_revs)),i.open_revs=e.open_revs),e.rev&&(i.rev=e.rev),e.conflicts&&(i.conflicts=e.conflicts),e.update_seq&&(i.update_seq=e.update_seq),t=ss(t);var a={method:'GET',url:as(u,t+cs(i))};o(e,a).then(function(t){return fr.resolve().then(function(){if(e.attachments)return r(t)}).then(function(){n(null,t)})}).catch(function(s){s.docId=t,n(s)})}),c.remove=i('remove',function(e,t,s,r){var o;'string'==typeof t?(o={_id:e,_rev:t},'function'==typeof s&&(r=s,s={})):(o=e,'function'==typeof t?(r=t,s={}):(r=s,s=t));var i=o._rev||s.rev;n(s,{method:'DELETE',url:as(u,ss(o._id))+'?rev='+i},r)}),c.getAttachment=i('getAttachment',function(e,t,s,r){'function'==typeof s&&(r=s,s={});var o=s.rev?'?rev='+s.rev:'',i=as(u,ss(e))+'/'+d(t)+o;n(s,{method:'GET',url:i,binary:!0},r)}),c.removeAttachment=i('removeAttachment',function(e,t,s,r){var o=as(u,ss(e)+'/'+d(t))+'?rev='+s;n({},{method:'DELETE',url:o},r)}),c.putAttachment=i('putAttachment',function(e,t,s,r,o,i){'function'==typeof o&&(i=o,o=r,r=s,s=null);var a=ss(e)+'/'+d(t),c=as(u,a);if(s&&(c+='?rev='+s),'string'==typeof r){var l;try{l=co(r)}catch(e){return i(R(Ir,'Attachment is not a valid base64 string'))}r=l?Lt(l,o):''}var p={headers:{"Content-Type":o},method:'PUT',url:c,processData:!1,body:r,timeout:h.timeout||6e4};n({},p,i)}),c._bulkDocs=function(e,t,s){e.new_edits=t.new_edits,a().then(function(){return fr.all(e.docs.map(rs))}).then(function(){n(t,{method:'POST',url:as(u,'_bulk_docs'),timeout:t.timeout,body:e},function(e,t){return e?s(e):void(t.forEach(function(e){e.ok=!0}),s(null,t))})}).catch(s)},c._put=function(e,t,s){a().then(function(){return rs(e)}).then(function(){n(t,{method:'PUT',url:as(u,ss(e._id)),body:e},function(t,n){return t?(t.docId=e&&e._id,s(t)):void s(null,n)})}).catch(s)},c.allDocs=i('allDocs',function(e,t){'function'==typeof e&&(t=e,e={}),e=l(e);var n={},s='GET',r;e.conflicts&&(n.conflicts=!0),e.update_seq&&(n.update_seq=!0),e.descending&&(n.descending=!0),e.include_docs&&(n.include_docs=!0),e.attachments&&(n.attachments=!0),e.key&&(n.key=JSON.stringify(e.key)),e.start_key&&(e.startkey=e.start_key),e.startkey&&(n.startkey=JSON.stringify(e.startkey)),e.end_key&&(e.endkey=e.end_key),e.endkey&&(n.endkey=JSON.stringify(e.endkey)),'undefined'!=typeof e.inclusive_end&&(n.inclusive_end=!!e.inclusive_end),'undefined'!=typeof e.limit&&(n.limit=e.limit),'undefined'!=typeof e.skip&&(n.skip=e.skip);var i=cs(n);'undefined'!=typeof e.keys&&(s='POST',r={keys:e.keys}),o(e,{method:s,url:as(u,'_all_docs'+i),body:r}).then(function(n){e.include_docs&&e.attachments&&e.binary&&n.rows.forEach(ns),t(null,n)}).catch(t)}),c._changes=function(e){var t='batch_size'in e?e.batch_size:Wo;e=l(e),e.continuous&&!('heartbeat'in e)&&(e.heartbeat=Xo);var s='timeout'in e?e.timeout:'timeout'in h?h.timeout:30000;'timeout'in e&&e.timeout&&s-e.timeout<Vo&&(s=e.timeout+Vo),'heartbeat'in e&&e.heartbeat&&s-e.heartbeat<Vo&&(s=e.heartbeat+Vo);var r={};'timeout'in e&&e.timeout&&(r.timeout=e.timeout);var o='undefined'!=typeof e.limit&&e.limit,i;i='return_docs'in e?e.return_docs:!('returnDocs'in e)||e.returnDocs;var d=o;if(e.style&&(r.style=e.style),(e.include_docs||e.filter&&'function'==typeof e.filter)&&(r.include_docs=!0),e.attachments&&(r.attachments=!0),e.continuous&&(r.feed='longpoll'),e.seq_interval&&(r.seq_interval=e.seq_interval),e.conflicts&&(r.conflicts=!0),e.descending&&(r.descending=!0),e.update_seq&&(r.update_seq=!0),'heartbeat'in e&&e.heartbeat&&(r.heartbeat=e.heartbeat),e.filter&&'string'==typeof e.filter&&(r.filter=e.filter),e.view&&'string'==typeof e.view&&(r.filter='_view',r.view=e.view),e.query_params&&'object'==typeof e.query_params)for(var c in e.query_params)e.query_params.hasOwnProperty(c)&&(r[c]=e.query_params[c]);var p='GET',_;e.doc_ids?(r.filter='_doc_ids',p='POST',_={doc_ids:e.doc_ids}):e.selector&&(r.filter='_selector',p='POST',_={selector:e.selector});var g=function(i,c){if(!e.aborted){r.since=i,'object'==typeof r.since&&(r.since=JSON.stringify(r.since)),e.descending?o&&(r.limit=d):r.limit=!o||d>t?t:d;var l={method:p,url:as(u,'_changes'+cs(r)),timeout:s,body:_};v=i,e.aborted||a().then(function(){y=n(e,l,c)}).catch(c)}},f={results:[]},m=function(n,s){if(!e.aborted){var r=0;if(s&&s.results){r=s.results.length,f.last_seq=s.last_seq;var a=null,l=null;'number'==typeof s.pending&&(a=s.pending),('string'==typeof f.last_seq||'number'==typeof f.last_seq)&&(l=f.last_seq);({}).query=e.query_params,s.results=s.results.filter(function(t){d--;var n=D(e)(t);return n&&(e.include_docs&&e.attachments&&e.binary&&ns(t),i&&f.results.push(t),e.onChange(t,a,l)),n})}else if(n)return e.aborted=!0,void e.complete(n);s&&s.last_seq&&(v=s.last_seq);var c=o&&0>=d||s&&r<t||e.descending;(!e.continuous||o&&0>=d)&&c?e.complete(null,f):sr()(function(){g(v,m)})}},y,v;return g(e.since||0,m),{cancel:function(){e.aborted=!0,y&&y.abort()}}},c.revsDiff=i('revsDiff',function(e,t,s){'function'==typeof t&&(s=t,t={}),n(t,{method:'POST',url:as(u,'_revs_diff'),body:e},s)}),c._close=function(e){e()},c._destroy=function(e,t){n(e,{url:as(u,''),method:'DELETE'},function(e,n){return e&&e.status&&404!==e.status?t(e):void t(null,n)})}}function us(e){this.status=400,this.name='query_parse_error',this.message=e,this.error=!0;try{Error.captureStackTrace(this,us)}catch(t){}}function ps(e){this.status=404,this.name='not_found',this.message=e,this.error=!0;try{Error.captureStackTrace(this,ps)}catch(t){}}function hs(e){this.status=500,this.name='invalid_value',this.message=e,this.error=!0;try{Error.captureStackTrace(this,hs)}catch(t){}}function _s(e,t){return t&&e.then(function(e){sr()(function(){t(null,e)})},function(e){sr()(function(){t(e)})}),e}function gs(e){return tr()(function(t){var n=t.pop(),s=e.apply(this,t);return'function'==typeof n&&_s(s,n),s})}function fs(e,t){return e.then(function(e){return t().then(function(){return e})},function(e){return t().then(function(){throw e})})}function ms(e,t){return function(){var n=arguments,s=this;return e.add(function(){return t.apply(s,n)})}}function ys(e){var t=new vr(e),n=Array(t.size),s=-1;return t.forEach(function(e){n[++s]=e}),n}function vs(e){var t=Array(e.size),n=-1;return e.forEach(function(e,s){t[++n]=s}),t}function bs(e){return new hs('builtin '+e+' function requires map values to be numbers or number arrays')}function Es(e){for(var t=0,n=0,s=e.length,r;n<s;n++)if(r=e[n],'number'==typeof r)'number'==typeof t?t+=r:t[0]+=r;else if(Array.isArray(r)){t='number'==typeof t?[t]:t;for(var o=0,i=r.length,a;o<i;o++)if(a=r[o],'number'!=typeof a)throw bs('_sum');else'undefined'==typeof t[o]?t.push(a):t[o]+=a}else throw bs('_sum');return t}function ks(e,t){return Y('return ('+e.replace(/;\s*$/,'')+');',{emit:t,sum:Es,log:Ko,isArray:Qo,toJSON:Jo})}function ws(){this.promise=new fr(function(e){e()})}function Ss(e){if(!e)return'undefined';switch(typeof e){case'function':return e.toString();case'string':return e.toString();default:return JSON.stringify(e);}}function qs(e,t){return Ss(e)+Ss(t)+'undefined'}function xs(e,t,n,s,r,o){var i=qs(n,s),a;if(!r&&(a=e._cachedViews=e._cachedViews||{},a[i]))return a[i];var d=e.info().then(function(d){var c=d.db_name+'-mrview-'+(r?'temp':Ft(i));return z(e,'_local/'+o,function(e){e.views=e.views||{};var n=t;-1===n.indexOf('/')&&(n=t+'/'+t);var s=e.views[n]=e.views[n]||{};if(!s[c])return s[c]=!0,e}).then(function(){return e.registerDependentDatabase(c).then(function(t){var r=t.db;r.auto_compaction=!0;var o={name:c,db:r,sourceDB:e,adapter:e.adapter,mapFun:n,reduceFun:s};return o.db.get('_local/lastSeq').catch(function(e){if(404!==e.status)throw e}).then(function(e){return o.seq=e?e.seq:0,a&&o.db.once('destroyed',function(){delete a[i]}),o})})})});return a&&(a[i]=d),d}function As(e){return-1===e.indexOf('/')?[e,e]:e.split('/')}function Ts(e){return 1===e.length&&/^1-/.test(e[0].rev)}function Ls(t,n){try{t.emit('error',n)}catch(e){A('error','The user\'s map/reduce function threw an uncaught error.\nYou can debug this error by doing:\nmyDatabase.on(\'error\', function (err) { debugger; });\nPlease double-check your map/reduce function.'),A('error',n)}}function Cs(e){if(/^_sum/.test(e))return ni._sum;if(/^_count/.test(e))return ni._count;if(/^_stats/.test(e))return ni._stats;if(/^_/.test(e))throw new Error(e+' is not a supported reduce function.')}function js(e){return /^1-/.test(e)}function Rs(e,t,n){return!e._attachments||!e._attachments[n]||e._attachments[n].digest!==t._attachments[n].digest}function Os(e,t){var n=Object.keys(t._attachments);return fr.all(n.map(function(n){return e.getAttachment(t._id,n,{rev:t._rev})}))}function Is(e,t,n){var s=B(t)&&!B(e),r=Object.keys(n._attachments);return s?e.get(n._id).then(function(s){return fr.all(r.map(function(r){return Rs(s,n,r)?t.getAttachment(n._id,r):e.getAttachment(s._id,r)}))}).catch(function(e){if(404!==e.status)throw e;return Os(t,n)}):Os(t,n)}function Ds(e){var t=[];return Object.keys(e).forEach(function(n){var s=e[n].missing;s.forEach(function(e){t.push({id:n,rev:e})})}),{docs:t,revs:!0,latest:!0}}function Ps(e,t,n,s){function r(e){return e._attachments&&0<Object.keys(e._attachments).length}function o(e){return e._conflicts&&0<e._conflicts.length}function i(t){return e.allDocs({keys:t,include_docs:!0,conflicts:!0}).then(function(e){if(s.cancelled)throw new Error('cancelled');e.rows.forEach(function(e){e.deleted||!e.doc||!js(e.value.rev)||r(e.doc)||o(e.doc)||(e.doc._conflicts&&delete e.doc._conflicts,a.push(e.doc),delete n[e.id])})})}n=l(n);var a=[],d=!0;return fr.resolve().then(function(){var e=Object.keys(n).filter(function(e){var t=n[e].missing;return 1===t.length&&js(t[0])});if(0<e.length)return i(e)}).then(function(){var r=Ds(n);return r.docs.length?e.bulkGet(r).then(function(n){if(s.cancelled)throw new Error('cancelled');return fr.all(n.results.map(function(n){return fr.all(n.docs.map(function(n){var s=n.ok;return n.error&&(d=!1),s&&s._attachments?Is(t,e,s).then(function(e){var t=Object.keys(s._attachments);return e.forEach(function(e,n){var r=s._attachments[t[n]];delete r.stub,delete r.length,r.data=e}),s}):s}))})).then(function(e){a=a.concat(P(e).filter(Boolean))})}):void 0}).then(function(){return{ok:d,docs:a}})}function Ns(e,t,n,s,r){return e.get(t).catch(function(n){if(404===n.status)return('http'===e.adapter||'https'===e.adapter)&&C(404,'PouchDB is just checking if a remote checkpoint exists.'),{session_id:s,_id:t,history:[],replicator:oi,version:ri};throw n}).then(function(o){if(!r.cancelled)return o.last_seq===n?void 0:(o.history=(o.history||[]).filter(function(e){return e.session_id!==s}),o.history.unshift({last_seq:n,session_id:s}),o.history=o.history.slice(0,ii),o.version=ri,o.replicator=oi,o.session_id=s,o.last_seq=n,e.put(o).catch(function(o){if(409===o.status)return Ns(e,t,n,s,r);throw o}))})}function Bs(e,t,n,s,r){this.src=e,this.target=t,this.id=n,this.returnValue=s,this.opts=r||{}}function Us(e,t){return e.session_id===t.session_id?{last_seq:e.last_seq,history:e.history}:$s(e.history,t.history)}function $s(e,t){var n=e[0],s=e.slice(1),r=t[0],o=t.slice(1);if(!n||0===t.length)return{last_seq:ai,history:[]};var i=n.session_id;if(Fs(i,t))return{last_seq:n.last_seq,history:e};var a=r.session_id;return Fs(a,s)?{last_seq:r.last_seq,history:o}:$s(s,o)}function Fs(e,t){var n=t[0],s=t.slice(1);return e&&0!==t.length&&(!(e!==n.session_id)||Fs(e,s))}function Ms(e){return'number'==typeof e.status&&4===Math.floor(e.status/100)}function Ys(e,t,n,s){if(!1===e.retry)return t.emit('error',n),void t.removeAllListeners();if('function'!=typeof e.back_off_function&&(e.back_off_function=L),t.emit('requestError',n),'active'===t.state||'pending'===t.state){t.emit('paused',n),t.state='stopped';var r=function(){e.current_back_off=ci},o=function(){t.removeListener('active',r)};t.once('paused',o),t.once('active',r)}e.current_back_off=e.current_back_off||ci,e.current_back_off=e.back_off_function(e.current_back_off),setTimeout(s,e.current_back_off)}function zs(e){return Object.keys(e).sort(ze).reduce(function(t,n){return t[n]=e[n],t},{})}function Ws(e,t,n){var s=n.doc_ids?n.doc_ids.sort(ze):'',r=n.filter?n.filter.toString():'',o='',i='',a='';return n.selector&&(a=JSON.stringify(n.selector)),n.filter&&n.query_params&&(o=JSON.stringify(zs(n.query_params))),n.filter&&'_view'===n.filter&&(i=n.view.toString()),fr.all([e.id(),t.id()]).then(function(e){var t=e[0]+e[1]+r+i+o+s+a;return new fr(function(e){$t(t,e)})}).then(function(e){return e=e.replace(/\//g,'.').replace(/\+/g,'_'),'_local/'+e})}function Hs(e,t,n,s,r){function o(){return $?fr.resolve():Ws(e,t,n).then(function(r){U=r;var o={};o=!1===n.checkpoint?{writeSourceCheckpoint:!1,writeTargetCheckpoint:!1}:'source'===n.checkpoint?{writeSourceCheckpoint:!0,writeTargetCheckpoint:!1}:'target'===n.checkpoint?{writeSourceCheckpoint:!1,writeTargetCheckpoint:!0}:{writeSourceCheckpoint:!0,writeTargetCheckpoint:!0},$=new Bs(e,t,U,s,o)})}function i(){if(I=[],0!==B.docs.length){var e=B.docs,o={timeout:n.timeout};return t.bulkDocs({docs:e,new_edits:!1},o).then(function(t){if(s.cancelled)throw _(),new Error('cancelled');var n=Object.create(null);t.forEach(function(e){e.error&&(n[e.id]=e)});var o=Object.keys(n).length;r.doc_write_failures+=o,r.docs_written+=e.length-o,e.forEach(function(e){var t=n[e._id];if(t){r.errors.push(t);var o=(t.name||'').toLowerCase();if('unauthorized'===o||'forbidden'===o)s.emit('denied',l(t));else throw t}else I.push(e)})},function(t){throw r.doc_write_failures+=e.length,t})}}function a(){if(B.error)throw new Error('There was a problem getting docs.');r.last_seq=x=B.seq;var e=l(r);return I.length&&(e.docs=I,'number'==typeof B.pending&&(e.pending=B.pending,delete B.pending),s.emit('change',e)),w=!0,$.writeCheckpoint(B.seq,P).then(function(){if(w=!1,s.cancelled)throw _(),new Error('cancelled');B=void 0,y()}).catch(function(e){throw b(e),e})}function d(){var e={};return B.changes.forEach(function(t){'_user/'===t.id||(e[t.id]=t.changes.map(function(e){return e.rev}))}),t.revsDiff(e).then(function(e){if(s.cancelled)throw _(),new Error('cancelled');B.diffs=e})}function c(){return Ps(e,t,B.diffs,s).then(function(e){B.error=!e.ok,e.docs.forEach(function(e){delete B.diffs[e._id],r.docs_read++,B.docs.push(e)})})}function u(){return s.cancelled||B?void 0:0===E.length?void p(!0):void(B=E.shift(),d().then(c).then(i).then(a).then(u).catch(function(e){h('batch processing terminated with error',e)}))}function p(e){return 0===k.changes.length?void(0!==E.length||B||((A&&F.live||S)&&(s.state='pending',s.emit('paused')),S&&_())):void((e||S||k.changes.length>=T)&&(E.push(k),k={seq:0,changes:[],docs:[]},('pending'===s.state||'stopped'===s.state)&&(s.state='active',s.emit('active')),u()))}function h(e,t){q||(!t.message&&(t.message=e),r.ok=!1,r.status='aborting',E=[],k={seq:0,changes:[],docs:[]},_(t))}function _(o){if(!q&&!(s.cancelled&&(r.status='cancelled',w)))if(r.status=r.status||'complete',r.end_time=new Date,r.last_seq=x,q=!0,o){o=R(o),o.result=r;var i=(o.name||'').toLowerCase();'unauthorized'===i||'forbidden'===i?(s.emit('error',o),s.removeAllListeners()):Ys(n,s,o,function(){Hs(e,t,n,s)})}else s.emit('complete',r),s.removeAllListeners()}function g(e,t,r){if(s.cancelled)return _();'number'==typeof t&&(k.pending=t);var o=D(n)(e);o&&(k.seq=e.seq||r,k.changes.push(e),p(0===E.length&&F.live))}function f(e){if(C=!1,s.cancelled)return _();if(0<e.results.length)F.since=e.last_seq,y(),p(!0);else{var t=function(){A?(F.live=!0,y()):S=!0,p(!0)};B||0!==e.results.length?t():(w=!0,$.writeCheckpoint(e.last_seq,P).then(function(){w=!1,r.last_seq=x=e.last_seq,t()}).catch(b))}}function m(e){return C=!1,s.cancelled?_():void h('changes rejected',e)}function y(){function t(){o.cancel()}function r(){s.removeListener('cancel',t)}if(!(C||S||!(E.length<L))){C=!0,s._changes&&(s.removeListener('cancel',s._abortChanges),s._changes.cancel()),s.once('cancel',t);var o=e.changes(F).on('change',g);o.then(r,r),o.then(f).catch(m),n.retry&&(s._changes=o,s._abortChanges=t)}}function v(){o().then(function(){return s.cancelled?void _():$.getCheckpoint().then(function(e){x=e,F={since:x,limit:T,batch_size:T,style:'all_docs',doc_ids:j,selector:O,return_docs:!0},!1!==N&&(F.seq_interval=N||T),n.filter&&('string'==typeof n.filter?F.filter=n.filter:F.include_docs=!0),'heartbeat'in n&&(F.heartbeat=n.heartbeat),'timeout'in n&&(F.timeout=n.timeout),n.query_params&&(F.query_params=n.query_params),n.view&&(F.view=n.view),y()})}).catch(function(e){h('getCheckpoint rejected with ',e)})}function b(e){w=!1,h('writeCheckpoint completed with error',e)}var E=[],k={seq:0,changes:[],docs:[]},w=!1,S=!1,q=!1,x=0,A=n.continuous||n.live||!1,T=n.batch_size||100,L=n.batches_limit||10,C=!1,j=n.doc_ids,O=n.selector,I=[],P=Zr(),N=n.seq_interval,B,U,$;r=r||{ok:!0,start_time:new Date,docs_read:0,docs_written:0,doc_write_failures:0,errors:[]};var F={};return s.ready(e,t),s.cancelled?void _():void(!s._addedListeners&&(s.once('cancel',_),'function'==typeof n.complete&&(s.once('error',n.complete),s.once('complete',function(e){n.complete(null,e)})),s._addedListeners=!0),'undefined'==typeof n.since?v():o().then(function(){return w=!0,$.writeCheckpoint(n.since,P)}).then(function(){return w=!1,s.cancelled?void _():void(x=n.since,v())}).catch(b))}function Vs(){rr.EventEmitter.call(this),this.cancelled=!1,this.state='pending';var e=this,t=new fr(function(t,n){e.once('complete',t),e.once('error',n)});e.then=function(e,n){return t.then(e,n)},e.catch=function(e){return t.catch(e)},e.catch(function(){})}function Xs(e,t){var n=t.PouchConstructor;return'string'==typeof e?new n(e,t):e}function Gs(e,t,n,s){if('function'==typeof n&&(s=n,n={}),'undefined'==typeof n&&(n={}),n.doc_ids&&!Array.isArray(n.doc_ids))throw R(Br,'`doc_ids` filter parameter is not a list.');n.complete=s,n=l(n),n.continuous=n.continuous||n.live,n.retry=!!('retry'in n)&&n.retry,n.PouchConstructor=n.PouchConstructor||this;var r=new Vs(n),o=Xs(e,n),i=Xs(t,n);return Hs(o,i,n,r),r}function Ks(e,t,n,s){return'function'==typeof n&&(s=n,n={}),'undefined'==typeof n&&(n={}),n=l(n),n.PouchConstructor=n.PouchConstructor||this,e=Xs(e,n),t=Xs(t,n),new Qs(e,t,n,s)}function Qs(e,t,n,s){function r(e){_.emit('change',{direction:'pull',change:e})}function o(e){_.emit('change',{direction:'push',change:e})}function i(e){_.emit('denied',{direction:'push',doc:e})}function a(e){_.emit('denied',{direction:'pull',doc:e})}function d(){_.pushPaused=!0,_.pullPaused&&_.emit('paused')}function c(){_.pullPaused=!0,_.pushPaused&&_.emit('paused')}function l(){_.pushPaused=!1,_.pullPaused&&_.emit('active',{direction:'push'})}function u(){_.pullPaused=!1,_.pushPaused&&_.emit('active',{direction:'pull'})}function p(e){return function(t,n){('change'===t&&(n===r||n===o)||'denied'===t&&(n===a||n===i)||'paused'===t&&(n===c||n===d)||'active'===t&&(n===u||n===l))&&(!(t in m)&&(m[t]={}),m[t][e]=!0,2===Object.keys(m[t]).length&&_.removeAllListeners(t))}}function h(e,t,n){-1==e.listeners(t).indexOf(n)&&e.on(t,n)}var _=this;this.canceled=!1;var g=n.push?Sr({},n,n.push):n,f=n.pull?Sr({},n,n.pull):n;this.push=Gs(e,t,g),this.pull=Gs(t,e,f),this.pushPaused=!0,this.pullPaused=!0;var m={};n.live&&(this.push.on('complete',_.pull.cancel.bind(_.pull)),this.pull.on('complete',_.push.cancel.bind(_.push))),this.on('newListener',function(e){'change'===e?(h(_.pull,'change',r),h(_.push,'change',o)):'denied'===e?(h(_.pull,'denied',a),h(_.push,'denied',i)):'active'===e?(h(_.pull,'active',u),h(_.push,'active',l)):'paused'===e&&(h(_.pull,'paused',c),h(_.push,'paused',d))}),this.on('removeListener',function(e){'change'===e?(_.pull.removeListener('change',r),_.push.removeListener('change',o)):'denied'===e?(_.pull.removeListener('denied',a),_.push.removeListener('denied',i)):'active'===e?(_.pull.removeListener('active',u),_.push.removeListener('active',l)):'paused'===e&&(_.pull.removeListener('paused',c),_.push.removeListener('paused',d))}),this.pull.on('removeListener',p('pull')),this.push.on('removeListener',p('push'));var y=fr.all([this.push,this.pull]).then(function(e){var t={push:e[0],pull:e[1]};return _.emit('complete',t),s&&s(null,t),_.removeAllListeners(),t},function(e){if(_.cancel(),s?s(e):_.emit('error',e),_.removeAllListeners(),s)throw e});this.then=function(e,t){return y.then(e,t)},this.catch=function(e){return y.catch(e)}}var Js=n(13),Zs=n.n(Js),er=n(14),tr=n.n(er),nr=n(1),sr=n.n(nr),rr=n(2),or=n.n(rr),ir=n(15),ar=n.n(ir),dr=n(16),cr=n.n(dr),lr=n(19),ur=n.n(lr),pr=n(23),hr=n.n(pr),_r=n(24),gr=n.n(_r),fr='function'==typeof Promise?Promise:Zs.a,mr=Function.prototype.toString,yr=mr.call(Object);m.prototype.get=function(e){var t=g(e);return this._store[t]},m.prototype.set=function(e,t){var n=g(e);return this._store[n]=t,!0},m.prototype.has=function(e){var t=g(e);return t in this._store},m.prototype.delete=function(e){var t=g(e),n=t in this._store;return delete this._store[t],n},m.prototype.forEach=function(e){for(var t=Object.keys(this._store),n=0,s=t.length;n<s;n++){var r=t[n],o=this._store[r];r=f(r),e(o,r)}},Object.defineProperty(m.prototype,'size',{get:function(){return Object.keys(this._store).length}}),y.prototype.add=function(e){return this._store.set(e,!0)},y.prototype.has=function(e){return this._store.has(e)},y.prototype.forEach=function(e){this._store.forEach(function(t,n){e(n)})},Object.defineProperty(y.prototype,'size',{get:function(){return this._store.size}});var vr,br;(function(){if('undefined'==typeof Symbol||'undefined'==typeof Map||'undefined'==typeof Set)return!1;var e=Object.getOwnPropertyDescriptor(Map,Symbol.species);return e&&'get'in e&&Map[Symbol.species]===Map})()?(vr=Set,br=Map):(vr=y,br=m);var Er=6,kr;if(w())kr=!1;else try{localStorage.setItem('_pouch_check_localstorage',1),kr=!!localStorage.getItem('_pouch_check_localstorage')}catch(t){kr=!1}ar()(x,rr.EventEmitter),x.prototype.addListener=function(e,t,n,s){function r(){function e(){i=!1}if(o._listeners[t]){if(i)return void(i='waiting');i=!0;var a=v(s,['style','include_docs','attachments','conflicts','filter','doc_ids','view','since','query_params','binary']);n.changes(a).on('change',function(e){e.seq>s.since&&!s.cancelled&&(s.since=e.seq,s.onChange(e))}).on('complete',function(){'waiting'===i&&sr()(r),i=!1}).on('error',e)}}if(!this._listeners[t]){var o=this,i=!1;this._listeners[t]=r,this.on(e,r)}},x.prototype.removeListener=function(e,t){t in this._listeners&&(rr.EventEmitter.prototype.removeListener.call(this,e,this._listeners[t]),delete this._listeners[t])},x.prototype.notifyLocalWindows=function(e){w()?chrome.storage.local.set({dbName:e}):S()&&(localStorage[e]='a'===localStorage[e]?'b':'a')},x.prototype.notify=function(e){this.emit(e),this.notifyLocalWindows(e)};var wr='function'==typeof Object.assign?Object.assign:function(e){for(var t=Object(e),n=1,s;n<arguments.length;n++)if(s=arguments[n],null!=s)for(var r in s)Object.prototype.hasOwnProperty.call(s,r)&&(t[r]=s[r]);return t};var Sr=wr;ar()(j,Error),j.prototype.toString=function(){return JSON.stringify({status:this.status,name:this.name,message:this.message,reason:this.reason})};var qr=new j(401,'unauthorized','Name or password is incorrect.'),xr=new j(400,'bad_request','Missing JSON list of \'docs\''),Ar=new j(404,'not_found','missing'),Tr=new j(409,'conflict','Document update conflict'),Lr=new j(400,'bad_request','_id field must contain a string'),Cr=new j(412,'missing_id','_id is required for puts'),jr=new j(400,'bad_request','Only reserved document ids may start with underscore.'),Rr=new j(412,'precondition_failed','Database not open'),Or=new j(500,'unknown_error','Database encountered an unknown error'),Ir=new j(500,'badarg','Some query argument is invalid'),Dr=new j(400,'invalid_request','Request was invalid'),Pr=new j(400,'query_parse_error','Some query parameter is invalid'),Nr=new j(500,'doc_validation','Bad special document member'),Br=new j(400,'bad_request','Something wrong with the request'),Ur=new j(400,'bad_request','Document must be a JSON object'),$r=new j(404,'not_found','Database not found'),Fr=new j(500,'indexed_db_went_bad','unknown'),Mr=new j(500,'web_sql_went_bad','unknown'),Yr=new j(500,'levelDB_went_went_bad','unknown'),zr=new j(403,'forbidden','Forbidden by design doc validate_doc_update function'),Wr=new j(400,'bad_request','Invalid rev format'),Hr=new j(412,'file_exists','The database could not be created, the file already exists.'),Vr=new j(412,'missing_stub','A pre-existing attachment stub wasn\'t found'),Xr=new j(413,'invalid_url','Provided URL is invalid'),Gr=['source','protocol','authority','userInfo','user','password','host','port','relative','path','directory','file','query','anchor'],Kr='queryKey',Qr=/(?:^|&)([^&=]*)=?([^&]*)/g,Jr=/^(?:(?![^:@]+:[^:@\/]*@)([^:\/?#.]+):)?(?:\/\/)?((?:(([^:@]*)(?::([^:@]*))?)?@)?([^:\/?#]*)(?::(\d*))?)(((\/(?:[^?#](?![^?#\/]*\.[^?#\/.]+(?:[?#]|$)))*\/?)?([^?#\/]*))(?:\?([^#]*))?(?:#(.*))?)/,Zr=cr.a.v4;ar()(ge,rr.EventEmitter),ge.prototype.cancel=function(){this.isCancelled=!0,this.db.taskqueue.isReady&&this.emit('cancel')},ge.prototype.validateChanges=function(e){var t=e.complete,n=this;Le._changesFilterPlugin?Le._changesFilterPlugin.validate(e,function(s){return s?t(s):void n.doChanges(e)}):n.doChanges(e)},ge.prototype.doChanges=function(e){var t=this,n=e.complete;if(e=l(e),'live'in e&&!('continuous'in e)&&(e.continuous=e.live),e.processChange=fe,'latest'===e.since&&(e.since='now'),e.since||(e.since=0),'now'===e.since)return void this.db.info().then(function(s){return t.isCancelled?void n(null,{status:'cancelled'}):void(e.since=s.update_seq,t.doChanges(e))},n);if(!Le._changesFilterPlugin)['doc_ids','filter','selector','view'].forEach(function(t){t in e&&A('warn','The "'+t+'" option was passed in to changes/replicate, but pouchdb-changes-filter plugin is not installed, so it was ignored. Please install the plugin to enable filtering.')});else if(Le._changesFilterPlugin.normalize(e),Le._changesFilterPlugin.shouldFilter(this,e))return Le._changesFilterPlugin.filter(this,e);'descending'in e||(e.descending=!1),e.limit=0===e.limit?1:e.limit,e.complete=n;var s=this.db._changes(e);if(s&&'function'==typeof s.cancel){var r=t.cancel;t.cancel=tr()(function(e){s.cancel(),r.apply(this,e)})}},ar()(qe,rr.EventEmitter),qe.prototype.post=_('post',function(e,t,n){return'function'==typeof t&&(n=t,t={}),'object'!=typeof e||Array.isArray(e)?n(R(Ur)):void this.bulkDocs({docs:[e]},t,ye(n,e._id))}),qe.prototype.put=_('put',function(e,t,n){function s(n){'function'==typeof r._put&&!1!==t.new_edits?r._put(e,t,n):r.bulkDocs({docs:[e]},t,ye(n,e._id))}if('function'==typeof t&&(n=t,t={}),'object'!=typeof e||Array.isArray(e))return n(R(Ur));if(N(e._id),pe(e._id)&&'function'==typeof this._putLocal)return e._deleted?this._removeLocal(e,n):this._putLocal(e,n);var r=this;t.force&&e._rev?(function(){var n=e._rev.split('-'),s=n[1],r=parseInt(n[0],10),o=r+1,i=H();e._revisions={start:o,ids:[i,s]},e._rev=o+'-'+i,t.new_edits=!1}(),s(function(t){var s=t?null:{ok:!0,id:e._id,rev:e._rev};n(t,s)})):s(n)}),qe.prototype.putAttachment=_('putAttachment',function(e,t,n,s,r){function o(e){var n='_rev'in e?parseInt(e._rev,10):0;return e._attachments=e._attachments||{},e._attachments[t]={content_type:r,data:s,revpos:++n},i.put(e)}var i=this;return'function'==typeof r&&(r=s,s=n,n=null),'undefined'==typeof r&&(r=s,s=n,n=null),r||A('warn','Attachment',t,'on document',e,'is missing content_type'),i.get(e).then(function(e){if(e._rev!==n)throw R(Tr);return o(e)},function(t){if(t.reason===Ar.message)return o({_id:e});throw t})}),qe.prototype.removeAttachment=_('removeAttachment',function(e,t,n,s){var r=this;r.get(e,function(e,o){return e?void s(e):o._rev===n?o._attachments?void(delete o._attachments[t],0===Object.keys(o._attachments).length&&delete o._attachments,r.put(o,s)):s():void s(R(Tr))})}),qe.prototype.remove=_('remove',function(e,t,n,s){var r;'string'==typeof t?(r={_id:e,_rev:t},'function'==typeof n&&(s=n,n={})):(r=e,'function'==typeof t?(s=t,n={}):(s=n,n=t)),n=n||{},n.was_delete=!0;var o={_id:r._id,_rev:r._rev||n.rev,_deleted:!0};return pe(o._id)&&'function'==typeof this._removeLocal?this._removeLocal(r,s):void this.bulkDocs({docs:[o]},n,ye(s,o._id))}),qe.prototype.revsDiff=_('revsDiff',function(e,t,n){function s(e,t){a.has(e)||a.set(e,{missing:[]}),a.get(e).missing.push(t)}function r(t,n){var r=e[t].slice(0);X(n,function(e,n,o,i,a){var d=n+'-'+o,c=r.indexOf(d);-1===c||(r.splice(c,1),'available'!==a.status&&s(t,d))}),r.forEach(function(e){s(t,e)})}'function'==typeof t&&(n=t,t={});var o=Object.keys(e);if(!o.length)return n(null,{});var i=0,a=new br;o.map(function(t){this._getRevisionTree(t,function(s,d){if(s&&404===s.status&&'missing'===s.message)a.set(t,{missing:e[t]});else{if(s)return n(s);r(t,d)}if(++i===o.length){var c={};return a.forEach(function(e,t){c[t]=e}),n(null,c)}})},this)}),qe.prototype.bulkGet=_('bulkGet',function(e,t){k(this,e,t)}),qe.prototype.compactDocument=_('compactDocument',function(e,t,n){var s=this;this._getRevisionTree(e,function(r,o){if(r)return n(r);var i=Ee(o),a=[],d=[];Object.keys(i).forEach(function(e){i[e]>t&&a.push(e)}),X(o,function(e,t,n,s,r){var o=t+'-'+n;'available'===r.status&&-1!==a.indexOf(o)&&d.push(o)}),s._doCompaction(e,d,n)})}),qe.prototype.compact=_('compact',function(e,t){'function'==typeof e&&(t=e,e={});var n=this;e=e||{},n._compactionQueue=n._compactionQueue||[],n._compactionQueue.push({opts:e,callback:t}),1===n._compactionQueue.length&&we(n)}),qe.prototype._compact=function(e,t){var n=this,s={return_docs:!1,last_seq:e.last_seq||0},r=[];n.changes(s).on('change',function(e){r.push(n.compactDocument(e.id,0))}).on('complete',function(e){var s=e.last_seq;fr.all(r).then(function(){return z(n,'_local/compaction',function(e){return(!e.last_seq||e.last_seq<s)&&(e.last_seq=s,e)})}).then(function(){t(null,{ok:!0})}).catch(t)}).on('error',t)},qe.prototype.get=_('get',function(e,t,n){function s(){var s=[],a=r.length;return a?void r.forEach(function(r){o.get(e,{rev:r,revs:t.revs,latest:t.latest,attachments:t.attachments,binary:t.binary},function(e,t){if(!e){for(var o=0,i=s.length,d;o<i;o++)if(s[o].ok&&s[o].ok._rev===t._rev){d=!0;break}d||s.push({ok:t})}else s.push({missing:r});a--,a||n(null,s)})}):n(null,s)}if('function'==typeof t&&(n=t,t={}),'string'!=typeof e)return n(R(Lr));if(pe(e)&&'function'==typeof this._getLocal)return this._getLocal(e,n);var r=[],o=this;if(t.open_revs){if('all'===t.open_revs)this._getRevisionTree(e,function(e,t){return e?n(e):void(r=K(t).map(function(e){return e.rev}),s())});else if(Array.isArray(t.open_revs)){r=t.open_revs;for(var a=0,i;a<r.length;a++)if(i=r[a],!('string'==typeof i&&/^\d+-/.test(i)))return n(R(Wr));s()}else return n(R(Or,'function_clause'));return}return this._get(e,t,function(s,r){if(s)return s.docId=e,n(s);var a=r.doc,d=r.metadata,c=r.ctx;if(t.conflicts){var l=Q(d);l.length&&(a._conflicts=l)}if(ue(d,a._rev)&&(a._deleted=!0),t.revs||t.revs_info){for(var u=a._rev.split('-'),p=parseInt(u[0],10),h=u[1],_=Z(d.rev_tree),g=null,f=0;f<_.length;f++){var i=_[f],m=i.ids.map(function(e){return e.id}).indexOf(h);(m===p-1||!g&&-1!==m)&&(g=i)}var y=g.ids.map(function(e){return e.id}).indexOf(a._rev.split('-')[1])+1,v=g.ids.length-y;if(g.ids.splice(y,v),g.ids.reverse(),t.revs&&(a._revisions={start:g.pos+g.ids.length-1,ids:g.ids.map(function(e){return e.id})}),t.revs_info){var b=g.pos+g.ids.length;a._revs_info=g.ids.map(function(e){return b--,{rev:b+'-'+e.id,status:e.opts.status}})}}if(t.attachments&&a._attachments){var E=a._attachments,k=Object.keys(E).length;if(0===k)return n(null,a);Object.keys(E).forEach(function(e){this._getAttachment(a._id,e,E[e],{rev:a._rev,binary:t.binary,ctx:c},function(t,s){var r=a._attachments[e];r.data=s,delete r.stub,delete r.length,--k||n(null,a)})},o)}else{if(a._attachments)for(var w in a._attachments)a._attachments.hasOwnProperty(w)&&(a._attachments[w].stub=!0);n(null,a)}})}),qe.prototype.getAttachment=_('getAttachment',function(e,t,n,s){var r=this;n instanceof Function&&(s=n,n={}),this._get(e,n,function(o,i){return o?s(o):i.doc._attachments&&i.doc._attachments[t]?void(n.ctx=i.ctx,n.binary=!0,r._getAttachment(e,t,i.doc._attachments[t],n,s)):s(R(Ar))})}),qe.prototype.allDocs=_('allDocs',function(e,t){if('function'==typeof e&&(t=e,e={}),e.skip='undefined'==typeof e.skip?0:e.skip,e.start_key&&(e.startkey=e.start_key),e.end_key&&(e.endkey=e.end_key),'keys'in e){if(!Array.isArray(e.keys))return t(new TypeError('options.keys must be an array'));var n=['startkey','endkey','key'].filter(function(t){return t in e})[0];if(n)return void t(R(Pr,'Query parameter `'+n+'` is not compatible with multi-get'));if(!B(this)&&(ke(e),0===e.keys.length))return this._allDocs({limit:0},t)}return this._allDocs(e,t)}),qe.prototype.changes=function(e,t){return'function'==typeof e&&(t=e,e={}),new ge(this,e,t)},qe.prototype.close=_('close',function(e){return this._closed=!0,this.emit('closed'),this._close(e)}),qe.prototype.info=_('info',function(e){var t=this;this._info(function(n,s){return n?e(n):void(s.db_name=s.db_name||t.name,s.auto_compaction=!(!t.auto_compaction||B(t)),s.adapter=t.adapter,e(null,s))})}),qe.prototype.id=_('id',function(e){return this._id(e)}),qe.prototype.type=function(){return'function'==typeof this._type?this._type():this.adapter},qe.prototype.bulkDocs=_('bulkDocs',function(e,t,n){if('function'==typeof t&&(n=t,t={}),t=t||{},Array.isArray(e)&&(e={docs:e}),!e||!e.docs||!Array.isArray(e.docs))return n(R(xr));for(var s=0;s<e.docs.length;++s)if('object'!=typeof e.docs[s]||Array.isArray(e.docs[s]))return n(R(Ur));var r;if(e.docs.forEach(function(e){e._attachments&&Object.keys(e._attachments).forEach(function(t){r=r||Se(t),e._attachments[t].content_type||A('warn','Attachment',t,'on document',e._id,'is missing content_type')})}),r)return n(R(Br,r));'new_edits'in t||('new_edits'in e?t.new_edits=e.new_edits:t.new_edits=!0);var o=this;t.new_edits||B(o)||e.docs.sort(be),ve(e.docs);var a=e.docs.map(function(e){return e._id});return this._bulkDocs(e,t,function(e,s){if(e)return n(e);if(t.new_edits||(s=s.filter(function(e){return e.error})),!B(o))for(var r=0,i=s.length;r<i;r++)s[r].id=s[r].id||a[r];n(null,s)})}),qe.prototype.registerDependentDatabase=_('registerDependentDatabase',function(e,t){var n=new this.constructor(e,this.__opts);z(this,'_local/_pouch_dependentDbs',function(t){return(t.dependentDbs=t.dependentDbs||{},!t.dependentDbs[e])&&(t.dependentDbs[e]=!0,t)}).then(function(){t(null,{db:n})}).catch(t)}),qe.prototype.destroy=_('destroy',function(e,t){function n(){s._destroy(e,function(e,n){return e?t(e):void(s._destroyed=!0,s.emit('destroyed'),t(null,n||{ok:!0}))})}'function'==typeof e&&(t=e,e={});var s=this,r=!('use_prefix'in s)||s.use_prefix;return B(s)?n():void s.get('_local/_pouch_dependentDbs',function(e,o){if(e)return 404===e.status?n():t(e);var i=o.dependentDbs,a=s.constructor,d=Object.keys(i).map(function(e){var t=r?e.replace(new RegExp('^'+a.prefix),''):e;return new a(t,s.__opts).destroy()});fr.all(d).then(n,t)})}),xe.prototype.execute=function(){var e;if(this.failed)for(;e=this.queue.shift();)e(this.failed);else for(;e=this.queue.shift();)e()},xe.prototype.fail=function(e){this.failed=e,this.execute()},xe.prototype.ready=function(e){this.isReady=!0,this.db=e,this.execute()},xe.prototype.addTask=function(e){this.queue.push(e),this.failed&&this.execute()},ar()(Le,qe),Le.adapters={},Le.preferredAdapters=[],Le.prefix='_pouch_';var eo=new rr.EventEmitter;(function(e){Object.keys(rr.EventEmitter.prototype).forEach(function(t){'function'==typeof rr.EventEmitter.prototype[t]&&(e[t]=eo[t].bind(eo))});var t=e._destructionListeners=new br;e.on('ref',function(e){t.has(e.name)||t.set(e.name,[]),t.get(e.name).push(e)}),e.on('unref',function(e){if(t.has(e.name)){var n=t.get(e.name),s=n.indexOf(e);0>s||(n.splice(s,1),1<n.length?t.set(e.name,n):t.delete(e.name))}}),e.on('destroyed',function(e){if(t.has(e)){var n=t.get(e);t.delete(e),n.forEach(function(e){e.emit('destroyed',!0)})}})})(Le),Le.adapter=function(e,t,n){t.valid()&&(Le.adapters[e]=t,n&&Le.preferredAdapters.push(e))},Le.plugin=function(e){if('function'==typeof e)e(Le);else if('object'!=typeof e||0===Object.keys(e).length)throw new Error('Invalid plugin: got "'+e+'", expected an object or a function');else Object.keys(e).forEach(function(t){Le.prototype[t]=e[t]});return this.__defaults&&(Le.__defaults=Sr({},this.__defaults)),Le},Le.defaults=function(e){function t(e,n){return this instanceof t?void(n=n||{},e&&'object'==typeof e&&(n=e,e=n.name,delete n.name),n=Sr({},t.__defaults,n),Le.call(this,e,n)):new t(e,n)}return ar()(t,Le),t.preferredAdapters=Le.preferredAdapters.slice(),Object.keys(Le).forEach(function(e){e in t||(t[e]=Le[e])}),t.__defaults=Sr({},this.__defaults,e),t};var to=['$or','$nor','$not'],no=-324,so=3,ro='',oo={$elemMatch:function(e,t,n,s){return!!Array.isArray(s)&&0!==s.length&&('object'==typeof s[0]?s.some(function(e){return rt(e,t,Object.keys(t))}):s.some(function(s){return ot(t,e,n,s)}))},$allMatch:function(e,t,n,s){return!!Array.isArray(s)&&0!==s.length&&('object'==typeof s[0]?s.every(function(e){return rt(e,t,Object.keys(t))}):s.every(function(s){return ot(t,e,n,s)}))},$eq:function(e,t,n,s){return ct(s)&&0===ze(s,t)},$gte:function(e,t,n,s){return ct(s)&&0<=ze(s,t)},$gt:function(e,t,n,s){return ct(s)&&0<ze(s,t)},$lte:function(e,t,n,s){return ct(s)&&0>=ze(s,t)},$lt:function(e,t,n,s){return ct(s)&&0>ze(s,t)},$exists:function(e,t,n,s){return t?ct(s):!ct(s)},$mod:function(e,t,n,s){return dt(s)&&lt(s,t)},$ne:function(e,t,n,s){return t.every(function(e){return 0!==ze(s,e)})},$in:function(e,t,n,s){return dt(s)&&ut(s,t)},$nin:function(e,t,n,s){return dt(s)&&!ut(s,t)},$size:function(e,t,n,s){return dt(s)&&ht(s,t)},$all:function(e,t,n,s){return Array.isArray(s)&&pt(s,t)},$regex:function(e,t,n,s){return dt(s)&&_t(s,t)},$type:function(e,t,n,s){return gt(s,t)}};Le.plugin(function(e){e.debug=ur.a;var t={};e.on('debug',function(e){var n=e[0],s=e.slice(1);t[n]||(t[n]=ur()('pouchdb:'+n)),t[n].apply(null,s)})}),Le.plugin(function(e){e._changesFilterPlugin={validate:vt,normalize:bt,shouldFilter:Et,filter:kt}}),Le.version='6.4.3';var io=wt(['_id','_rev','_attachments','_deleted','_revisions','_revs_info','_conflicts','_deleted_conflicts','_local_seq','_rev_tree','_replication_id','_replication_state','_replication_state_time','_replication_state_reason','_replication_stats','_removed']),ao=wt(['_attachments','_replication_id','_replication_state','_replication_state_time','_replication_state_reason','_replication_stats']),co=function(e){return atob(e)},lo=function(e){return btoa(e)},uo=e.setImmediate||e.setTimeout,po=32768,ho=5,_o='document-store',go='by-sequence',fo='attach-store',mo='attach-seq-store',yo='meta-store',vo='local-store',bo='detect-blob-support',Eo=new x,ko=!1,wo=[],So=new br,qo=new br,xo;bn.valid=function(){var e='undefined'!=typeof openDatabase&&/(Safari|iPhone|iPad|iPod)/.test(navigator.userAgent)&&!/Chrome/.test(navigator.userAgent)&&!/BlackBerry/.test(navigator.platform),t='function'==typeof fetch&&-1!==fetch.toString().indexOf('[native code');try{return(!e||t)&&'undefined'!=typeof indexedDB&&'undefined'!=typeof IDBKeyRange}catch(t){return!1}};var Ao=7,To=Tn('document-store'),Lo=Tn('by-sequence'),Co=Tn('attach-store'),jo=Tn('local-store'),Ro=Tn('metadata-store'),Oo=Tn('attach-seq-store'),Io=new br,Do=new x,Po=1,No='CREATE INDEX IF NOT EXISTS \'by-seq-deleted-idx\' ON '+Lo+' (seq, deleted)',Bo='CREATE UNIQUE INDEX IF NOT EXISTS \'by-seq-doc-id-rev\' ON '+Lo+' (doc_id, rev)',Uo='CREATE INDEX IF NOT EXISTS \'doc-winningseq-idx\' ON '+To+' (winningseq)',$o='CREATE INDEX IF NOT EXISTS \'attach-seq-seq-idx\' ON '+Oo+' (seq)',Fo='CREATE UNIQUE INDEX IF NOT EXISTS \'attach-seq-digest-idx\' ON '+Oo+' (digest, seq)',Mo=Lo+'.seq = '+To+'.winningseq',Yo=Lo+'.seq AS seq, '+Lo+'.deleted AS deleted, '+Lo+'.json AS data, '+Lo+'.rev AS rev, '+To+'.json AS metadata';Vn.valid=function(){return!('function'!=typeof openDatabase)&&Wn()},Vn.use_prefix=!0;var zo=function(){try{return new XMLHttpRequest,!0}catch(e){return!1}}(),Wo=25,Ho=50,Vo=5e3,Xo=1e4,Go={};ls.valid=function(){return!0},ar()(us,Error),ar()(ps,Error),ar()(hs,Error);var Ko=A.bind(null,'log'),Qo=Array.isArray,Jo=JSON.parse;ws.prototype.add=function(e){return this.promise=this.promise.catch(function(){}).then(function(){return e()}),this.promise},ws.prototype.finish=function(){return this.promise};var Zo={},ei=new ws,ti=50,ni={_sum:function(e,t){return Es(t)},_count:function(e,t){return t.length},_stats:function(e,t){return{sum:Es(t),min:r.apply(null,t),max:Math.max.apply(null,t),count:t.length,sumsqr:function(e){for(var t=0,n=0,s=e.length,r;n<s;n++)r=e[n],t+=r*r;return t}(t)}}},si=function(e,t,n,s){function r(t,e,n){try{e(n)}catch(n){Ls(t,n)}}function o(t,e,n,s,r){try{return{output:e(n,s,r)}}catch(n){return Ls(t,n),{error:n}}}function i(e,t){var n=ze(e.key,t.key);return 0===n?ze(e.value,t.value):n}function a(e,t,n){return(n=n||0,'number'==typeof t)?e.slice(n,t+n):0<n?e.slice(n):e}function d(e){var t=e.value,n=t&&'object'==typeof t&&t._id||e.id;return n}function c(e){e.rows.forEach(function(e){var t=e.doc&&e.doc._attachments;t&&Object.keys(t).forEach(function(e){var n=t[e];t[e].data=Ct(n.data,n.content_type)})})}function l(e){return function(t){return e.include_docs&&e.attachments&&e.binary&&c(t),t}}function u(e,t,n,s){var r=t[e];'undefined'!=typeof r&&(s&&(r=encodeURIComponent(JSON.stringify(r))),n.push(e+'='+r))}function p(e){if('undefined'!=typeof e){var t=+e;return isNaN(t)||t!==parseInt(e,10)?e:t}}function h(e){return e.group_level=p(e.group_level),e.limit=p(e.limit),e.skip=p(e.skip),e}function _(e){if(e){if('number'!=typeof e)return new us('Invalid value for integer: "'+e+'"');if(0>e)return new us('Invalid value for positive integer: "'+e+'"')}}function g(e,t){var n=e.descending?'endkey':'startkey',s=e.descending?'startkey':'endkey';if('undefined'!=typeof e[n]&&'undefined'!=typeof e[s]&&0<ze(e[n],e[s]))throw new us('No rows can match your key range, reverse your start_key and end_key or set {descending : true}');else if(t.reduce&&!1!==e.reduce)if(e.include_docs)throw new us('{include_docs:true} is invalid for reduce');else if(e.keys&&1<e.keys.length&&!e.group&&!e.group_level)throw new us('Multi-key fetches for reduce views must use {group: true}');['group_level','limit','skip'].forEach(function(t){var n=_(e[t]);if(n)throw n})}function f(e,t,n){var s=[],r='GET',o;if(u('reduce',n,s),u('include_docs',n,s),u('attachments',n,s),u('limit',n,s),u('descending',n,s),u('group',n,s),u('group_level',n,s),u('skip',n,s),u('stale',n,s),u('conflicts',n,s),u('startkey',n,s,!0),u('start_key',n,s,!0),u('endkey',n,s,!0),u('end_key',n,s,!0),u('inclusive_end',n,s),u('key',n,s,!0),u('update_seq',n,s),s=s.join('&'),s=''===s?'':'?'+s,'undefined'!=typeof n.keys){var i='keys='+encodeURIComponent(JSON.stringify(n.keys));i.length+s.length+1<=2e3?s+=('?'===s[0]?'&':'?')+i:(r='POST','string'==typeof t?o={keys:n.keys}:t.keys=n.keys)}if('string'==typeof t){var a=As(t);return e.request({method:r,url:'_design/'+a[0]+'/_view/'+a[1]+s,body:o}).then(function(e){return e.rows.forEach(function(e){if(e.value&&e.value.error&&'builtin_reduce_error'===e.value.error)throw new Error(e.reason)}),e}).then(l(n))}return o=o||{},Object.keys(t).forEach(function(e){o[e]=Array.isArray(t[e])?t[e]:t[e].toString()}),e.request({method:'POST',url:'_temp_view'+s,body:o}).then(l(n))}function m(e,t,n){return new fr(function(s,r){e._query(t,n,function(e,t){return e?r(e):void s(t)})})}function y(e){return new fr(function(t,n){e._viewCleanup(function(e,s){return e?n(e):void t(s)})})}function v(e){return function(t){if(404===t.status)return e;throw t}}function b(e,t,n){function s(e){return e.keys.length?t.db.allDocs({keys:e.keys,include_docs:!0}):fr.resolve({rows:[]})}function r(e,t){for(var n=[],s=new vr,r=0,o=t.rows.length;r<o;r++){var i=t.rows[r],a=i.doc;if(a&&(n.push(a),s.add(a._id),a._deleted=!d.has(a._id),!a._deleted)){var c=d.get(a._id);'value'in c&&(a.value=c.value)}}var l=vs(d);return l.forEach(function(e){if(!s.has(e)){var t={_id:e},r=d.get(e);'value'in r&&(t.value=r.value),n.push(t)}}),e.keys=ys(l.concat(e.keys)),n.push(e),n}var o='_local/doc_'+e,i={_id:o,keys:[]},a=n.get(e),d=a[0],c=a[1];return function(){return Ts(c)?fr.resolve(i):t.db.get(o).catch(v(i))}().then(function(e){return s(e).then(function(t){return r(e,t)})})}function E(e,t,n){var s='_local/lastSeq';return e.db.get(s).catch(v({_id:s,seq:0})).then(function(s){var r=vs(t);return fr.all(r.map(function(n){return b(n,e,t)})).then(function(t){var r=P(t);return s.seq=n,r.push(s),e.db.bulkDocs({docs:r})})})}function k(e){var t='string'==typeof e?e:e.name,n=Zo[t];return n||(n=Zo[t]=new ws),n}function w(e){return ms(k(e),function(){return S(e)})()}function S(e){function n(t,n){return function(){return E(e,t,n)}}function s(){return e.sourceDB.changes({conflicts:!0,include_docs:!0,style:'all_docs',since:l,limit:ti}).then(o)}function o(e){var t=e.results;if(t.length){var r=a(t);return u.add(n(r,l)),t.length<ti?void 0:s()}}function a(t){for(var n=new br,s=0,o=t.length,a;s<o;s++){if(a=t[s],'_'!==a.doc._id[0]){p=[],h=a.doc,h._deleted||r(e.sourceDB,c,h),p.sort(i);var u=d(p);n.set(a.doc._id,[u,a.changes])}l=a.seq}return n}function d(e){for(var t=new br,n=0,s=e.length,r;n<s;n++){var o=e[n],i=[o.key,o.id];0<n&&0===ze(o.key,r)&&i.push(n),t.set(Ve(i),o),r=o.key}return t}var c=t(e.mapFun,function(e,t){var n={id:h._id,key:We(e)};'undefined'!=typeof t&&null!==t&&(n.value=We(t)),p.push(n)}),l=e.seq||0,u=new ws,p,h;return s().then(function(){return u.finish()}).then(function(){e.seq=l})}function q(t,s,r){0===r.group_level&&delete r.group_level;var d=r.group||r.group_level,c=n(t.reduceFun),l=[],u=isNaN(r.group_level)?Number.POSITIVE_INFINITY:r.group_level;s.forEach(function(t){var e=l[l.length-1],n=d?t.key:null;return d&&Array.isArray(n)&&(n=n.slice(0,u)),e&&0===ze(e.groupKey,n)?(e.keys.push([t.key,t.id]),void e.values.push(t.value)):void l.push({keys:[[t.key,t.id]],values:[t.value],groupKey:n})}),s=[];for(var p=0,i=l.length;p<i;p++){var h=l[p],e=o(t.sourceDB,c,h.keys,h.values,!1);if(e.error&&e.error instanceof hs)throw e.error;s.push({value:e.error?null:e.output,key:h.groupKey})}return{rows:a(s,r.limit,r.skip)}}function x(e,t){return ms(k(e),function(){return A(e,t)})()}function A(e,t){function n(t){return t.include_docs=!0,e.db.allDocs(t).then(function(e){return i=e.total_rows,e.rows.map(function(e){if('value'in e.doc&&'object'==typeof e.doc.value&&null!==e.doc.value){var t=Object.keys(e.doc.value).sort(),n=['id','key','value'];if(!(t<n||t>n))return e.doc.value}var s=Ke(e.doc._id);return{key:s[0],id:s[1],value:'value'in e.doc?e.doc.value:null}})})}function s(n){var s;if(s=r?q(e,n,t):{total_rows:i,offset:o,rows:n},t.update_seq&&(s.update_seq=e.seq),t.include_docs){var a=ys(n.map(d));return e.sourceDB.allDocs({keys:a,include_docs:!0,conflicts:t.conflicts,attachments:t.attachments,binary:t.binary}).then(function(e){var t=new br;return e.rows.forEach(function(e){t.set(e.id,e.doc)}),n.forEach(function(e){var n=d(e),s=t.get(n);s&&(e.doc=s)}),s})}return s}var r=e.reduceFun&&!1!==t.reduce,o=t.skip||0,i;if('undefined'==typeof t.keys||t.keys.length||(t.limit=0,delete t.keys),'undefined'!=typeof t.keys){var a=t.keys,c=a.map(function(e){var s={startkey:Ve([e]),endkey:Ve([e,{}])};return t.update_seq&&(s.update_seq=!0),n(s)});return fr.all(c).then(P).then(s)}var l={descending:t.descending};t.update_seq&&(l.update_seq=!0);var u,p;if('start_key'in t&&(u=t.start_key),'startkey'in t&&(u=t.startkey),'end_key'in t&&(p=t.end_key),'endkey'in t&&(p=t.endkey),'undefined'!=typeof u&&(l.startkey=t.descending?Ve([u,{}]):Ve([u])),'undefined'!=typeof p){var h=!1!==t.inclusive_end;t.descending&&(h=!h),l.endkey=Ve(h?[p,{}]:[p])}if('undefined'!=typeof t.key){var _=Ve([t.key]),g=Ve([t.key,{}]);l.descending?(l.endkey=_,l.startkey=g):(l.startkey=_,l.endkey=g)}return r||('number'==typeof t.limit&&(l.limit=t.limit),l.skip=o),n(l).then(s)}function T(e){return e.request({method:'POST',url:'_view_cleanup'})}function L(t){return t.get('_local/'+e).then(function(e){var n=new br;Object.keys(e.views).forEach(function(e){var t=As(e),s='_design/'+t[0],r=t[1],o=n.get(s);o||(o=new vr,n.set(s,o)),o.add(r)});var s={keys:vs(n),include_docs:!0};return t.allDocs(s).then(function(s){var r={};s.rows.forEach(function(t){var s=t.key.substring(8);n.get(t.key).forEach(function(n){var o=s+'/'+n;e.views[o]||(o=n);var i=Object.keys(e.views[o]),a=t.doc&&t.doc.views&&t.doc.views[n];i.forEach(function(e){r[e]=r[e]||a})})});var o=Object.keys(r).filter(function(e){return!r[e]}),i=o.map(function(e){return ms(k(e),function(){return new t.constructor(e,t.__opts).destroy()})()});return fr.all(i).then(function(){return{ok:!0}})})},v({ok:!0}))}function C(t,n,r){if('function'==typeof t._query)return m(t,n,r);if(B(t))return f(t,n,r);if('string'!=typeof n)return g(r,n),ei.add(function(){var s=xs(t,'temp_view/temp_view',n.map,n.reduce,!0,e);return s.then(function(e){return fs(w(e).then(function(){return x(e,r)}),function(){return e.db.destroy()})})}),ei.finish();var o=n,i=As(o),a=i[0],d=i[1];return t.get('_design/'+a).then(function(n){var i=n.views&&n.views[d];if(!i)throw new ps('ddoc '+n._id+' has no view named '+d);s(n,d),g(r,i);var a=xs(t,o,i.map,i.reduce,!1,e);return a.then(function(e){return'ok'===r.stale||'update_after'===r.stale?('update_after'===r.stale&&sr()(function(){w(e)}),x(e,r)):w(e).then(function(){return x(e,r)})})})}var j=gs(function(){var e=this;return'function'==typeof e._viewCleanup?y(e):B(e)?T(e):L(e)});return{query:function(e,t,n){var s=this;'function'==typeof t&&(n=t,t={}),t=t?h(t):{},'function'==typeof e&&(e={map:e});var r=fr.resolve().then(function(){return C(s,e,t)});return _s(r,n),r},viewCleanup:j}}('mrviews',function(e,t){if('function'==typeof e&&2===e.length){return function(n){return e(n,t)}}return ks(e.toString(),t)},function(e){var t=e.toString(),n=Cs(t);return n?n:ks(t)},function(e,t){var n=e.views&&e.views[t];if('string'!=typeof n.map)throw new ps('ddoc '+e._id+' has no string view named '+t+', instead found object of type: '+typeof n.map)}),ri=1,oi='pouchdb',ii=5,ai=0;Bs.prototype.writeCheckpoint=function(e,t){var n=this;return this.updateTarget(e,t).then(function(){return n.updateSource(e,t)})},Bs.prototype.updateTarget=function(e,t){return this.opts.writeTargetCheckpoint?Ns(this.target,this.id,e,t,this.returnValue):fr.resolve(!0)},Bs.prototype.updateSource=function(e,t){if(this.opts.writeSourceCheckpoint){var n=this;return Ns(this.src,this.id,e,t,this.returnValue).catch(function(e){if(Ms(e))return n.opts.writeSourceCheckpoint=!1,!0;throw e})}return fr.resolve(!0)};var di={undefined:function(e,t){return 0===ze(e.last_seq,t.last_seq)?t.last_seq:0},1:function(e,t){return Us(t,e).last_seq}};Bs.prototype.getCheckpoint=function(){var e=this;return e.opts&&e.opts.writeSourceCheckpoint&&!e.opts.writeTargetCheckpoint?e.src.get(e.id).then(function(e){return e.last_seq||ai}).catch(function(e){if(404!==e.status)throw e;return ai}):e.target.get(e.id).then(function(t){return e.opts&&e.opts.writeTargetCheckpoint&&!e.opts.writeSourceCheckpoint?t.last_seq||ai:e.src.get(e.id).then(function(e){if(t.version!==e.version)return ai;var n;return n=t.version?t.version.toString():'undefined',n in di?di[n](t,e):ai},function(n){if(404===n.status&&t.last_seq)return e.src.put({_id:e.id,last_seq:ai}).then(function(){return ai},function(n){return Ms(n)?(e.opts.writeSourceCheckpoint=!1,t.last_seq):ai});throw n})}).catch(function(e){if(404!==e.status)throw e;return ai})};var ci=0;ar()(Vs,rr.EventEmitter),Vs.prototype.cancel=function(){this.cancelled=!0,this.state='cancelled',this.emit('cancel')},Vs.prototype.ready=function(e,t){function n(){s.cancel()}var s=this;s._readyCalled||(s._readyCalled=!0,e.once('destroyed',n),t.once('destroyed',n),s.once('complete',function(){e.removeListener('destroyed',n),t.removeListener('destroyed',n)}))},ar()(Qs,rr.EventEmitter),Qs.prototype.cancel=function(){this.canceled||(this.canceled=!0,this.push.cancel(),this.pull.cancel())},Le.plugin(function(e){e.adapter('idb',bn,!0)}).plugin(function(e){e.adapter('websql',Vn,!0)}).plugin(function(e){e.adapter('http',ls,!1),e.adapter('https',ls,!1)}).plugin({query:function(e,t,n){return si.query.call(this,e,t,n)},viewCleanup:function(e){return si.viewCleanup.call(this,e)}}).plugin(function(e){e.replicate=Gs,e.sync=Ks,Object.defineProperty(e.prototype,'replicate',{get:function(){var e=this;return'undefined'==typeof this.replicateMethods&&(this.replicateMethods={from:function(t,n,s){return e.constructor.replicate(t,e,n,s)},to:function(t,n,s){return e.constructor.replicate(e,t,n,s)}}),this.replicateMethods}}),e.prototype.sync=function(e,t,n){return this.constructor.sync(this,e,t,n)}}),t['default']=Le}.call(t,n(0))},function(e,t,n){'use strict';function s(){}function r(e){if('function'!=typeof e)throw new TypeError('resolver must be a function');this.state=_,this.queue=[],this.outcome=void 0,e!==s&&d(this,e)}function o(e,t,n){this.promise=e,'function'==typeof t&&(this.onFulfilled=t,this.callFulfilled=this.otherCallFulfilled),'function'==typeof n&&(this.onRejected=n,this.callRejected=this.otherCallRejected)}function i(t,e,n){l(function(){var s;try{s=e(n)}catch(n){return u.reject(t,n)}s===t?u.reject(t,new TypeError('Cannot resolve promise with itself')):u.resolve(t,s)})}function a(e){var t=e&&e.then;if(e&&('object'==typeof e||'function'==typeof e)&&'function'==typeof t)return function(){t.apply(e,arguments)}}function d(e,t){function n(t){r||(r=!0,u.reject(e,t))}function s(t){r||(r=!0,u.resolve(e,t))}var r=!1,o=c(function(){t(s,n)});'error'===o.status&&n(o.value)}function c(e,t){var n={};try{n.value=e(t),n.status='success'}catch(t){n.status='error',n.value=t}return n}var l=n(1),u={},p=['REJECTED'],h=['FULFILLED'],_=['PENDING'];e.exports=r,r.prototype['catch']=function(e){return this.then(null,e)},r.prototype.then=function(e,t){if('function'!=typeof e&&this.state===h||'function'!=typeof t&&this.state===p)return this;var n=new this.constructor(s);if(this.state!==_){var r=this.state===h?e:t;i(n,r,this.outcome)}else this.queue.push(new o(n,e,t));return n},o.prototype.callFulfilled=function(e){u.resolve(this.promise,e)},o.prototype.otherCallFulfilled=function(e){i(this.promise,this.onFulfilled,e)},o.prototype.callRejected=function(e){u.reject(this.promise,e)},o.prototype.otherCallRejected=function(e){i(this.promise,this.onRejected,e)},u.resolve=function(e,t){var n=c(a,t);if('error'===n.status)return u.reject(e,n.value);var s=n.value;if(s)d(e,s);else{e.state=h,e.outcome=t;for(var r=-1,o=e.queue.length;++r<o;)e.queue[r].callFulfilled(t)}return e},u.reject=function(e,t){e.state=p,e.outcome=t;for(var n=-1,s=e.queue.length;++n<s;)e.queue[n].callRejected(t);return e},r.resolve=function(e){return e instanceof this?e:u.resolve(new this(s),e)},r.reject=function(e){var t=new this(s);return u.reject(t,e)},r.all=function(e){function t(e,t){n.resolve(e).then(function(e){a[t]=e,++d!==r||o||(o=!0,u.resolve(l,a))},function(e){o||(o=!0,u.reject(l,e))})}var n=this;if('[object Array]'!==Object.prototype.toString.call(e))return this.reject(new TypeError('must be an array'));var r=e.length,o=!1;if(!r)return this.resolve([]);for(var a=Array(r),d=0,c=-1,l=new this(s);++c<r;)t(e[c],c);return l},r.race=function(e){function t(e){n.resolve(e).then(function(e){o||(o=!0,u.resolve(i,e))},function(e){o||(o=!0,u.reject(i,e))})}var n=this;if('[object Array]'!==Object.prototype.toString.call(e))return this.reject(new TypeError('must be an array'));var r=e.length,o=!1;if(!r)return this.resolve([]);for(var a=-1,i=new this(s);++a<r;)t(e[a]);return i}},function(e){'use strict';e.exports=function(e){return function(){var t=arguments.length;if(t){for(var n=[],s=-1;++s<t;)n[s]=arguments[s];return e.call(this,n)}return e.call(this,[])}}},function(e){e.exports='function'==typeof Object.create?function(e,t){e.super_=t,e.prototype=Object.create(t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}})}:function(e,t){e.super_=t;var n=function(){};n.prototype=t.prototype,e.prototype=new n,e.prototype.constructor=e}},function(e,t,n){var s=n(17),r=n(18),o=r;o.v1=s,o.v4=r,e.exports=o},function(e,t,n){var s=n(3),r=n(4),o=s(),a=[1|o[0],o[1],o[2],o[3],o[4],o[5]],d=16383&(o[6]<<8|o[7]),c=0,l=0;e.exports=function(e,t,s){var o=t&&s||0,i=t||[];e=e||{};var u=void 0===e.clockseq?d:e.clockseq,p=void 0===e.msecs?new Date().getTime():e.msecs,h=void 0===e.nsecs?l+1:e.nsecs,_=p-c+(h-l)/1e4;if(0>_&&void 0===e.clockseq&&(u=16383&u+1),(0>_||p>c)&&void 0===e.nsecs&&(h=0),1e4<=h)throw new Error('uuid.v1(): Can\'t create more than 10M uuids/sec');c=p,l=h,d=u,p+=1.22192928e13;var g=(1e4*(268435455&p)+h)%4294967296;i[o++]=255&g>>>24,i[o++]=255&g>>>16,i[o++]=255&g>>>8,i[o++]=255&g;var f=268435455&1e4*(p/4294967296);i[o++]=255&f>>>8,i[o++]=255&f,i[o++]=16|15&f>>>24,i[o++]=255&f>>>16,i[o++]=128|u>>>8,i[o++]=255&u;for(var m=e.node||a,y=0;6>y;++y)i[o+y]=m[y];return t?t:r(i)}},function(e,t,n){var s=n(3),r=n(4);e.exports=function(e,t,n){var o=t&&n||0;'string'==typeof e&&(t='binary'==e?Array(16):null,e=null),e=e||{};var i=e.random||(e.rng||s)();if(i[6]=64|15&i[6],i[8]=128|63&i[8],t)for(var a=0;16>a;++a)t[o+a]=i[a];return t||r(i)}},function(e,t,n){(function(s){function r(){var e;try{e=t.storage.debug}catch(t){}return!e&&'undefined'!=typeof s&&'env'in s&&(e=s.env.DEBUG),e}t=e.exports=n(21),t.log=function(){return'object'==typeof console&&console.log&&Function.prototype.apply.call(console.log,console,arguments)},t.formatArgs=function(e){var n=this.useColors;if(e[0]=(n?'%c':'')+this.namespace+(n?' %c':' ')+e[0]+(n?'%c ':' ')+'+'+t.humanize(this.diff),!!n){var s='color: '+this.color;e.splice(1,0,s,'color: inherit');var r=0,o=0;e[0].replace(/%[a-zA-Z%]/g,function(e){'%%'===e||(r++,'%c'===e&&(o=r))}),e.splice(o,0,s)}},t.save=function(e){try{null==e?t.storage.removeItem('debug'):t.storage.debug=e}catch(t){}},t.load=r,t.useColors=function(){return'undefined'!=typeof window&&window&&'undefined'!=typeof window.process&&'renderer'===window.process.type||'undefined'!=typeof document&&document&&'WebkitAppearance'in document.documentElement.style||'undefined'!=typeof window&&window&&window.console&&(console.firebug||console.exception&&console.table)||'undefined'!=typeof navigator&&navigator&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/firefox\/(\d+)/)&&31<=parseInt(RegExp.$1,10)||'undefined'!=typeof navigator&&navigator&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/applewebkit\/(\d+)/)},t.storage='undefined'!=typeof chrome&&'undefined'!=typeof chrome.storage?chrome.storage.local:function(){try{return window.localStorage}catch(t){}}(),t.colors=['lightseagreen','forestgreen','goldenrod','dodgerblue','darkorchid','crimson'],t.formatters.j=function(e){try{return JSON.stringify(e)}catch(e){return'[UnexpectedJSONParseError]: '+e.message}},t.enable(r())}).call(t,n(20))},function(e){function t(){throw new Error('setTimeout has not been defined')}function n(){throw new Error('clearTimeout has not been defined')}function s(e){if(l===setTimeout)return setTimeout(e,0);if((l===t||!l)&&setTimeout)return l=setTimeout,setTimeout(e,0);try{return l(e,0)}catch(t){try{return l.call(null,e,0)}catch(t){return l.call(this,e,0)}}}function r(e){if(u===clearTimeout)return clearTimeout(e);if((u===n||!u)&&clearTimeout)return u=clearTimeout,clearTimeout(e);try{return u(e)}catch(t){try{return u.call(null,e)}catch(t){return u.call(this,e)}}}function o(){h&&g&&(h=!1,g.length?p=g.concat(p):_=-1,p.length&&a())}function a(){if(!h){var e=s(o);h=!0;for(var t=p.length;t;){for(g=p,p=[];++_<t;)g&&g[_].run();_=-1,t=p.length}g=null,h=!1,r(e)}}function d(e,t){this.fun=e,this.array=t}function i(){}var c=e.exports={},l,u;(function(){try{l='function'==typeof setTimeout?setTimeout:t}catch(n){l=t}try{u='function'==typeof clearTimeout?clearTimeout:n}catch(t){u=n}})();var p=[],h=!1,_=-1,g;c.nextTick=function(e){var t=Array(arguments.length-1);if(1<arguments.length)for(var n=1;n<arguments.length;n++)t[n-1]=arguments[n];p.push(new d(e,t)),1!==p.length||h||s(a)},d.prototype.run=function(){this.fun.apply(null,this.array)},c.title='browser',c.browser=!0,c.env={},c.argv=[],c.version='',c.versions={},c.on=i,c.addListener=i,c.once=i,c.off=i,c.removeListener=i,c.removeAllListeners=i,c.emit=i,c.prependListener=i,c.prependOnceListener=i,c.listeners=function(){return[]},c.binding=function(){throw new Error('process.binding is not supported')},c.cwd=function(){return'/'},c.chdir=function(){throw new Error('process.chdir is not supported')},c.umask=function(){return 0}},function(e,t,n){function s(e){var n=0,s;for(s in e)n=(n<<5)-n+e.charCodeAt(s),n|=0;return t.colors[Math.abs(n)%t.colors.length]}function r(e){function n(){if(n.enabled){var e=n,s=+new Date,r=s-(o||s);e.diff=r,e.prev=o,e.curr=s,o=s;for(var a=Array(arguments.length),d=0;d<a.length;d++)a[d]=arguments[d];a[0]=t.coerce(a[0]),'string'!=typeof a[0]&&a.unshift('%O');var i=0;a[0]=a[0].replace(/%([a-zA-Z%])/g,function(n,s){if('%%'===n)return n;i++;var r=t.formatters[s];if('function'==typeof r){var o=a[i];n=r.call(e,o),a.splice(i,1),i--}return n}),t.formatArgs.call(e,a);var c=n.log||t.log||console.log.bind(console);c.apply(e,a)}}return n.namespace=e,n.enabled=t.enabled(e),n.useColors=t.useColors(),n.color=s(e),'function'==typeof t.init&&t.init(n),n}t=e.exports=r.debug=r['default']=r,t.coerce=function(e){return e instanceof Error?e.stack||e.message:e},t.disable=function(){t.enable('')},t.enable=function(e){t.save(e),t.names=[],t.skips=[];for(var n=('string'==typeof e?e:'').split(/[\s,]+/),s=n.length,r=0;r<s;r++)n[r]&&(e=n[r].replace(/\*/g,'.*?'),'-'===e[0]?t.skips.push(new RegExp('^'+e.substr(1)+'$')):t.names.push(new RegExp('^'+e+'$')))},t.enabled=function(e){var n,s;for(n=0,s=t.skips.length;n<s;n++)if(t.skips[n].test(e))return!1;for(n=0,s=t.names.length;n<s;n++)if(t.names[n].test(e))return!0;return!1},t.humanize=n(22),t.names=[],t.skips=[],t.formatters={};var o},function(e){function t(e){if(e+='',!(1e4<e.length)){var t=/^((?:\d+)?\.?\d+) *(milliseconds?|msecs?|ms|seconds?|secs?|s|minutes?|mins?|m|hours?|hrs?|h|days?|d|years?|yrs?|y)?$/i.exec(e);if(t){var r=parseFloat(t[1]),n=(t[2]||'ms').toLowerCase();return'years'===n||'year'===n||'yrs'===n||'yr'===n||'y'===n?r*d:'days'===n||'day'===n||'d'===n?r*c:'hours'===n||'hour'===n||'hrs'===n||'hr'===n||'h'===n?r*a:'minutes'===n||'minute'===n||'mins'===n||'min'===n||'m'===n?r*s:'seconds'===n||'second'===n||'secs'===n||'sec'===n||'s'===n?r*i:'milliseconds'===n||'millisecond'===n||'msecs'===n||'msec'===n||'ms'===n?r:void 0}}}function n(e){var t=Math.round;return e>=c?t(e/c)+'d':e>=a?t(e/a)+'h':e>=s?t(e/s)+'m':e>=i?t(e/i)+'s':e+'ms'}function r(e){return o(e,c,'day')||o(e,a,'hour')||o(e,s,'minute')||o(e,i,'second')||e+' ms'}function o(e,t,n){return e<t?void 0:e<1.5*t?Math.floor(e/t)+' '+n:Math.ceil(e/t)+' '+n+'s'}var i=1e3,s=60*i,a=60*s,c=24*a,d=365.25*c;e.exports=function(e,s){s=s||{};var o=typeof e;if('string'==o&&0<e.length)return t(e);if('number'==o&&!1===isNaN(e))return s.long?r(e):n(e);throw new Error('val is not a non-empty string or a valid number. val='+JSON.stringify(e))}},function(e){var t=String.fromCharCode;(function(t){e.exports=t()})(function(){'use strict';function e(e,t){var n=e[0],s=e[1],r=e[2],o=e[3];n+=0|(s&r|~s&o)+t[0]-680876936,n=0|(n<<7|n>>>25)+s,o+=0|(n&s|~n&r)+t[1]-389564586,o=0|(o<<12|o>>>20)+n,r+=0|(o&n|~o&s)+t[2]+606105819,r=0|(r<<17|r>>>15)+o,s+=0|(r&o|~r&n)+t[3]-1044525330,s=0|(s<<22|s>>>10)+r,n+=0|(s&r|~s&o)+t[4]-176418897,n=0|(n<<7|n>>>25)+s,o+=0|(n&s|~n&r)+t[5]+1200080426,o=0|(o<<12|o>>>20)+n,r+=0|(o&n|~o&s)+t[6]-1473231341,r=0|(r<<17|r>>>15)+o,s+=0|(r&o|~r&n)+t[7]-45705983,s=0|(s<<22|s>>>10)+r,n+=0|(s&r|~s&o)+t[8]+1770035416,n=0|(n<<7|n>>>25)+s,o+=0|(n&s|~n&r)+t[9]-1958414417,o=0|(o<<12|o>>>20)+n,r+=0|(o&n|~o&s)+t[10]-42063,r=0|(r<<17|r>>>15)+o,s+=0|(r&o|~r&n)+t[11]-1990404162,s=0|(s<<22|s>>>10)+r,n+=0|(s&r|~s&o)+t[12]+1804603682,n=0|(n<<7|n>>>25)+s,o+=0|(n&s|~n&r)+t[13]-40341101,o=0|(o<<12|o>>>20)+n,r+=0|(o&n|~o&s)+t[14]-1502002290,r=0|(r<<17|r>>>15)+o,s+=0|(r&o|~r&n)+t[15]+1236535329,s=0|(s<<22|s>>>10)+r,n+=0|(s&o|r&~o)+t[1]-165796510,n=0|(n<<5|n>>>27)+s,o+=0|(n&r|s&~r)+t[6]-1069501632,o=0|(o<<9|o>>>23)+n,r+=0|(o&s|n&~s)+t[11]+643717713,r=0|(r<<14|r>>>18)+o,s+=0|(r&n|o&~n)+t[0]-373897302,s=0|(s<<20|s>>>12)+r,n+=0|(s&o|r&~o)+t[5]-701558691,n=0|(n<<5|n>>>27)+s,o+=0|(n&r|s&~r)+t[10]+38016083,o=0|(o<<9|o>>>23)+n,r+=0|(o&s|n&~s)+t[15]-660478335,r=0|(r<<14|r>>>18)+o,s+=0|(r&n|o&~n)+t[4]-405537848,s=0|(s<<20|s>>>12)+r,n+=0|(s&o|r&~o)+t[9]+568446438,n=0|(n<<5|n>>>27)+s,o+=0|(n&r|s&~r)+t[14]-1019803690,o=0|(o<<9|o>>>23)+n,r+=0|(o&s|n&~s)+t[3]-187363961,r=0|(r<<14|r>>>18)+o,s+=0|(r&n|o&~n)+t[8]+1163531501,s=0|(s<<20|s>>>12)+r,n+=0|(s&o|r&~o)+t[13]-1444681467,n=0|(n<<5|n>>>27)+s,o+=0|(n&r|s&~r)+t[2]-51403784,o=0|(o<<9|o>>>23)+n,r+=0|(o&s|n&~s)+t[7]+1735328473,r=0|(r<<14|r>>>18)+o,s+=0|(r&n|o&~n)+t[12]-1926607734,s=0|(s<<20|s>>>12)+r,n+=0|(s^r^o)+t[5]-378558,n=0|(n<<4|n>>>28)+s,o+=0|(n^s^r)+t[8]-2022574463,o=0|(o<<11|o>>>21)+n,r+=0|(o^n^s)+t[11]+1839030562,r=0|(r<<16|r>>>16)+o,s+=0|(r^o^n)+t[14]-35309556,s=0|(s<<23|s>>>9)+r,n+=0|(s^r^o)+t[1]-1530992060,n=0|(n<<4|n>>>28)+s,o+=0|(n^s^r)+t[4]+1272893353,o=0|(o<<11|o>>>21)+n,r+=0|(o^n^s)+t[7]-155497632,r=0|(r<<16|r>>>16)+o,s+=0|(r^o^n)+t[10]-1094730640,s=0|(s<<23|s>>>9)+r,n+=0|(s^r^o)+t[13]+681279174,n=0|(n<<4|n>>>28)+s,o+=0|(n^s^r)+t[0]-358537222,o=0|(o<<11|o>>>21)+n,r+=0|(o^n^s)+t[3]-722521979,r=0|(r<<16|r>>>16)+o,s+=0|(r^o^n)+t[6]+76029189,s=0|(s<<23|s>>>9)+r,n+=0|(s^r^o)+t[9]-640364487,n=0|(n<<4|n>>>28)+s,o+=0|(n^s^r)+t[12]-421815835,o=0|(o<<11|o>>>21)+n,r+=0|(o^n^s)+t[15]+530742520,r=0|(r<<16|r>>>16)+o,s+=0|(r^o^n)+t[2]-995338651,s=0|(s<<23|s>>>9)+r,n+=0|(r^(s|~o))+t[0]-198630844,n=0|(n<<6|n>>>26)+s,o+=0|(s^(n|~r))+t[7]+1126891415,o=0|(o<<10|o>>>22)+n,r+=0|(n^(o|~s))+t[14]-1416354905,r=0|(r<<15|r>>>17)+o,s+=0|(o^(r|~n))+t[5]-57434055,s=0|(s<<21|s>>>11)+r,n+=0|(r^(s|~o))+t[12]+1700485571,n=0|(n<<6|n>>>26)+s,o+=0|(s^(n|~r))+t[3]-1894986606,o=0|(o<<10|o>>>22)+n,r+=0|(n^(o|~s))+t[10]-1051523,r=0|(r<<15|r>>>17)+o,s+=0|(o^(r|~n))+t[1]-2054922799,s=0|(s<<21|s>>>11)+r,n+=0|(r^(s|~o))+t[8]+1873313359,n=0|(n<<6|n>>>26)+s,o+=0|(s^(n|~r))+t[15]-30611744,o=0|(o<<10|o>>>22)+n,r+=0|(n^(o|~s))+t[6]-1560198380,r=0|(r<<15|r>>>17)+o,s+=0|(o^(r|~n))+t[13]+1309151649,s=0|(s<<21|s>>>11)+r,n+=0|(r^(s|~o))+t[4]-145523070,n=0|(n<<6|n>>>26)+s,o+=0|(s^(n|~r))+t[11]-1120210379,o=0|(o<<10|o>>>22)+n,r+=0|(n^(o|~s))+t[2]+718787259,r=0|(r<<15|r>>>17)+o,s+=0|(o^(r|~n))+t[9]-343485551,s=0|(s<<21|s>>>11)+r,e[0]=0|n+e[0],e[1]=0|s+e[1],e[2]=0|r+e[2],e[3]=0|o+e[3]}function r(e){var t=[],n;for(n=0;64>n;n+=4)t[n>>2]=e.charCodeAt(n)+(e.charCodeAt(n+1)<<8)+(e.charCodeAt(n+2)<<16)+(e.charCodeAt(n+3)<<24);return t}function s(e){var t=[],n;for(n=0;64>n;n+=4)t[n>>2]=e[n]+(e[n+1]<<8)+(e[n+2]<<16)+(e[n+3]<<24);return t}function n(t){var s=t.length,n=[1732584193,-271733879,-1732584194,271733878],o,i,a,d,c,l;for(o=64;o<=s;o+=64)e(n,r(t.substring(o-64,o)));for(t=t.substring(o-64),i=t.length,a=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],o=0;o<i;o+=1)a[o>>2]|=t.charCodeAt(o)<<(o%4<<3);if(a[o>>2]|=128<<(o%4<<3),55<o)for(e(n,a),o=0;16>o;o+=1)a[o]=0;return d=8*s,d=d.toString(16).match(/(.*?)(.{0,8})$/),c=parseInt(d[2],16),l=parseInt(d[1],16)||0,a[14]=c,a[15]=l,e(n,a),n}function o(t){var r=t.length,n=[1732584193,-271733879,-1732584194,271733878],o,i,a,d,c,l;for(o=64;o<=r;o+=64)e(n,s(t.subarray(o-64,o)));for(t=o-64<r?t.subarray(o-64):new Uint8Array(0),i=t.length,a=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],o=0;o<i;o+=1)a[o>>2]|=t[o]<<(o%4<<3);if(a[o>>2]|=128<<(o%4<<3),55<o)for(e(n,a),o=0;16>o;o+=1)a[o]=0;return d=8*r,d=d.toString(16).match(/(.*?)(.{0,8})$/),c=parseInt(d[2],16),l=parseInt(d[1],16)||0,a[14]=c,a[15]=l,e(n,a),n}function a(e){var t='',n;for(n=0;4>n;n+=1)t+=g[15&e>>8*n+4]+g[15&e>>8*n];return t}function d(e){var t;for(t=0;t<e.length;t+=1)e[t]=a(e[t]);return e.join('')}function i(e){return /[\u0080-\uFFFF]/.test(e)&&(e=unescape(encodeURIComponent(e))),e}function c(e,t){var n=e.length,s=new ArrayBuffer(n),r=new Uint8Array(s),o;for(o=0;o<n;o+=1)r[o]=e.charCodeAt(o);return t?r:s}function l(e){return t.apply(null,new Uint8Array(e))}function u(e,t,n){var s=new Uint8Array(e.byteLength+t.byteLength);return s.set(new Uint8Array(e)),s.set(new Uint8Array(t),e.byteLength),n?s:s.buffer}function p(e){var n=[],s=e.length,r;for(r=0;r<s-1;r+=2)n.push(parseInt(e.substr(r,2),16));return t.apply(String,n)}function h(){this.reset()}var _=function(e,t){return 4294967295&e+t},g=['0','1','2','3','4','5','6','7','8','9','a','b','c','d','e','f'];return'5d41402abc4b2a76b9719d911017c592'!==d(n('hello'))&&(_=function(e,t){var n=(65535&e)+(65535&t);return(e>>16)+(t>>16)+(n>>16)<<16|65535&n}),'undefined'==typeof ArrayBuffer||ArrayBuffer.prototype.slice||function(){function e(e,t){return e=0|e||0,0>e?Math.max(e+t,0):Math.min(e,t)}ArrayBuffer.prototype.slice=function(t,n){var s=this.byteLength,r=e(t,s),o=s,i,a,d,c;return(void 0!==n&&(o=e(n,s)),r>o)?new ArrayBuffer(0):(i=o-r,a=new ArrayBuffer(i),d=new Uint8Array(a),c=new Uint8Array(this,r,i),d.set(c),a)}}(),h.prototype.append=function(e){return this.appendBinary(i(e)),this},h.prototype.appendBinary=function(t){this._buff+=t,this._length+=t.length;var n=this._buff.length,s;for(s=64;s<=n;s+=64)e(this._hash,r(this._buff.substring(s-64,s)));return this._buff=this._buff.substring(s-64),this},h.prototype.end=function(e){var t=this._buff,n=t.length,s=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],r,o;for(r=0;r<n;r+=1)s[r>>2]|=t.charCodeAt(r)<<(r%4<<3);return this._finish(s,n),o=d(this._hash),e&&(o=p(o)),this.reset(),o},h.prototype.reset=function(){return this._buff='',this._length=0,this._hash=[1732584193,-271733879,-1732584194,271733878],this},h.prototype.getState=function(){return{buff:this._buff,length:this._length,hash:this._hash}},h.prototype.setState=function(e){return this._buff=e.buff,this._length=e.length,this._hash=e.hash,this},h.prototype.destroy=function(){delete this._hash,delete this._buff,delete this._length},h.prototype._finish=function(t,n){var s=n,r,o,i;if(t[s>>2]|=128<<(s%4<<3),55<s)for(e(this._hash,t),s=0;16>s;s+=1)t[s]=0;r=8*this._length,r=r.toString(16).match(/(.*?)(.{0,8})$/),o=parseInt(r[2],16),i=parseInt(r[1],16)||0,t[14]=o,t[15]=i,e(this._hash,t)},h.hash=function(e,t){return h.hashBinary(i(e),t)},h.hashBinary=function(e,t){var s=n(e),r=d(s);return t?p(r):r},h.ArrayBuffer=function(){this.reset()},h.ArrayBuffer.prototype.append=function(t){var n=u(this._buff.buffer,t,!0),r=n.length,o;for(this._length+=t.byteLength,o=64;o<=r;o+=64)e(this._hash,s(n.subarray(o-64,o)));return this._buff=o-64<r?new Uint8Array(n.buffer.slice(o-64)):new Uint8Array(0),this},h.ArrayBuffer.prototype.end=function(e){var t=this._buff,n=t.length,s=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],r,o;for(r=0;r<n;r+=1)s[r>>2]|=t[r]<<(r%4<<3);return this._finish(s,n),o=d(this._hash),e&&(o=p(o)),this.reset(),o},h.ArrayBuffer.prototype.reset=function(){return this._buff=new Uint8Array(0),this._length=0,this._hash=[1732584193,-271733879,-1732584194,271733878],this},h.ArrayBuffer.prototype.getState=function(){var e=h.prototype.getState.call(this);return e.buff=l(e.buff),e},h.ArrayBuffer.prototype.setState=function(e){return e.buff=c(e.buff,!0),h.prototype.setState.call(this,e)},h.ArrayBuffer.prototype.destroy=h.prototype.destroy,h.ArrayBuffer.prototype._finish=h.prototype._finish,h.ArrayBuffer.hash=function(e,t){var n=o(new Uint8Array(e)),s=d(n);return t?p(s):s},h})},function(e,t){'use strict';function n(e,t,n){var s=n[n.length-1];e===s.element&&(n.pop(),s=n[n.length-1]);var r=s.element,o=s.index;if(Array.isArray(r))r.push(e);else if(o===t.length-2){var i=t.pop();r[i]=e}else t.push(e)}t.stringify=function(e){for(var t=[{obj:e}],n='',s,r,o,a,d,i,c,l,u,p,h;s=t.pop();)if(r=s.obj,o=s.prefix||'',a=s.val||'',n+=o,a)n+=a;else if('object'!=typeof r)n+='undefined'==typeof r?null:JSON.stringify(r);else if(null===r)n+='null';else if(Array.isArray(r)){for(t.push({val:']'}),d=r.length-1;0<=d;d--)i=0===d?'':',',t.push({obj:r[d],prefix:i});t.push({val:'['})}else{for(l in c=[],r)r.hasOwnProperty(l)&&c.push(l);for(t.push({val:'}'}),d=c.length-1;0<=d;d--)u=c[d],p=r[u],h=0<d?',':'',h+=JSON.stringify(u)+':',t.push({obj:p,prefix:h});t.push({val:'{'})}return n},t.parse=function(e){for(var t=[],s=[],r=0,o,i,a,d,c,l,u,p,h;;){if(o=e[r++],'}'===o||']'===o||'undefined'==typeof o){if(1===t.length)return t.pop();n(t.pop(),t,s);continue}switch(o){case' ':case'\t':case'\n':case':':case',':break;case'n':r+=3,n(null,t,s);break;case't':r+=3,n(!0,t,s);break;case'f':r+=4,n(!1,t,s);break;case'0':case'1':case'2':case'3':case'4':case'5':case'6':case'7':case'8':case'9':case'-':for(i='',r--;;)if(a=e[r++],/[\d\.\-e\+]/.test(a))i+=a;else{r--;break}n(parseFloat(i),t,s);break;case'"':for(d='',c=void 0,l=0;u=e[r++],'"'!==u||'\\'===c&&1==l%2;)d+=u,c=u,'\\'===c?l++:l=0;n(JSON.parse('"'+d+'"'),t,s);break;case'[':p={element:[],index:t.length},t.push(p.element),s.push(p);break;case'{':h={element:{},index:t.length},t.push(h.element),s.push(h);break;default:throw new Error('unexpectedly reached end of input: '+o);}}}},function(e){(function(){'use strict';let t=function(){let e=function(e){void 0===e&&(e={}),this.queue=new t,this.ex_locks={},this.ex_reserved={},this.sh_locks={},this.op_num=1,this.drain_for_writes=!!e.write_priority};e.prototype.exec=function(e,t){if(void 0===t&&(t={}),'function'!=typeof e)return Promise.reject(new Error('operation not a function'));let n=this.queue,s=this.op_num++,r=this;return new Promise(function(o,i){let a={op_fun:e,op_fff:o,op_rej:i,locks:t,op_num:s};n.push(a);let d=r.test_locks(t);0===d?r.run_queue():r.drain_for_writes&&4==(4&d)&&(r.reserve_locks(t),a.op_res=!0)}).then(function(e){return r.yield_locks(t),r.run_queue(),e})},e.prototype.wait=function(e){let t=this;return new Promise(function(n){t.exec(function(e){n(e)},e)})},e.prototype.test_locks=function(e){let t=Object.keys(e),n=t.length;if(0===n)return 0;let s=0,r=0,o=0;for(let a=0,i;a<n;a++)i=t[a],i in this.ex_locks&&0<this.ex_locks[i]&&(r=2),i in this.ex_reserved&&0<this.ex_reserved[i]&&(o=1),i in this.sh_locks&&0<this.sh_locks[i]&&'write'===e[i]&&(s=4);return o|r|s},e.prototype.take_locks=function(e){if(1<this.test_locks(e))return!1;let t=Object.keys(e),n=t.length;for(let s=0,r;s<n;s++)r=t[s],'write'===e[r]?this.ex_locks[r]=r in this.ex_locks?this.ex_locks[r]+1:1:this.sh_locks[r]=r in this.sh_locks?this.sh_locks[r]+1:1;return!0},e.prototype.reserve_locks=function(e){let t=Object.keys(e),n=t.length;for(let s=0,r;s<n;s++)r=t[s],'write'===e[r]&&(this.ex_reserved[r]=r in this.ex_reserved?this.ex_reserved[r]+1:1)},e.prototype.yield_reservations=function(e){let t=Object.keys(e),n=t.length;for(let s=0,r;s<n;s++)r=t[s],'write'===e[r]&&this.ex_reserved[r]--},e.prototype.yield_locks=function(e){let t=Object.keys(e),n=t.length;for(let s=0,r;s<n;s++)r=t[s],'write'===e[r]?this.ex_locks[r]--:this.sh_locks[r]--},e.prototype.run_queue=function(){for(let e=this.queue.head;void 0!==e;e=e.next){let t=e.data,n=this.test_locks(t.locks);(0===n||1===n&&t.op_res)&&(t.op_res&&this.yield_reservations(t.locks),this.take_locks(t.locks),0===t.op_fun.length?t.op_fff(t.op_fun()):t.op_fun(t.op_fff,t.op_rej),this.queue.remove(e))}};let t=function(){this.head=void 0,this.tail=void 0};return t.prototype.push=function(e){let t={data:e,prev:this.tail,next:void 0};return void 0===this.tail?(this.head=t,this.tail=t):(this.tail.next=t,this.tail=t),t},t.prototype.remove=function(e){let t=e.prev,n=e.next;void 0===t?this.head=n:t.next=n,void 0===n?this.tail=t:n.prev=t},e}();'undefined'!=typeof e&&'undefined'!=typeof e.exports?e.exports=t:window.polylock=t})()}]);